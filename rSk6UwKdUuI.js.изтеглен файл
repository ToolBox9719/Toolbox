;/*FB_PKG_DELIM*/

__d("ArmadilloCutoverClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("699");b=d("FalcoLoggerInternal").create("armadillo_cutover_client",a);e=b;g["default"]=e}),98);
__d("CometBatchNotificationsStateChangeSubscription_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="30300156509571373"}),null);
__d("CometBatchNotificationsStateChangeSubscription.graphql",["CometBatchNotificationsStateChangeSubscription_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"environment"},c={defaultValue:null,kind:"LocalArgument",name:"input"},d=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"BatchNotificationStateChangeSubscribeResponsePayload",kind:"LinkedField",name:"batch_notification_state_change_subscribe",plural:!1,selections:[{alias:null,args:null,concreteType:"Notification",kind:"LinkedField",name:"aggregated_notifications",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"seen_state",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"environment",variableName:"environment"}],kind:"ScalarField",name:"notifications_unseen_count",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"last_update_timestamp",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[a,c],kind:"Fragment",metadata:null,name:"CometBatchNotificationsStateChangeSubscription",selections:d,type:"Subscription",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,a],kind:"Operation",name:"CometBatchNotificationsStateChangeSubscription",selections:d},params:{id:b("CometBatchNotificationsStateChangeSubscription_facebookRelayOperation"),metadata:{subscriptionName:"batch_notification_state_change_subscribe"},name:"CometBatchNotificationsStateChangeSubscription",operationKind:"subscription",text:null}}}();e.exports=a}),null);
__d("CometBatchNotificationsStateChangeSubscription",["CometBatchNotificationsStateChangeSubscription.graphql","CometRelay"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h!==void 0?h:h=b("CometBatchNotificationsStateChangeSubscription.graphql");function a(a){return d("CometRelay").requestSubscription(a,{subscription:i,variables:{environment:"MAIN_SURFACE",input:{environment:"MAIN_SURFACE",query_flags:["INCLUDE_WA_P2B_NOTIFS"]}}})}g.subscription=i;g.batchSubscribe=a}),98);
__d("CometNotificationsReceiveLiveQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="30933694889611177"}),null);
__d("CometNotificationsReceiveLiveQuery.graphql",["CometTextWithEntitiesRelay_textWithEntities$normalization.graphql","CometNotificationsReceiveLiveQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"count"},c={defaultValue:null,kind:"LocalArgument",name:"environment"},d={defaultValue:null,kind:"LocalArgument",name:"filter_tokens"},e={defaultValue:null,kind:"LocalArgument",name:"notif_cache_ids"},f={defaultValue:null,kind:"LocalArgument",name:"refresh_num"},g={defaultValue:null,kind:"LocalArgument",name:"scale"},h={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},j=[i],k=[{kind:"Variable",name:"environment_alias_override",variableName:"environment"},{kind:"Variable",name:"filter_tokens",variableName:"filter_tokens"},{kind:"Variable",name:"first",variableName:"count"},{kind:"Variable",name:"notif_cache_ids",variableName:"notif_cache_ids"},{kind:"Literal",name:"notif_query_flags",value:["IS_COMET","INCLUDE_WA_P2B_NOTIFS"]},{kind:"Literal",name:"source",value:"unknown"}],l={alias:null,args:null,kind:"ScalarField",name:"text",storageKey:null},m=[l],n={alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"title",plural:!1,selections:m,storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"tracking",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"prefetch_score",storageKey:null},q={alias:null,args:null,kind:"ScalarField",name:"notif_id",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"notif_cache_id",storageKey:null},s={alias:null,args:null,kind:"ScalarField",name:"seen_state",storageKey:null},t={alias:"creation_time",args:null,concreteType:"CreationTimeWithRelativeText",kind:"LinkedField",name:"creation_time_with_relative_text",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"timestamp",storageKey:null}],storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"notif_type",storageKey:null};return{fragment:{argumentDefinitions:[a,c,d,e,f,g],kind:"Fragment",metadata:null,name:"CometNotificationsReceiveLiveQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"CometNotificationsReceiveLiveQuery_notificationsListViewer"}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,d,g,e,a,f],kind:"Operation",name:"CometNotificationsReceiveLiveQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"actor",plural:!1,selections:[h,{kind:"TypeDiscriminator",abstractKey:"__isActor"},i,{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null}],storageKey:null},{alias:null,args:[{kind:"Literal",name:"environment",value:"COMET"},{kind:"Literal",name:"query_ego_units",value:!1},{kind:"Variable",name:"refresh_num",variableName:"refresh_num"}],concreteType:"SideFeedConnection",kind:"LinkedField",name:"side_feed",plural:!1,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"nodes",plural:!0,selections:[h,{kind:"InlineFragment",selections:[{args:null,documentName:"CometRightSideHeaderCards_viewerSideFeed",fragmentName:"PagesCometHomeAdminContainer_pagesPanel",fragmentPropName:"pagesPanel",kind:"ModuleImport"}],type:"PagesSideFeedUnit",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometRightSideHeaderCards_viewerSideFeed",fragmentName:"FriendingCometHomeInlineRHCContainer_friendsPanel",fragmentPropName:"friendsPanel",kind:"ModuleImport"}],type:"FriendingRequestsSideFeedUnit",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometRightSideHeaderCards_viewerSideFeed",fragmentName:"CometHomeRemindersContainer_reminderPanel",fragmentPropName:"reminderPanel",kind:"ModuleImport"}],type:"RemindersSideFeedUnit",abstractKey:null},{kind:"InlineFragment",selections:j,type:"Node",abstractKey:"__isNode"},{kind:"InlineFragment",selections:j,type:"AdsSideFeedUnitItem",abstractKey:null}],storageKey:null}],storageKey:null},{alias:null,args:[{kind:"Variable",name:"environment",variableName:"environment"}],kind:"ScalarField",name:"notifications_unseen_count",storageKey:null},{alias:null,args:k,concreteType:"ViewerNotificationsPageConnection",kind:"LinkedField",name:"notifications_page",plural:!1,selections:[{alias:null,args:null,concreteType:"NotifPageFilterConfig",kind:"LinkedField",name:"filter_config",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"selected_filter_tokens",storageKey:null},{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"filters",plural:!0,selections:[h,{kind:"InlineFragment",selections:[n,{alias:null,args:null,kind:"ScalarField",name:"notif_filter_token",storageKey:null}],type:"NotifPageSingleFilter",abstractKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"query_id",storageKey:null},{alias:null,args:null,concreteType:"ViewerNotificationsPageEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"node",plural:!1,selections:[h,{alias:null,args:null,kind:"ScalarField",name:"row_type",storageKey:null},o,{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"bucket_type",storageKey:null},{alias:null,args:null,concreteType:"NotifPageBucketHeaderLink",kind:"LinkedField",name:"header_link",plural:!1,selections:[l,{alias:null,args:null,kind:"ScalarField",name:"url",storageKey:null}],storageKey:null},n],type:"NotifPageBucketHeaderRow",abstractKey:null},{kind:"InlineFragment",selections:[p,{alias:null,args:null,concreteType:"Notification",kind:"LinkedField",name:"notif",plural:!1,selections:[q,i,r,s,t,o],storageKey:null}],type:"NotifPageCachedNotificationRow",abstractKey:null},{kind:"InlineFragment",selections:[p,{alias:null,args:null,concreteType:"Notification",kind:"LinkedField",name:"notif",plural:!1,selections:[q,s,i,r,{alias:null,args:null,kind:"ScalarField",name:"notif_tags",storageKey:null},o,{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"notif_attachments",plural:!0,selections:[h,{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"sound_urls",storageKey:null}],type:"NotifSoundAttachment",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsListItemAttachment_notification",fragmentName:"CometNotificationsListItemFriendRequestAttachment_notifAttachments",fragmentPropName:"notifAttachments",kind:"ModuleImport"}],type:"FriendRequestNotifAttachment",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsListItemAttachment_notification",fragmentName:"CometNotificationsListItemInlineCTAAttachment_notifAttachments",fragmentPropName:"notifAttachments",kind:"ModuleImport"}],type:"InlineCTACometNotifAttachment",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsListItemAttachment_notification",fragmentName:"CometNotificationsListItemPageInviteAttachment_notifAttachments",fragmentPropName:"notifAttachments",kind:"ModuleImport"}],type:"PageInviteNotifAttachment",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsListItemAttachment_notification",fragmentName:"CometNotificationsListItemQuickPromotionAttachment_notifAttachments",fragmentPropName:"notifAttachments",kind:"ModuleImport"}],type:"QuickPromotionNotifAttachment",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsListItemAttachment_notification",fragmentName:"CometNotificationsListItemInlineSurveyAttachment_attachment",fragmentPropName:"attachment",kind:"ModuleImport"},{alias:null,args:null,concreteType:"StructuredSurveySession",kind:"LinkedField",name:"inline_survey",plural:!1,selections:[h],storageKey:null}],type:"InlineSurveyNotifAttachment",abstractKey:null}],storageKey:null},t,u,{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"body",plural:!1,selections:[{args:null,fragment:b("CometTextWithEntitiesRelay_textWithEntities$normalization.graphql"),kind:"FragmentSpread"},l],storageKey:null},{alias:null,args:[{kind:"Literal",name:"height",value:56},{kind:"Variable",name:"scale",variableName:"scale"},{kind:"Literal",name:"width",value:56}],concreteType:"Image",kind:"LinkedField",name:"notif_image",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"uri",storageKey:null}],storageKey:null},{alias:null,args:[{kind:"Literal",name:"site",value:"comet"}],kind:"ScalarField",name:"url",storageKey:'url(site:"comet")'},{alias:null,args:null,kind:"ScalarField",name:"cache_timestamp",storageKey:null},{alias:null,args:null,concreteType:"GlyphIconData",kind:"LinkedField",name:"icon_data",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"reaction_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"glyph_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"glyph_icon_url",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"NotificationContextInfo",kind:"LinkedField",name:"context_info",plural:!1,selections:[{alias:null,args:null,concreteType:"TextWithEntities",kind:"LinkedField",name:"short_text",plural:!1,selections:m,storageKey:null},{alias:null,args:null,concreteType:"XFBUfiIconsAndCounts",kind:"LinkedField",name:"ufi_icons_and_counts",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"ufi_counts",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ufi_icon_name",storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"NotifNavigationEndpoint",kind:"LinkedField",name:"navigation_endpoint",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"supported",value:"44kVfU"}],concreteType:null,kind:"LinkedField",name:"comet_custom_renderer",plural:!1,selections:[h,{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsList_viewerConnection",fragmentName:"CometTopFansFanNotificationListItem_renderer",fragmentPropName:"renderer",kind:"ModuleImport"}],type:"TopFansFanNotificationRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsList_viewerConnection",fragmentName:"CometRisingFanNotificationListItem_renderer",fragmentPropName:"renderer",kind:"ModuleImport"}],type:"RisingFanNotificationRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsList_viewerConnection",fragmentName:"CometCrossProfileNotificationsListItem_cpnInfo",fragmentPropName:"cpnInfo",kind:"ModuleImport"}],type:"CrossProfileNotificationInfo",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsList_viewerConnection",fragmentName:"CometBusinessMessageNotificationListItem_renderer",fragmentPropName:"renderer",kind:"ModuleImport"}],type:"BusinessMessageNotificationRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsList_viewerConnection",fragmentName:"CometGroupsNotificationsListItem_renderer",fragmentPropName:"renderer",kind:"ModuleImport"}],type:"GroupsNotificationRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsList_viewerConnection",fragmentName:"CometXIPaidexNotificationsListItem_renderer",fragmentPropName:"renderer",kind:"ModuleImport"}],type:"XIPaidexNotificationRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsList_viewerConnection",fragmentName:"CometAPPlusPostWaitlistNotificationsListItem_renderer",fragmentPropName:"renderer",kind:"ModuleImport"}],type:"APPlusPostWaitlistNotificationRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsList_viewerConnection",fragmentName:"CometCustomBadgeNameIsLiveNotificationListItem_renderer",fragmentPropName:"renderer",kind:"ModuleImport"}],type:"CreatorCustomBadgeNameIsLiveNotificationRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsList_viewerConnection",fragmentName:"CometCreatorCustomBadgeUserUpgradeNotificationListItem_renderer",fragmentPropName:"renderer",kind:"ModuleImport"}],type:"CreatorCustomBadgeUserUpgradeNotificationRenderer",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometNotificationsList_viewerConnection",fragmentName:"CometFXFetaUpgradeSuccessNotificationListItem_renderer",fragmentPropName:"renderer",kind:"ModuleImport"}],type:"FXFetaUpgradeSuccessNotificationRenderer",abstractKey:null}],storageKey:'comet_custom_renderer(supported:"44kVfU")'}],storageKey:null},{kind:"ClientExtension",selections:[{alias:"id_for_entrypoint",args:null,kind:"ScalarField",name:"__id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_hidden",storageKey:null}]}],storageKey:null}],type:"NotifPageNotificationRow",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"invalidation_reason",storageKey:null},{alias:null,args:null,concreteType:"Notification",kind:"LinkedField",name:"notif",plural:!1,selections:[q,u,i],storageKey:null}],type:"NotifPageDebugInvalidationRow",abstractKey:null},{kind:"InlineFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"see_previous_text",storageKey:null}],type:"NotifPageSeePreviousButtonRow",abstractKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cursor",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"PageInfo",kind:"LinkedField",name:"page_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"end_cursor",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_next_page",storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"__id",storageKey:null}]}],storageKey:null},{alias:null,args:k,filters:["environment_alias_override"],handle:"comet_notifications_thin_client",key:"CometNotificationsList_notifications_page",kind:"LinkedHandle",name:"notifications_page"},{alias:null,args:null,kind:"ScalarField",name:"last_update_timestamp",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"notifications_sound_path",storageKey:null},{alias:null,args:[{kind:"Literal",name:"promptType",value:"FOOTER"},{kind:"Literal",name:"surface",value:"JEWEL_COMET"}],concreteType:"XFBCometPushTurnOnStatus",kind:"LinkedField",name:"comet_push_turn_on_status",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"is_comet_push_turn_on_eligible",storageKey:null}],storageKey:'comet_push_turn_on_status(promptType:"FOOTER",surface:"JEWEL_COMET")'},{alias:null,args:null,concreteType:"BrowserPushConfig",kind:"LinkedField",name:"browser_push_config",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"browser_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"service_worker_uri",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"app_id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("CometNotificationsReceiveLiveQuery_facebookRelayOperation"),metadata:{live:{config_id:"comet_notifications_live_query_experimental"}},name:"CometNotificationsReceiveLiveQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("CometNotificationsReceiveLiveQuery_notificationsListViewer.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[{kind:"RootArgument",name:"count"},{kind:"RootArgument",name:"environment"},{kind:"RootArgument",name:"filter_tokens"},{kind:"RootArgument",name:"notif_cache_ids"}],kind:"Fragment",metadata:null,name:"CometNotificationsReceiveLiveQuery_notificationsListViewer",selections:[{alias:null,args:null,concreteType:null,kind:"LinkedField",name:"actor",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"CometToastNotification_actor"}],storageKey:null},{args:null,kind:"FragmentSpread",name:"CometRightSideHeaderCards_viewerSideFeed"},{alias:null,args:[{kind:"Variable",name:"environment",variableName:"environment"}],kind:"ScalarField",name:"notifications_unseen_count",storageKey:null},{args:[{kind:"Variable",name:"count",variableName:"count"},{kind:"Variable",name:"filter_tokens",variableName:"filter_tokens"},{kind:"Variable",name:"notif_cache_ids",variableName:"notif_cache_ids"}],kind:"FragmentSpread",name:"CometNotificationsList_viewerConnection"},{args:null,kind:"FragmentSpread",name:"CometNotificationsList_viewerData"},{alias:null,args:null,kind:"ScalarField",name:"last_update_timestamp",storageKey:null}],type:"Viewer",abstractKey:null};e.exports=a}),null);
__d("requestLiveQueryExperimental",["invariant","LiveQueryEventsLoggingResolver","ODS","RelayAPIConfig","RelayGraphQLRequestUtils","makeGraphQLLiveQueryRequest","nullthrows","promiseDone","relay-runtime","relay-runtime/store/RelayConcreteVariables"],(function(a,b,c,d,e,f,g,h){"use strict";var i;function j(a,b){var e={access_token:c("RelayAPIConfig").accessToken,actor_id:c("RelayAPIConfig").actorID,config_id:c("nullthrows")(a.params.metadata.live.config_id,"config_id should not be null")};a={doc_id:c("nullthrows")(a.params.id,"id in request params should not be null"),operation_name:a.params.name,config_id:e.config_id,actor_id:e.actor_id,variables:b};e.access_token!==""&&(a=babelHelpers["extends"]({},a,{access_token:e.access_token}));b=d("LiveQueryEventsLoggingResolver").tempResolveLoggingContext();b!=null&&(a=babelHelpers["extends"]({},a,{logging_context:b}));return a}function a(a,b){var e=b.query;b=b.variables;var f=d("relay-runtime").getRequest(e);e=k(f,b);var g=j(f,e),l,m=e;e=d("relay-runtime").createOperationDescriptor(f,b);b=d("relay-runtime").Observable.create(function(a){l=c("makeGraphQLLiveQueryRequest")(g).onResponse(function(b){var e;try{e=c("RelayGraphQLRequestUtils").parsePayload(b),typeof e==="object"||h(0,12937)}catch(b){(i||(i=d("ODS"))).bumpEntityKey(97,"comet_notifications.new_notification","lq.receive_invalid_payload");return a.error(b)}if(!("errors"in e)&&!("data"in e)){(i||(i=d("ODS"))).bumpEntityKey(97,"comet_notifications.new_notification","lq.receive_empty_response");return a.error(d("relay-runtime").RelayError.createWarning("EmptyResponseError","Parsed network response is empty"))}if(e.errors)for(b of e.errors)if(b.severity==="CRITICAL"){var f=c("RelayGraphQLRequestUtils").createErrorFromPayload(b);(i||(i=d("ODS"))).bumpEntityKey(97,"comet_notifications.new_notification","lq.receive_critical_error");return a.error(f)}a.closed||((i||(i=d("ODS"))).bumpEntityKey(97,"comet_notifications.new_notification","lq.receive_notification"),a.next(e))}).onRetryUpdateRequestBody(function(){return JSON.stringify({variables:m})}).send();return function(){c("promiseDone")(l,function(a){a.cancel()})}});a.executeWithSource({operation:e,source:b}).subscribe({});var n=!1,o;return{dispose:function(){!n&&l!=null&&(c("promiseDone")(l,function(a){a.cancel()}),n=!0)},updateVariables:function(a){if(!n&&l!=null){o=a;c("promiseDone")(l,function(a){if(o!=null&&!n){var b=k(f,o);a.amendExperimental({new_variables:b});m=b;o=null}});return!0}return!1}}}function k(a,b){return d("relay-runtime/store/RelayConcreteVariables").getOperationVariables(a.operation,a.params.providedVariables,b)}g["default"]=a}),98);
__d("CometNotificationsReceiveLiveQuery",["CometNotificationsReceiveLiveQuery.graphql","CometNotificationsReceiveLiveQuery_notificationsListViewer.graphql","requestLiveQueryExperimental"],(function(a,b,c,d,e,f,g){"use strict";var h,i;h!==void 0?h:h=b("CometNotificationsReceiveLiveQuery_notificationsListViewer.graphql");var j=i!==void 0?i:i=b("CometNotificationsReceiveLiveQuery.graphql");function a(a,b){return c("requestLiveQueryExperimental")(a,{query:j,variables:b})}g.subscribeToNotificationUpdates=a}),98);
__d("CometNotificationsStateChangeSubscription_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="23864641996495578"}),null);
__d("CometNotificationsStateChangeSubscription.graphql",["CometNotificationsStateChangeSubscription_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"environment"},c={defaultValue:null,kind:"LocalArgument",name:"input"},d=[{alias:null,args:[{kind:"Variable",name:"data",variableName:"input"}],concreteType:"NotificationStateChangeSubscribeResponsePayload",kind:"LinkedField",name:"notification_state_change_subscribe",plural:!1,selections:[{alias:null,args:null,concreteType:"Notification",kind:"LinkedField",name:"notification",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"notif_cache_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"cache_timestamp",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"seen_state",storageKey:null},{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:[{kind:"Variable",name:"environment",variableName:"environment"}],kind:"ScalarField",name:"notifications_unseen_count",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[a,c],kind:"Fragment",metadata:null,name:"CometNotificationsStateChangeSubscription",selections:d,type:"Subscription",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,a],kind:"Operation",name:"CometNotificationsStateChangeSubscription",selections:d},params:{id:b("CometNotificationsStateChangeSubscription_facebookRelayOperation"),metadata:{subscriptionName:"notification_state_change_subscribe"},name:"CometNotificationsStateChangeSubscription",operationKind:"subscription",text:null}}}();e.exports=a}),null);
__d("CometNotificationsStateChangeSubscription",["CometNotificationsStateChangeSubscription.graphql","CometRelay"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h!==void 0?h:h=b("CometNotificationsStateChangeSubscription.graphql");function a(a){return d("CometRelay").requestSubscription(a,{subscription:i,updater:function(a,b){if(!b)return;b=b.notification_state_change_subscribe;if(!b)return;var c=b==null?void 0:b.notification;b=b==null?void 0:b.seen_state;if(!c||!b)return;if(c.id!=null&&c.id!==""){a=a.get(c.id);a&&a.setValue(b,"seen_state")}},variables:{environment:"MAIN_SURFACE",input:{environment:"MAIN_SURFACE",query_flags:["INCLUDE_WA_P2B_NOTIFS"]}}})}c={subscribe:a,subscription:i};g["default"]=c}),98);
__d("DedupMiThreadCreationCache",["justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set();a=function(a){var b=c("justknobx")._("4749");b&&h.add(a)};g.DedupMiThreadCreationCache=h;g.addToDedupMiThreadCreationCache=a}),98);
__d("E2EEBackupSecretRestoreModule",["E2EEBackupCommon","QuickPerformanceLogger","VestaClient","VestaClientError","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("qpl")._(235874858,"168");async function a(a,b,e){(h||(h=c("QuickPerformanceLogger"))).markerStart(i);h.markerAnnotate(i,{string:{product_use_case:b.productUseCase}});try{var f=await a.initLogin({clientId:b.clientId,productUseCase:b.productUseCase},e),g=f.islandRsaPub,j=f.islandRsaPubSig,k=f.islandEd25519Pub,l=f.islandEd25519PubSig;f=f.isRegistered;(h||(h=c("QuickPerformanceLogger"))).markerPoint(i,"init_login_network_call");if(!f){(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,{string:{failure_reason:"NOT_REGISTERED"}});h.markerEnd(i,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.NOT_REGISTERED)}f=await Promise.all([d("VestaClient").validateHsmKey(g,j),d("VestaClient").validateHsmKey(k,l)]);g=f[0];j=f[1];if(!g){(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,{string:{failure_reason:"ISLAND_PUB_RSA_KEY_INVALID"}});h.markerEnd(i,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.ISLAND_PUB_RSA_KEY_INVALID)}if(!j){(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,{string:{failure_reason:"ISLAND_PUB_ED25519_KEY_INVALID"}});h.markerEnd(i,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.ISLAND_PUB_ED25519_KEY_INVALID)}h.markerPoint(i,"verify_island_rsa_key");h.markerPoint(i,"verify_island_ed25519_key");l=b.vestaAccountPin;if(l==null)throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.MISSING_PIN_INPUT);else{f=new TextEncoder();g=await d("VestaClient").beginLogin(f.encode(l));j=g.clientState;f=g.l1Message;(h||(h=c("QuickPerformanceLogger"))).markerPoint(i,"begin_login_vesta_client");l=await a.beginLogin({clientId:b.clientId,productUseCase:b.productUseCase,opaqueL1:f},e);g=l.opaqueL2;f=l.opaqueL2Sig;h.markerPoint(i,"begin_login_network_call");l=await d("VestaClient").finishLogin(g,f,k,j);g=l.exportKey;f=l.l3Message;k=l.sessionKey;h.markerPoint(i,"finish_login_vesta_client");j=await a.finishLogin({clientId:b.clientId,productUseCase:b.productUseCase,opaqueL3:f},e);l=j.loginSuccess;a=j.loginPayload;h.markerPoint(i,"finish_login_network_call");if(!l){(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,{string:{failure_reason:"VESTA_SERVER_ERROR"}});h.markerEnd(i,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.VESTA_SERVER_ERROR)}if(a!=null){b=await d("VestaClient").unpackLoginPayload(a,k,g);f=b.userSecret;(h||(h=c("QuickPerformanceLogger"))).markerPoint(i,"unpack_login_payload");h.markerEnd(i,2);return f}h.markerAnnotate(i,{string:{failure_reason:"VESTA_SERVER_ERROR"}});h.markerEnd(i,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.VESTA_SERVER_ERROR)}}catch(a){if(a instanceof d("E2EEBackupCommon").BackupError)throw a;else if(a instanceof c("VestaClientError")){(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,{string:{failure_reason:"VestaClientException: "+a.name}});h.markerEnd(i,3);if(a.name==="InvalidUserPassword")throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.INVALID_PASSWORD,a);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.VESTA_CLIENT_ERROR,a)}else{(h||(h=c("QuickPerformanceLogger"))).markerAnnotate(i,{string:{failure_reason:a.message}});h.markerEnd(i,3);throw new(d("E2EEBackupCommon").BackupError)(d("E2EEBackupCommon").BackupErrorType.NETWORK_PROVIDER_ERROR,a)}}}g.restoreBackupSecret=a}),98);
__d("EBMessageRangeQueryWithPersistenceQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="24052353867781136"}),null);
__d("EBMessageRangeQueryWithPersistenceQuery.graphql",["EBMessageRangeQueryWithPersistenceQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={defaultValue:null,kind:"LocalArgument",name:"app_id"},c={defaultValue:null,kind:"LocalArgument",name:"restore_payload_string"},d={defaultValue:null,kind:"LocalArgument",name:"restore_type"},e=[{kind:"Variable",name:"app_id",variableName:"app_id"},{kind:"Variable",name:"restore_payload_string",variableName:"restore_payload_string"},{kind:"Variable",name:"restore_type",variableName:"restore_type"}],f={alias:null,args:null,kind:"ScalarField",name:"encryption_version",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"epoch_anon_id",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"epoch_id",storageKey:null},i={alias:null,args:null,kind:"ScalarField",name:"encrypted_protobuf_stanza",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"protobuf_timestamp_ms",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"sk_ciphertext",storageKey:null},l=[g,h];return{fragment:{argumentDefinitions:[a,c,d],kind:"Fragment",metadata:null,name:"EBMessageRangeQueryWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"handleRestoreMessagesGraphQLResponse_XFBEncryptedBackupMessages"}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[c,d,a],kind:"Operation",name:"EBMessageRangeQueryWithPersistenceQuery",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMailbox",kind:"LinkedField",name:"mailbox",plural:!1,selections:[{alias:null,args:e,concreteType:"XFBEncryptedBackupMessages",kind:"LinkedField",name:"messages",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupMessage",kind:"LinkedField",name:"encrypted_messages",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEchoDocument",kind:"LinkedField",name:"echo_document",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"echo_document_string",storageKey:null},f,g,h,{alias:null,args:null,kind:"ScalarField",name:"epoch_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"otid",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanzas",kind:"LinkedField",name:"protobuf_stanzas",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"message_tags",storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"top_level_protobuf",plural:!1,selections:[i,f,g,h,j,k],storageKey:null},{alias:null,args:null,concreteType:"XFBProtobufStanza",kind:"LinkedField",name:"supplemental_protobufs",plural:!0,selections:[i,f,g,h,j,k,{alias:null,args:null,kind:"ScalarField",name:"supplemental_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"supplemental_otid",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"backup_id",storageKey:null},{alias:null,args:null,concreteType:"XFBMessageRangeInfo",kind:"LinkedField",name:"message_range_info",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_more_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"has_more_after",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_before",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"next_message_timestamp_ms_after",storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"should_delete_mailbox",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"exception_string",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"thread_not_found",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochDerivationSet",kind:"LinkedField",name:"epoch_derivation_set",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupsEpochEdge",kind:"LinkedField",name:"epoch_edges",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"backward_edge",storageKey:null},{alias:null,args:null,concreteType:"XFBEpochForwardEdge",kind:"LinkedField",name:"forward_edge",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"auth_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"encrypted_entropy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"entropy_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"epoch_storage_public_key",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"psk_fingerprint",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"from_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,concreteType:"XFBEpochIds",kind:"LinkedField",name:"to_epoch",plural:!1,selections:l,storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"from_epoch_fingerprint",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"to_epoch_fingerprint",storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:null}]},params:{id:b("EBMessageRangeQueryWithPersistenceQuery_facebookRelayOperation"),metadata:{},name:"EBMessageRangeQueryWithPersistenceQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("EBMessageRangeQueryWithPersistence",["Base64Utils","EBAPIConvertNativeToLS","EBAPIDecryptionModule","EBAPIQPLPoints","EBAPISharedUtils","EBAPIWorkerCheck","EBDeriveAndStoreEpochs","EBGetClientState","EBMessageRangeQueryUtils","EBMessageRangeQueryWithPersistenceQuery.graphql","I64","LSDatabaseSingleton","LSDecryptMessageProtobufsStoredProcedure","LSDecryptMessagesStoredProcedure","LSEncryptedBackupsMessagesRangeQueryDirection","LSFactory","LSIntEnum","LSMEBTaskCreationSource","LSShape","LSVec","MAWCurrentUser","MAWEBRestoreTrackingUtils","MAWJids","MAWJobDefinitions","MAWMiActGetThreadLifecycleState__DO_NOT_USE","MAWMiActThreadLifecycleState__DO_NOT_USE","QPLFlow","WAHashStringToNumber","WAJids","WAResultOrError","WATagsLogger","WorkerRelay","WorkerRelayNetwork","getErrorSafe","gkx","handleRestoreMessagesGraphQLResponse","justknobx","promiseDone","qpl","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=c("requireDeferred")("LSEBUnifiedRestoreUtils").__setRef("EBMessageRangeQueryWithPersistence"),F=c("requireDeferred")("LSRestoreEchoBlobs.nop").__setRef("EBMessageRangeQueryWithPersistence"),G=c("requireDeferred")("LSRestoreProtobufs.nop").__setRef("EBMessageRangeQueryWithPersistence"),H=d("WATagsLogger").TAGS(["labyrinth_web","EBMessageRangeQueryWithPersistence"]),I=h!==void 0?h:h=b("EBMessageRangeQueryWithPersistenceQuery.graphql");async function a(a){var b=a.chatJid,e=a.direction,g=a.includeOffset;g=g===void 0?!1:g;var h=a.numMessages,p=a.sortOrderMs,q=a.source,r=a.traceId;if(d("EBAPIWorkerCheck").runningInWorker())return d("WAResultOrError").makeError("unsupported-context");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql");var s=d("WAHashStringToNumber").hashStringToNumber(r),t=c("qpl")._(521471755,"2586"),u=d("QPLFlow").startQPLFlow(t,{annotations:{bool:{mainThreadRestore:!0,workerThreadRestore:!1},int:{num_messages_requested:h,source:q!=null?q:c("LSMEBTaskCreationSource").UNKNOWN},string:{request_args:JSON.stringify(a)}},instanceKey:s,timeoutInMs:c("justknobx")._("2950")});try{H.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[","] Issuing messageRangeQuery with args: ",""])),r,JSON.stringify(a));d("MAWEBRestoreTrackingUtils").markEBRestorePaginated(q,r,"GQL_MAIN_THREAD");var v=await (B||(B=d("LSDatabaseSingleton"))).getLSDatabaseSingletonPromiseOrValue(),w;await v.runInTransaction(async function(a){var c;u.addPoint("get_client_state_start");w=await d("EBGetClientState").getClientState(v,a);d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{string:{device_id:(C||(C=d("I64"))).to_string((c=(c=w)==null?void 0:c.device_id)!=null?c:(C||(C=d("I64"))).zero)}},pointName:"client_state_retrieved",traceId:r});u.addPoint("get_client_state_end",{string:{device_id:C.to_string((c=(c=w)==null?void 0:c.device_id)!=null?c:(C||(C=d("I64"))).zero)}});c=await d("MAWMiActGetThreadLifecycleState__DO_NOT_USE").getThreadLifecycleStateByJid(a,d("MAWJids").convertChatJidToIntJid(b),"GQL_range_restore_eb_api_call");if(c.type===d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.JID_MISSING_MAPPING_ROW||c.type===d("MAWMiActThreadLifecycleState__DO_NOT_USE").MiActThreadStatesEnum.JID_MISSING_MI_THREAD){d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{string:{thread_state_by_jid:c.type}},pointName:"chat_jid_not_found_in_act_mapping_table",traceId:r});u.addPoint("chat_jid_not_found_in_act_mapping_table");d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(r,!1);u.endSuccess();d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.thread.missing.error");return d("WAResultOrError").makeError("thread-not-found-in-mi-act-mapping-table")}else d("MAWEBRestoreTrackingUtils").addQPLRestorePointWithAnnotations({annotations:{string:{thread_state_by_jid:c.type}},pointName:"chat_jid_exists_in_act_mapping_table",traceId:r}),u.addPoint("chat_jid_exists_in_act_mapping_table")},"readwrite",void 0,void 0,f.id+":185");if(w==null){H.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["No client state found - unable to restore"])));u.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(r,!1,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_CLIENT_STATE);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("no-client-state")}t=w;s=t.backupId;a=t.device_id;var x=t.locally_available_epochs,y=t.mailboxRootKey;t=t.ocmfClientStateBlob;if(s==null||a==null||y==null||t==null){H.ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["mandatory params of client state are null"])));u.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_CLIENT_STATE}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(r,!1,"client_state_null");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("invalid-client-state")}var z=d("MAWCurrentUser").getAppID();d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"app_id_retrieved",traceId:r});u.addPoint("app_id_retrieved");var A=d("WAJids").threadIdForChatJid(b);d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"converted_chatjid_to_threadid",traceId:r});u.addPoint("converted_chatjid_to_threadid");e=e==="before"?c("LSEncryptedBackupsMessagesRangeQueryDirection").BEFORE:c("LSEncryptedBackupsMessagesRangeQueryDirection").AFTER;x={restore_context:{act_thread_id:d("MAWJobDefinitions").toThreadJidPrimaryId(A),site:"www",tam_thread_subtype:0},success:babelHelpers.extends({device_context:{device_id:(C||(C=d("I64"))).to_string(a),locally_available_epochs:x,raw_tokens:{mailbox_root_key:d("Base64Utils").fromArrayBuffer(y),ocmf_client_state_blob:d("Base64Utils").fromArrayBuffer(t)}},direction:e,include_offset:g,query_num_messages:h,server_thread_key:A},p!=null?{reference_timestamp:d("EBMessageRangeQueryUtils").safeTimestampMsString(p)}:{})};u.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_START);d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"graphql_query_start",traceId:r});var D;try{await d("WorkerRelayNetwork").createWorkerNetworkExecute(),D=await d("WorkerRelay").createWorkerQuery(I,{app_id:String(z!=null?z:"0"),restore_payload_string:JSON.stringify(x),restore_type:"RANGE_QUERY_RESTORE"}),u.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_END),d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"graphql_query_end",traceId:r})}catch(a){y=c("getErrorSafe")(a);u.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_EXCEPTION,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.GRAPHQL_QUERY_EXCEPTION,errorStackTrace:y.stack}});return d("WAResultOrError").makeError("invalid-graphql-response")}if(D==null||((t=D)==null||(t=t.viewer)==null||(t=t.encrypted_backup)==null?void 0:t.mailbox)==null){u.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(r,!1,"gql_range_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}g=(e=D)==null||(e=e.viewer)==null||(e=e.encrypted_backup)==null||(e=e.mailbox)==null?void 0:e.messages;if(g==null){H.ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["GQL worker range restore query returned null for message response"])));u.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.INVALID_GRAPHQL_RESPONSE}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(r,!1,"gql_range_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}h=g;if((h==null?void 0:h.encrypted_messages)==null){u.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NULL_MESSAGES}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(r,!1,"null_messages");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("invalid-graphql-response")}A=h.backup_id;z=h.encrypted_messages;x=h.epoch_derivation_set;y=h.exception_string;t=h.message_range_info;e=h.should_delete_mailbox;g=h.thread_not_found;u.addAnnotations({bool:{should_delete_mailbox:e!=null?e:!1},int:{response_messages:z.length},string:{message_range_info:JSON.stringify(t)}});if(y!=null){H.ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["server side exception during graphql restore - ",""])),y);if(g!=null&&g){u.addPoint("thread_not_found_on_server");d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"thread_not_found_on_server",traceId:r});u.endSuccess();d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(r,!1);return d("WAResultOrError").makeError("thread-not-found-on-server")}e===!0&&(u.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DELETE_MAILBOX),d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"delete_mailbox",traceId:r}));u.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,exception:y}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(r,!1,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.SERVER_SIDE_EXCEPTION,{string:{exception:y}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("server-side-exception")}u.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_START);c("gkx")("7473")?await d("EBDeriveAndStoreEpochs").deriveAndStoreEpochsNonLS(v,x):await d("handleRestoreMessagesGraphQLResponse").deriveAndStoreEpochs(x,v,a,r);u.addAnnotations({bool:{hasEpochs:x!=null&&x.epoch_edges.length>0,nonLS:c("gkx")("7473")}});u.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DERIVE_AND_STORE_EPOCHS_END);A==null&&(H.WARN(n||(n=babelHelpers.taggedTemplateLiteralLoose(["backup_id is null during graphQL restore"]))),u.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.BACKUP_ID_NULL),d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"backup_id_null",traceId:r}));h=await J(v,b,z,A!=null?A:(C||(C=d("I64"))).to_string(s),t,r,u);if(h.success===!1)return h;K(v,b,h.value,p,q,r);return d("WAResultOrError").makeResult()}catch(a){g=c("getErrorSafe")(a);H.ERROR(o||(o=babelHelpers.taggedTemplateLiteralLoose(["graphQL range restore error ",""])),g);u.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RUNTIME_ERROR,errorStackTrace:(e=g.stack)!=null?e:""}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(r,!1,"gql_range_restore_exception");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").DEPRECATED_makeError("runtime-error",g)}}async function J(a,b,e,g,h,i,j){var k=d("WAJids").threadIdForChatJid(b),l=d("WAHashStringToNumber").hashStringToNumber(i),m=c("qpl")._(521471755,"2586");e.length===0&&(H.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["No messages to restore"]))),j.addAnnotations({bool:{hasMessagesToRestore:!1}}),d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"no_messages",traceId:i}));if(h==null){H.ERROR(q||(q=babelHelpers.taggedTemplateLiteralLoose(["message range info is null - cannot proceed with graphQL restore"])));j.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(i,!1,d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO);d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("missing-message-range-info")}var n=h.has_more_after,o=h.has_more_before,B=h.next_message_timestamp_ms_after;h=h.next_message_timestamp_ms_before;if(o==null||n==null||B==null||h==null){H.ERROR(r||(r=babelHelpers.taggedTemplateLiteralLoose(["message range info is not complete - cannot proceed with graphQL restore"])));j.endFail(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO,{string:{error_description:d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.MISSING_RANGE_INFO}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(i,!1,"message_range_info_null");d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("missing-message-range-info")}if(e.length===0){j.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.NO_MESSAGES_TO_RESTORE);j.endSuccess();d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.success");return d("WAResultOrError").makeResult({echo:[],messageRangeInfo:{has_more_after:n,has_more_before:o,next_message_timestamp_ms_after:B,next_message_timestamp_ms_before:h},protobuf:[]})}g=d("handleRestoreMessagesGraphQLResponse").processMessageArray(e,g,m,l);var C=g.encryptedLSEchoMessages,D=g.encryptedMessagesWithProtobufs;m=g.encryptedNonLSEchoMessages;l=g.encryptedNonLSProtobufs;j.addAnnotations({bool:{hasEchoMessages:C.length>0,hasProtobufMessages:D.length>0}});if(c("gkx")("7473")){j.addPoint("native_decryption_start");g=d("WAJids").threadIdForChatJid(b);b=await d("EBAPIDecryptionModule").decryptUsingNativeJS(a,g,l,m);if(!b.success){j.endFail("native_decryption_error",{string:{error_description:"native_decryption_error"}});return d("WAResultOrError").makeError("native-decryption-error")}g=b.value.decryptedEchoMessages;b=b.value.decryptedProtobufs;g=d("EBAPIConvertNativeToLS").convertNativeDecryptionResponseToDecryptedMessageType(g,b);j.addPoint("native_decryption_success");return d("WAResultOrError").makeResult({echo:c("LSVec").toArray(g.echo),messageRangeInfo:{has_more_after:n,has_more_before:o,next_message_timestamp_ms_after:B,next_message_timestamp_ms_before:h},protobuf:c("LSVec").toArray(g.protobuf)})}e.length!==C.length+D.length&&j.addAnnotations({bool:{hasEchoProtobufCountMismatch:!0}});H.LOG(s||(s=babelHelpers.taggedTemplateLiteralLoose(["[","] messageRangeQuery echo: "," protobuf: "," nonLsEcho: "," nonLSProtobuf: ",""])),i,C.length,D.length,m.length,l.length);var E,F;if(C.length>0&&D.length>0){j.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.RESTORING_MIXED_ECHO_PROTOBUF_PAYLOAD);j.addAnnotations({int:{echoMessagesPayloadSize:C.length,protobufMessagesPayloadSize:D.length,totalRestorePayloadSize:C.length+D.length}});j.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_AND_PROTOBUF_START);b=await a.runInTransaction(async function(a){var b=await c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:k,encryptedMessages:c("LSVec").ofArray(C)}),e=b[0];b=b[1];if(b!=null){var f=d("LSShape").toRecord(b);H.ERROR(t||(t=babelHelpers.taggedTemplateLiteralLoose(["[mixed][echo] decryptMessageEcho failed with an error."])));H.WARN(u||(u=babelHelpers.taggedTemplateLiteralLoose(["[mixed][echo] decryptMessageEcho failed with error: ",""])),f.error_message);j.addAnnotations({string:{echo_decryption_error:f.error_message}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(i,!1,"ECHO_DECRYPTION_FAILURE",{string:{error_description:f.error_message}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error")}f=await c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:k,encryptedMessagesWithProtobufs:c("LSVec").ofArray(D)});a=f[0];f=f[1];if(f!=null){f=d("LSShape").toRecord(f);H.ERROR(v||(v=babelHelpers.taggedTemplateLiteralLoose(["[mixed][protobuf] decryptMessageProtobufs failed with an error."])));H.WARN(w||(w=babelHelpers.taggedTemplateLiteralLoose(["[mixed][protobuf] decryptMessageProtobufs failed with error: ",""])),f.error_message);j.endFail("PROTOBUF_DECRYPTION_FAILURE",{string:{error_description:f.error_message}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(i,!1,"PROTOBUF_DECRYPTION_FAILURE",{string:{error_description:f.error_message}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("protobuf-decryption-failure")}f=a==null?0:c("LSVec").toArray(a).length;b!=null&&f>0&&j.addAnnotations({bool:{continuedAfterEchoDecryptFailure:!0}});return{decryptedEchoMsgs:e,decryptedProtobufMsgs:a}},"readwrite",void 0,void 0,f.id+":768");g=b.decryptedEchoMsgs;e=b.decryptedProtobufMsgs;j.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_AND_PROTOBUF_END);var G;g!=null&&(G=c("LSVec").toArray(g).map(function(a){return d("LSShape").toRecord(a).value}));E=G;F=e==null?[]:c("LSVec").toArray(e)}else if(D.length===0){j.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_START);m=await a.runInTransaction(function(a){return c("LSDecryptMessagesStoredProcedure")(c("LSFactory")(a),{actThreadId:k,encryptedMessages:c("LSVec").ofArray(C)})},"readwrite",void 0,void 0,f.id+":872");l=m[0];b=m[1];if(b!=null){g=d("LSShape").toRecord(b);H.ERROR(x||(x=babelHelpers.taggedTemplateLiteralLoose(["[echo-only][echo] decryptMessageEcho failed with an error."])));H.WARN(y||(y=babelHelpers.taggedTemplateLiteralLoose(["[echo-only][echo] decryptMessageEcho failed with error: ",""])),g.error_message);j.endFail("ECHO_DECRYPTION_FAILURE",{string:{error_description:g.error_message}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(i,!1,"ECHO_DECRYPTION_FAILURE",{string:{error_description:g.error_message}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("echo-decryption-failure")}j.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_ECHO_END);if(l!=null){e=c("LSVec").toArray(l).map(function(a){return d("LSShape").toRecord(a).value});E=e}}else{j.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_START);m=await a.runInTransaction(function(a){return c("LSDecryptMessageProtobufsStoredProcedure")(c("LSFactory")(a),{actThreadId:k,encryptedMessagesWithProtobufs:c("LSVec").ofArray(D)})},"readwrite",void 0,void 0,f.id+":921");b=m[0];g=m[1];if(g!=null){l=d("LSShape").toRecord(g);H.ERROR(z||(z=babelHelpers.taggedTemplateLiteralLoose(["[protobuf-only] decryptMessageProtobufs failed with an error"])));H.WARN(A||(A=babelHelpers.taggedTemplateLiteralLoose(["[protobuf-only] decryptMessageProtobufs failed with error: ",""])),l.error_message);j.endFail("PROTOBUF_DECRYPTION_FAILURE",{string:{error_description:l.error_message}});d("MAWEBRestoreTrackingUtils").markEBRestoreFail(i,!1,"PROTOBUF_DECRYPTION_FAILURE",{string:{error_description:l.error_message}});d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.error");return d("WAResultOrError").makeError("protobuf-decryption-failure")}j.addPoint(d("EBAPIQPLPoints").EBMessageRestoreQueryQPLPoints.DECRYPT_MESSAGES_PROTOBUF_END);F=b==null?[]:c("LSVec").toArray(b)}j.endSuccess();d("EBAPISharedUtils").bumpOdsRestoreKey("restore.request.paginated.gql.success");return d("WAResultOrError").makeResult({echo:E!=null?E:[],messageRangeInfo:{has_more_after:n,has_more_before:o,next_message_timestamp_ms_after:B,next_message_timestamp_ms_before:h},protobuf:F!=null?F:[]})}function K(a,b,e,g,h,i){var j=e.echo,k=e.messageRangeInfo,l=e.protobuf,m=d("WAJids").threadIdForChatJid(b);j.length>0&&l.length>0?c("promiseDone")(E.load().then(function(a){return a.echoProtobufConsolidatedRestoreHelper(m,c("LSVec").ofArray(l),k.has_more_before,(C||(C=d("I64"))).of_string(k.next_message_timestamp_ms_before),k.has_more_after,C.of_string(k.next_message_timestamp_ms_after),!1,i,g,void 0,c("LSVec").ofArray(j),(D||(D=d("LSIntEnum"))).ofNumber(h!=null?h:c("LSMEBTaskCreationSource").UNKNOWN),b)})):j.length>0?c("promiseDone")(F.load().then(function(e){return a.runInTransaction(function(a){return e(a,0,(C||(C=d("I64"))).zero,c("LSVec").ofArray(j),k.has_more_before,C.of_string(k.next_message_timestamp_ms_before),k.has_more_after,C.of_string(k.next_message_timestamp_ms_after),!1,m,i,g,(D||(D=d("LSIntEnum"))).ofNumber(h!=null?h:c("LSMEBTaskCreationSource").UNKNOWN),b)},"readwrite",void 0,void 0,f.id+":1010")})):c("promiseDone")(G.load().then(function(e){return a.runInTransaction(function(a){return e(a,0,m,c("LSVec").ofArray(l),k.has_more_before,(C||(C=d("I64"))).of_string(k.next_message_timestamp_ms_before),k.has_more_after,C.of_string(k.next_message_timestamp_ms_after),!1,i,g,void 0,c("LSVec").ofArray([]),(D||(D=d("LSIntEnum"))).ofNumber(h!=null?h:c("LSMEBTaskCreationSource").UNKNOWN),b)},"readwrite",void 0,void 0,f.id+":1033")}))}g.query=I;g.messageRangeQueryWithPersistence_DEPRECATED_DO_NOT_USE=a}),98);
__d("EbFetchTimeoutMsForMLv2",["justknobx"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("justknobx")._("3074")}g["default"]=a}),98);
__d("EncryptedBackupdDYIFileSaver",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("file-saver").__setRef("EncryptedBackupdDYIFileSaver");function a(a,b){h.onReadyImmediately(function(c){c=c.saveAs;c(b,a)})}g.saveFile=a}),98);
__d("FDSArrowsCircleFilled24PNGIcon.react",["ix","fbicon"],(function(a,b,c,d,e,f,g,h){"use strict";a=d("fbicon")._(h("538038"),24);b=a;g["default"]=b}),98);
__d("LSBumpE2EEMetadataThread",["LSCancelTaskByQueueName","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("bump_timestamp_ms",a[1]),d[0].set("thread_key",a[0]),d[0].set("bumped_by_local_device_send",a[2]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[0].set("wa_jid",void 0),d[0].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[0].set("message_product_type",void 0),d[0].set("is_message_deletion",!1),d[0].set("is_unbump",a[3]),d[1]=d[0].get("thread_key"),c.storedProcedure(b("LSCancelTaskByQueueName"),c.i64.to_string(d[1]),c.i64.cast([0,389]))},function(e){return d[2]=new c.Map(),d[2].set("bump_timestamp_ms",a[1]),d[2].set("thread_key",a[0]),d[2].set("bumped_by_local_device_send",a[2]),d[2].set("tam_thread_subtype",c.i64.cast([0,0])),d[2].set("wa_jid",void 0),d[2].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[2].set("message_product_type",void 0),d[2].set("is_message_deletion",!1),d[2].set("is_unbump",a[3]),d[3]=d[2].get("thread_key"),d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[3]),c.i64.cast([0,389]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxBumpE2EEMetadataThreadStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSBumpE2EEMetadataThreadStoredProcedure",["LSBumpE2EEMetadataThread","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSBumpE2EEMetadataThread"),e.threadKey,e.serverAuthoritativeTimestampMs,e.bumpedByLocalDeviceSend,e.isUnbump);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSCreateE2EEMetadataThread",["LSArrayGetObjectAt","LSBase64Encode.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop","LSQplAnnotateString.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][createE2EEMetadataThread] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[19]=new c.Map(),d[19].set("error_msg","Expected a nonempty query result"),d[19].set("code",c.i64.cast([0,3])),d[19].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[20]=c.createArray(),d[21]=(d[20].push(d[19]),d[20]),e=[void 0,d[20]],d[2]=e[0],d[3]=e[1]):(b=a.item,d[19]=new c.Map(),d[19].set("backup_id",b.backupId),d[19].set("device_public_key_blob",b.devicePublicKeyBlob),d[19].set("device_private_key_blob",b.devicePrivateKeyBlob),d[19].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[19].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[19].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[19].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[19].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[19].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[19].set("orf_client_state_v2_blob",void 0),d[19].set("orf_v2_authority_level",void 0),d[19].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[19].set("device_id",b.deviceId),d[19].set("backup_tenancy",b.backupTenancy),d[19].set("encryption_version",b.encryptionVersion),d[19].set("revision_version",b.revisionVersion),d[19].set("initialize_restore_result",void 0),d[19].set("device_creation_timestamp_sec",void 0),d[19].set("authority_level",b.authorityLevel),e=[d[19],void 0],d[2]=e[0],d[3]=e[1])})},function(a){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(a){return d[19]=d[6].get("backup_id"),d[20]=d[6].get("device_public_key_blob"),d[21]=d[6].get("device_private_key_blob"),d[22]=d[6].get("epoch_storage_public_key_blob"),d[23]=d[6].get("epoch_storage_private_key_blob"),d[24]=d[6].get("epoch_auth_public_key_blob"),d[25]=d[6].get("epoch_auth_private_key_blob"),d[26]=d[6].get("mailbox_root_key_blob"),d[27]=d[6].get("ocmf_client_state_blob"),d[28]=d[6].get("orf_client_state_v2_blob"),d[29]=d[6].get("orf_v2_authority_level"),d[30]=d[6].get("oblivious_validation_token_blob"),d[31]=d[6].get("device_id"),d[32]=d[6].get("backup_tenancy"),d[33]=d[6].get("encryption_version"),d[34]=d[6].get("revision_version"),d[35]=d[6].get("initialize_restore_result"),d[36]=d[6].get("device_creation_timestamp_sec"),d[37]=d[6].get("authority_level"),c.i64.neq(d[31],void 0)?c.sequence([function(a){return d[39]=void 0,c.i64.neq(d[39],void 0)?c.resolve(d[40]=d[39]):c.sequence([function(a){return d[52]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[53]?d[62]=(d[52].push(c.i64.cast([0,0])),d[52]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[54]=a[0],a})},function(a){return d[54]?d[62]=(d[52].push(c.i64.cast([0,2])),d[52]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[55]=a[0],a})},function(a){return d[55]?d[62]=(d[52].push(c.i64.cast([0,3])),d[52]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[56]?d[62]=(d[52].push(c.i64.cast([0,4])),d[52]):0,d[57]=c.createArray(),d[58]=c.i64.of_int32(d[52].length),c.i64.gt(d[58],c.i64.cast([0,0]))?c.loopAsync(d[58],function(a){return d[62]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[52],d[62]).then(function(a){return a=a,d[63]=a[0],d[64]=a[1],a})},function(a){return d[65]=(d[57].push(d[63]),d[57])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[62]=c.createArray(),d[63]=c.i64.of_int32(d[57].length),c.i64.gt(d[63],c.i64.cast([0,0]))?c.loopAsync(d[63],function(a){return d[65]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[57],d[65]).then(function(a){return a=a,d[66]=a[0],d[67]=a[1],a})},function(a){return d[68]=(d[62].push(c.i64.to_string(d[66])),d[62])}])}):c.resolve()},function(a){return d[64]=d[62].join(","),d[59]=d[64]}])},function(a){return d[57].some(function(a){return c.i64.eq(d[33],a)})?d[60]=d[33]:d[60]=void 0,c.i64.neq(d[60],void 0)?d[61]=d[60]:d[61]=void 0,d[40]=d[61]}])},function(a){return c.i64.neq(d[40],void 0)?d[41]=d[40]:d[41]=c.i64.cast([0,0]),c.i64.neq(d[32],void 0)?d[42]=d[32]:d[42]=c.i64.cast([0,1]),c.nativeOperation(b("LSBase64Encode.nop"),d[27]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[26]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[45]=new c.Map(),d[45].set("ocmf_client_state_blob",d[43]==null?"":d[43]),d[45].set("mailbox_root_key",d[44]==null?"":d[44]),d[46]=c.createArray(),c.forEach(c.filter(c.db.table(169).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),function(a){a=a.item;return d[52]=(d[46].push(a.epochId),d[46])})},function(a){return d[50]="Queried locally available epochs. Count: ",d[47]=c.i64.of_int32(d[46].length),d[51]=c.i64.to_string(d[47]),d[48]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[48],d[50],d[48],d[51]].join("")),c.resolve()},function(a){return d[49]=new c.Map(),d[49].set("device_id",d[31]),d[49].set("raw_tokens",d[45]),d[49].set("locally_available_epochs",d[46]),d[38]=d[49]}]):c.resolve(d[38]=void 0)},function(a){return d[7]=d[38]}]):c.resolve((d[19]=d[5].get("errors"),d[20]=d[5].get("errors"),d[7]=void 0))},function(a){return d[8]=c.i64.random(),d[9]=void 0==null?c.i64.to_string(d[8]):void 0,d[9]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,679677570]),d[9],!0,void 0):c.resolve()},function(a){return d[9]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,679677570]),d[9],"issue_task"):c.resolve()},function(a){return d[9]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,679677570]),d[9],"request_type","THREAD_POINT_QUERY"):c.resolve()},function(e){return d[10]=new c.Map(),d[10].set("wa_jid",a[0]),d[10].set("offline_thread_key",a[1]),d[10].set("thread_type",a[2]),d[10].set("folder_type",a[3]),d[10].set("bump_timestamp_ms",a[4]),d[10].set("tam_thread_subtype",c.i64.cast([0,0])),d[10].set("created_by_local_device",a[5]),d[10].set("device_context",d[7]),d[10].set("qpl_instance_key",d[9]),d[11]=d[10].get("offline_thread_key"),d[12]=c.toJSON(d[10]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[11]),c.i64.cast([0,388]),d[12],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[13]=c.i64.of_float(Date.now()),d[14]=c.i64.random(),d[16]="Finishing execution. Execution time: ",d[17]=c.i64.to_string(c.i64.sub(d[13],d[0])),d[18]=" ms",d[15]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][createE2EEMetadataThread] ",d[15],d[16],d[15],d[17],d[15],d[18]].join("")),c.i64.eq(c.i64.mod_(d[14],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[19]=",",d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"createE2EEMetadataThread",[d[16],d[19],d[17],d[19],d[18]].join(""),d[20],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxCreateE2EEMetadataThreadStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSCreateE2EEMetadataThreadStoredProcedure",["LSCreateE2EEMetadataThread","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSCreateE2EEMetadataThread"),e.waJid,e.offlineThreadKey,e.threadType,e.folderType,e.bumpTimestampMs,e.createdByLocalDevice);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSCreateOfflineThreadingIDStoredProcedure",["LSCreateOfflineThreadingID","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSCreateOfflineThreadingID"),e.timestampMs);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSDataUseConsentState",[],(function(a,b,c,d,e,f){a=Object.freeze({UNSET:0,CONSENTED:1,WITHDRAWN:2,NOT_APPLICABLE:3,SEEN:4});f["default"]=a}),66);
__d("MWPakeQPLEvents",["qpl"],(function(a,b,c,d,e,f,g){"use strict";a=c("qpl")._(231349365,"1751");g.pakeInitiatorQplEvent=a}),98);
__d("PAKEMessageQplLoggingAction",[],(function(a,b,c,d,e,f){a=Object.freeze({ADD_MARKER:0,END_SUCCESS:1,END_FAILURE:2,ADD_ERROR_ANNOTATION:3});f["default"]=a}),66);
__d("LSQplInteractionHelper.nop",["FBLogger","I64","MWPakeQPLEvents","PAKEMessageQplLoggingAction","Promise","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f,g,j){a=(i||(i=d("I64"))).to_int32(g);switch(a){case c("PAKEMessageQplLoggingAction").ADD_MARKER:f==null?c("FBLogger")("wmi_eb").mustfix("PAKE: markerName is null when adding DS PAKE marker."):c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,f);break;case c("PAKEMessageQplLoggingAction").END_FAILURE:f==null?c("FBLogger")("wmi_eb").mustfix("PAKE: markerName is null when adding failure DS PAKE marker."):c("QPLUserFlow").endFailure(d("MWPakeQPLEvents").pakeInitiatorQplEvent,f);break;case c("PAKEMessageQplLoggingAction").END_SUCCESS:c("QPLUserFlow").endSuccess(d("MWPakeQPLEvents").pakeInitiatorQplEvent);break;case c("PAKEMessageQplLoggingAction").ADD_ERROR_ANNOTATION:j==null?c("FBLogger")("wmi_eb").mustfix("PAKE: pakeMessageType is null when annotating PAKE error."):c("QPLUserFlow").addAnnotations(d("MWPakeQPLEvents").pakeInitiatorQplEvent,{"int":{errorCode:(i||(i=d("I64"))).to_int32(j)}});break}return(h||(h=b("Promise"))).resolve()};a.__nop_name__="LSQplInteractionHelper";g["default"]=a}),98);
__d("LSDecryptPakeSecret",["LSLogMebClientEvent.nop","LSQplInteractionHelper.nop","LSSymmetricEncryptionCreateDecryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][decryptPakeSecret] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_NO_SESSION_ONGOING_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[12]="PAKE: Failed to decrypt PAKE secrets as no session was ongoing.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,7]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,7]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,7])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[12]].join("")),d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[12]].join(""),d[13],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[2]=a[0],d[3]=a[1],a}]):(f=e.item,c.sequence([function(e){return d[13]=f.responderId,d[14]=f.initiatorId,d[15]=f.pakeSecret,d[13]!==void 0?c.sequence([function(e){return d[14]!==void 0?c.sequence([function(e){return d[15]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_GENERATE_PAKE_AAD_START",c.i64.cast([0,0]),void 0)},function(a){return d[20]="_",c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_NATIVE_OP_START",c.i64.cast([0,0]),void 0)},function(e){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),a[1],c.blobs.of_string(["v1",d[20],c.i64.to_string(a[0]),d[20],d[13],d[20],d[14],d[20],c.i64.to_string(f.clientType)].join("")),d[15]).then(function(a){return a=a,d[21]=a[0],a})},function(e){return d[21]!==void 0?c.resolve((e=[d[21],c.i64.cast([0,0])],d[22]=e[0],d[23]=e[1],e)):c.sequence([function(a){return d[25]="PAKE: Failed to decrypt PAKE secrets as key was incorrect.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,10]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,10]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,10])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[25]].join("")),d[26]=c.createArray(),void 0!==void 0?d[27]=(d[26].push(void 0),d[26]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[25]].join(""),d[26],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967295])],d[22]=a[0],d[23]=a[1],a}])},function(a){return a=[d[22],d[23]],d[18]=a[0],d[19]=a[1],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_PAKE_SECRET_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[21]="PAKE: Failed to decrypt PAKE secrets as there was no secret to decrypt.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[21]].join("")),d[22]=c.createArray(),void 0!==void 0?d[23]=(d[22].push(void 0),d[22]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[21]].join(""),d[22],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[18]=a[0],d[19]=a[1],a}])},function(a){return a=[d[18],d[19]],d[16]=a[0],d[17]=a[1],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_INITIATOR_ID_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[19]="PAKE: Failed to decrypt PAKE secrets as initiator id was null.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[19]].join("")),d[20]=c.createArray(),void 0!==void 0?d[21]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[19]].join(""),d[20],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[16]=a[0],d[17]=a[1],a}])},function(a){return a=[d[16],d[17]],d[11]=a[0],d[12]=a[1],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_DECRYPT_SECRET_RESPONDER_ID_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return d[17]="PAKE: Failed to decrypt PAKE secrets as responder id was null.",c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[2])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[2]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})},function(a){return function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSPakeMessagesDecryptPakeSecretStoredProcedure] ","",d[17]].join("")),d[18]=c.createArray(),void 0!==void 0?d[19]=(d[18].push(void 0),d[18]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSPakeMessagesDecryptPakeSecretStoredProcedure",[d[17]].join(""),d[18],c.i64.cast([0,3]))},function(a){return a=[void 0,c.i64.cast([-1,4294967294])],d[11]=a[0],d[12]=a[1],a}])},function(a){return a=[d[11],d[12]],d[2]=a[0],d[3]=a[1],a}]))})},function(a){return d[5]=c.i64.of_float(Date.now()),d[6]=c.i64.random(),d[8]="Finishing execution. Execution time: ",d[9]=c.i64.to_string(c.i64.sub(d[5],d[0])),d[10]=" ms",d[7]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][decryptPakeSecret] ",d[7],d[8],d[7],d[9],d[7],d[10]].join("")),c.i64.eq(c.i64.mod_(d[6],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[11]=",",d[12]=c.createArray(),void 0!==void 0?d[13]=(d[12].push(void 0),d[12]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"decryptPakeSecret",[d[8],d[11],d[9],d[11],d[10]].join(""),d[12],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[2],d[3]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSPakeMessagesDecryptPakeSecretStoredProcedure";a.__tables__=["pake_messages"];e.exports=a}),null);
__d("LSDecryptPakeSecretStoredProcedure",["LSDecryptPakeSecret","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDecryptPakeSecret"),e.sessionId,e.encryptionKey,e.clientType);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSFinishAddPeerDevice",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateSignature_v2.nop","LSDeleteBackupOnClient","LSGenerateLocalKeys","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Beginning execution."),c.sequence([function(a){return void 0!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),void 0,c.i64.cast([0,1434]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[8]=a[0],a})},function(a){return d[8]?d[9]=!0:d[9]=!1,d[9]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[11]].join("")),d[10]=c.createArray(),void 0!==void 0?d[12]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[11],d[10],c.i64.cast([0,3]))):c.resolve()}])},function(e){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(e,f){f=e.done;e=e.value;return f?c.sequence([function(a){return c.db.table(168).fetch().next().then(function(a,d){var e=a.done;a=a.value;return e?0:(d=a.item,c.storedProcedure(b("LSDeleteBackupOnClient"),d.backupId,void 0,!1,void 0,"null",!0))})},function(e){return d[8]=a[0].get("backup_id"),c.storedProcedure(b("LSGenerateLocalKeys"),!1).then(function(a){return a=a,d[9]=a[0],d[10]=a[1],a})},function(e){return d[9]!==void 0?c.sequence([function(a){return d[11]=d[9].get("device_key"),d[12]=d[9].get("epoch_storage_key"),d[13]=d[9].get("epoch_auth_key"),d[14]=d[11].get("device_private_key"),d[15]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]?d[44]=(d[15].push(c.i64.cast([0,0])),d[15]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[17]=a[0],a})},function(a){return d[17]?d[44]=(d[15].push(c.i64.cast([0,2])),d[15]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[18]?d[44]=(d[15].push(c.i64.cast([0,3])),d[15]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[44]=(d[15].push(c.i64.cast([0,4])),d[15]):0,d[20]="",d[21]=c.i64.of_int32(d[15].length),c.i64.gt(d[21],c.i64.cast([0,0]))?c.loopAsync(d[21],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[15],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[20]=[d[20],"_",c.i64.to_string(d[45])].join("")}])}):c.resolve()},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),["supported_versions_",d[20],"revision_version_",c.i64.to_string(c.i64.cast([0,1]))].join("")).then(function(a){return a=a,d[22]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[14],c.blob("Mg=="),d[22]).then(function(a){return a=a,d[23]=a[0],a})},function(a){return c.blobs.neq(d[23],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[23]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[24]=d[44]}]):c.resolve(d[24]=void 0)},function(e){return d[25]=a[0].get("temp_ocmf_client_state"),c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),d[25]).then(function(a){return a=a,d[26]=a[0],d[27]=a[1],a})},function(a){return c.blobs.neq(void 0,void 0)?c.sequence([function(a){return c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),void 0).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],a})},function(a){return a=[d[26],d[27],d[44],d[45]],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],a}]):c.resolve((a=[d[26],d[27],void 0,void 0],d[28]=a[0],d[29]=a[1],d[30]=a[2],d[31]=a[3],a))},function(b){return d[32]=d[11].get("device_public_key"),d[33]=d[11].get("device_private_key"),d[34]=d[12].get("epoch_storage_public_key"),d[35]=d[12].get("epoch_storage_private_key"),d[36]=d[13].get("epoch_auth_public_key"),d[37]=d[13].get("epoch_auth_private_key"),d[38]=a[0].get("mailbox_root_key"),d[39]=a[0].get("oblivious_validation_token"),c.forEach(c.filter(c.db.table(168).fetch([[[d[8]]]]),function(a){return c.i64.eq(a.backupId,d[8])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(168).add({backupId:d[8],devicePublicKeyBlob:d[32],devicePrivateKeyBlob:d[33],epochStoragePublicKeyBlob:d[34],epochStoragePrivateKeyBlob:d[35],epochAuthPublicKeyBlob:d[36],epochAuthPrivateKeyBlob:d[37],mailboxRootKeyBlob:d[38],ocmfClientStateBlob:d[28],obliviousValidationTokenBlob:d[39],authorityLevel:c.i64.cast([0,20]),backupTenancy:c.i64.cast([0,1]),revisionVersion:c.i64.cast([0,1]),encryptionVersion:c.i64.cast([0,0])})},function(e){return d[40]=a[0].get("add_peer_epoch_data"),d[41]=c.i64.of_int32(d[40].length),c.i64.gt(d[41],c.i64.cast([0,0]))?c.loopAsync(d[41],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[40],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[45].get("epoch_id"),d[48]=d[45].get("epoch_anon_id"),d[49]=d[45].get("epoch_root_key"),d[50]=d[45].get("epoch_status"),d[51]=d[45].get("epoch_head"),c.forEach(c.filter(c.db.table(169).fetch([[[d[47]]]]),function(a){return c.i64.eq(a.epochId,d[47])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,80]))}),function(a){return a["delete"]()})},function(a){return c.db.table(169).add({epochId:d[47],authorityLevel:c.i64.cast([0,80]),backupId:d[8],epochAnonIdBlob:d[48],epochRootKeyBlob:d[49],epochStatus:d[50],epochHead:d[51]})}])}):c.resolve()},function(a){return c.count(c.db.table(169).fetch()).then(function(a){return d[42]=a})},function(a){return c.i64.le(d[42],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch().next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return d[46]="No epoch available in epochs table",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[46]].join("")),d[47]=c.createArray(),void 0!==void 0?d[48]=(d[47].push(void 0),d[47]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[46]].join(""),d[47],c.i64.cast([0,3]))},function(a){return d[44]=void 0}]):(e=a.item,d[46]=new c.Map(),d[46].set("epoch_id",e.epochId),d[46].set("backup_id",e.backupId),d[46].set("epoch_anon_id_blob",e.epochAnonIdBlob),d[46].set("epoch_root_key_blob",e.epochRootKeyBlob),d[46].set("epoch_status",e.epochStatus),d[46].set("epoch_head",e.epochHead),d[46].set("authority_level",e.authorityLevel),d[44]=d[46])})},function(a){return d[43]=d[44]}]):c.sequence([function(a){return d[44]="Multiple epochs available in epochs table",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[44]].join("")),d[45]=c.createArray(),void 0!==void 0?d[46]=(d[45].push(void 0),d[45]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[44]].join(""),d[45],c.i64.cast([0,3]))},function(a){return d[43]=void 0}])},function(e){return d[43]!==void 0?c.sequence([function(a){return d[44]=d[43].get("epoch_anon_id_blob"),d[45]=d[43].get("epoch_root_key_blob"),d[46]=d[11].get("device_public_key"),d[47]=c.createArray(),d[51]=(d[47].push(c.i64.cast([0,32])),d[47]),c.nativeOperation(b("LSBase64Encode.nop"),d[44]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[48]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blobs.of_string(["epoch_devices","_",d[48]].join("")),void 0,d[45],d[47]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return d[51]?d[52]=!1:d[52]=!0,d[52]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),d[55]="THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[55]].join("")),d[54]=c.createArray(),void 0!==void 0?d[57]=(d[54].push(void 0),d[54]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[55],d[54],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[53]=d[56]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[51],c.i64.cast([0,0])).then(function(a){return a=a,d[54]=a[0],d[55]=a[1],a})},function(a){return d[53]=d[54]}])},function(a){return d[49]=d[53]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),d[52]="THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBCryptoEpochUtils] ","",d[52]].join("")),d[51]=c.createArray(),void 0!==void 0?d[54]=(d[51].push(void 0),d[51]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils",d[52],d[51],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[49]=d[53]}])},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),d[49],d[46]).then(function(a){return a=a,d[50]=a[0],a})},function(e){return c.blobs.neq(d[50],void 0)?c.sequence([function(a){return d[51]=d[11].get("device_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[51]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[50]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[54]=d[43].get("epoch_root_key_blob"),c.blobs.neq(d[54],void 0)?c.sequence([function(a){return d[81]=c.createArray(),d[87]=(d[81].push(c.i64.cast([0,18])),d[81]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[54],d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return d[82]!==void 0?c.sequence([function(a){return d[87]=c.i64.of_int32(d[82].length),c.i64.ge(d[87],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[82],c.i64.cast([0,0])).then(function(a){return a=a,d[89]=a[0],d[90]=a[1],a})},function(a){return d[88]=d[89]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[90]="CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[90]].join("")),d[89]=c.createArray(),void 0!==void 0?d[91]=(d[89].push(void 0),d[89]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[90],d[89],c.i64.cast([0,3]))},function(a){return d[88]=void 0}])},function(a){return d[83]=d[88]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[88]="CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBFingerprint] ","",d[88]].join("")),d[87]=c.createArray(),void 0!==void 0?d[89]=(d[87].push(void 0),d[87]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint",d[88],d[87],c.i64.cast([0,3]))},function(a){return d[83]=void 0}])},function(a){return c.blobs.neq(d[83],void 0)?d[84]=!0:d[84]=!1,d[84]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[83]).then(function(a){return a=a,d[85]=a[0],a})},function(a){return d[85]!==void 0?d[86]=d[85]:d[86]="encodingfailed",d[55]=d[86]}]):c.resolve(d[55]="null")},function(a){return d[56]=d[12].get("epoch_storage_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[58]=d[9].get("epoch_storage_public_key_sig"),c.nativeOperation(b("LSBase64Encode.nop"),d[58]).then(function(a){return a=a,d[59]=a[0],a})},function(a){return d[60]=d[13].get("epoch_auth_public_key"),c.nativeOperation(b("LSBase64Encode.nop"),d[60]).then(function(a){return a=a,d[61]=a[0],a})},function(a){return d[62]=d[9].get("epoch_auth_public_key_sig"),c.nativeOperation(b("LSBase64Encode.nop"),d[62]).then(function(a){return a=a,d[63]=a[0],a})},function(e){return d[64]=d[11].get("device_private_key"),d[65]=a[0].get("mailbox_root_key"),d[66]=d[12].get("epoch_storage_private_key"),c.blobs.neq(d[65],void 0)?c.sequence([function(a){return d[81]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[65],"private_key",d[64],c.i64.cast([0,1]),d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return c.blobs.neq(d[82],void 0)?d[83]=d[82]:d[83]=void 0,d[67]=d[83]}]):c.resolve(d[67]=void 0)},function(a){return c.blobs.neq(d[67],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[67]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[68]=d[81]}]):c.resolve(d[68]=void 0)},function(a){return c.blobs.neq(d[65],void 0)?c.sequence([function(a){return d[81]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[65],"ocmf_client_state",d[28],c.i64.cast([0,1]),d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return c.blobs.neq(d[82],void 0)?d[83]=d[82]:d[83]=void 0,d[69]=d[83]}]):c.resolve(d[69]=void 0)},function(a){return c.blobs.neq(d[69],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[69]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[70]=d[81]}]):c.resolve(d[70]=void 0)},function(a){return c.blobs.neq(d[65],void 0)?c.sequence([function(a){return d[81]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[65],"epoch_storage_private_key",d[66],c.i64.cast([0,1]),d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return c.blobs.neq(d[82],void 0)?d[83]=d[82]:d[83]=void 0,d[71]=d[83]}]):c.resolve(d[71]=void 0)},function(a){return c.blobs.neq(d[71],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[71]).then(function(a){return a=a,d[81]=a[0],a})},function(a){return d[72]=d[81]}]):c.resolve(d[72]=void 0)},function(e){return d[73]=a[0].get("backup_id"),c.nativeOperation(b("LSBase64Encode.nop"),d[29]).then(function(a){return a=a,d[74]=a[0],a})},function(e){return d[75]=a[0].get("server_data_id"),d[76]=d[43].get("epoch_id"),d[77]=new c.Map(),d[77].set("supported_encryption_versions",d[15]),d[77].set("client_version",c.i64.cast([0,1])),d[77].set("version_sig",d[24]==null?"":d[24]),d[78]=new c.Map(),d[78].set("backup_id",d[73]),d[78].set("device_epoch_hmac",d[53]==null?"":d[53]),d[78].set("epoch_root_key_fingerprint",d[55]),d[78].set("device_public_key",d[52]==null?"":d[52]),d[78].set("epoch_auth_pubkey",d[61]==null?"":d[61]),d[78].set("epoch_auth_pubkey_sig",d[63]==null?"":d[63]),d[78].set("epoch_storage_pubkey",d[57]==null?"":d[57]),d[78].set("epoch_storage_pubkey_sig",d[59]==null?"":d[59]),d[78].set("ocmf_rotation_token",d[74]==null?"":d[74]),d[78].set("server_data_id",d[75]),d[78].set("device_registration_id",a[1]),d[78].set("base_epoch_id",d[76]),d[78].set("encryption_version_data",d[77]),d[78].set("private_key_debug_token",d[68]),d[78].set("ocmf_client_state_debug_token",d[70]),d[78].set("epoch_storage_pvtkey_debug_token",d[72]),d[78].set("trace_id",void 0),d[78].set("occam_only_eligible",!0),d[79]=c.toJSON(d[78]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",c.i64.cast([0,50017]),d[79],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[80]=a[0],a})}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] $device_epoch_hmac found to be null"),d[51]=c.createArray(),void 0!==void 0?d[52]=(d[51].push(void 0),d[51]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","$device_epoch_hmac found to be null",d[51],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[8],"backup_init_flow",!0,void 0,void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! There should be exactly one open epoch. Deleting local state and terminating device addition"),d[44]=c.createArray(),void 0!==void 0?d[45]=(d[44].push(void 0),d[44]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! There should be exactly one open epoch. Deleting local state and terminating device addition",d[44],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[8],"backup_init_flow",!0,void 0,void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] Error! Error in generating the keys. Deleting local state and terminating device addition"),d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure","Error! Error in generating the keys. Deleting local state and terminating device addition",d[11],c.i64.cast([0,3]))},function(a){return c.storedProcedure(b("LSDeleteBackupOnClient"),d[8],"backup_init_flow",!0,void 0,void 0,!1)},function(a){return c.forEach(c.db.table(169).fetch(),function(a){return a["delete"]()})}])}]):(e.item,d[8]="An authoritative row already exists, aborting execution of add peer device",d[8]!==void 0?(function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ","",d[8]].join("")),d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",d[8],d[9],c.i64.cast([0,3]))):c.resolve())})},function(a){return d[2]=c.i64.of_float(Date.now()),d[3]=c.i64.random(),d[5]="Finishing execution. Execution time: ",d[6]=c.i64.to_string(c.i64.sub(d[2],d[0])),d[7]=" ms",d[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure] ",d[4],d[5],d[4],d[6],d[4],d[7]].join("")),c.i64.eq(c.i64.mod_(d[3],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[8]=",",d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure",[d[5],d[8],d[6],d[8],d[7]].join(""),d[9],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsFinishAddPeerDeviceStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","secure_encrypted_backups_epochs"];e.exports=a}),null);
__d("LSDeserializeSecretsAndAddDevice",["LSArrayGetObjectAt","LSBase64Decode.nop","LSDeserializeFromJsonIntoDictionaryV2.nop","LSFinishAddPeerDevice","LSQplInteractionHelper.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_START",c.i64.cast([0,0]),void 0)},function(e){return c.nativeOperation(b("LSDeserializeFromJsonIntoDictionaryV2.nop"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"MEB_DS_DESERIALIZE_SECRETS_NATIVE_OP_END",c.i64.cast([0,0]),void 0)},function(a){return d[1]=d[0].get("temp_ocmf_client_state"),c.nativeOperation(b("LSBase64Decode.nop"),d[1]).then(function(a){return a=a,d[2]=a[0],a})},function(a){return d[3]=d[0].get("mailbox_root_key"),c.nativeOperation(b("LSBase64Decode.nop"),d[3]).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[5]=d[0].get("oblivious_validation_token"),c.nativeOperation(b("LSBase64Decode.nop"),d[5]).then(function(a){return a=a,d[6]=a[0],a})},function(a){return d[7]=c.createArray(),d[8]=d[0].get("add_peer_epoch_data_serializable"),d[9]=c.i64.of_int32(d[8].length),c.i64.gt(d[9],c.i64.cast([0,0]))?c.loopAsync(d[9],function(a){return d[14]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[8],d[14]).then(function(a){return a=a,d[15]=a[0],d[16]=a[1],a})},function(a){return d[17]=d[15].get("epoch_anon_id"),c.nativeOperation(b("LSBase64Decode.nop"),d[17]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return d[19]=d[15].get("epoch_root_key"),c.nativeOperation(b("LSBase64Decode.nop"),d[19]).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[21]=d[15].get("epoch_id"),d[22]=d[15].get("epoch_status"),d[23]=new c.Map(),d[23].set("epoch_id",d[21]),d[23].set("epoch_anon_id",d[18]==null?c.blob(""):d[18]),d[23].set("epoch_root_key",d[20]==null?c.blob(""):d[20]),d[23].set("epoch_status",d[22]),d[24]=d[15].get("epoch_head"),d[24]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSBase64Decode.nop"),d[24]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[23].set("epoch_head",d[25])}]):c.resolve()},function(a){return d[25]=(d[7].push(d[23]),d[7])}])}):c.resolve()},function(e){return d[10]=d[0].get("backup_id"),d[11]=d[0].get("server_data_id"),d[12]=new c.Map(),d[12].set("backup_id",d[10]),d[12].set("server_data_id",d[11]),d[12].set("temp_ocmf_client_state",d[2]==null?c.blob(""):d[2]),d[12].set("mailbox_root_key",d[4]==null?c.blob(""):d[4]),d[12].set("oblivious_validation_token",d[6]==null?c.blob(""):d[6]),d[12].set("add_peer_epoch_data",d[7]),d[12]!==void 0?c.sequence([function(e){return c.storedProcedure(b("LSFinishAddPeerDevice"),d[12],a[1])},function(a){return d[13]=!0}]):c.resolve(d[13]=!1)},function(a){return e[0]=d[13]}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsDeserializeSecretsAndAddDeviceStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSDeserializeSecretsAndAddDeviceStoredProcedure",["LSDeserializeSecretsAndAddDevice","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSDeserializeSecretsAndAddDevice"),e.serializedPayload,e.deviceRegistrationId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSEncryptedBackupsOnboardingDecision",[],(function(a,b,c,d,e,f){a=Object.freeze({FAILURE:-1,NO_DECISION_MADE:0,BACKUP_CREATED:1,STORE_ON_DEVICE_ONLY:2});f["default"]=a}),66);
__d("LSEncryptedBackupsVirtualDeviceType",[],(function(a,b,c,d,e,f){a=Object.freeze({OFFLINE:1,HSM:2,BLOCK_STORE:3,KEYCHAIN:5,ICLOUD_KVS:6,GOOGLE_DRIVE:7,CLOUDKIT:8,ICLOUD_DRIVE:9,PASSKEY:10,ICLOUD_KEYCHAIN:11,GOOGLE_ONE_AUTO_BACKUP:12,SECURITY_QUESTION_HSM:13,TRUSTED_CONTACT:14,META_OWNED:15});f["default"]=a}),66);
__d("LSFetchAccountSyncedFields",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return d[0]=new c.Map(),d[1]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),"fetch_account_synced_fields",c.i64.cast([0,160021]),d[1],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}a.__sproc_name__="LSAccountSettingsFetchAccountSyncedFieldsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSFetchAccountSyncedFieldsStoredProcedure",["LSFetchAccountSyncedFields","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a){a=a.storedProcedure(c("LSFetchAccountSyncedFields"));return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSFetchBackupsMetadata",["LSAppendDataTraceAddon","LSIsMobileClient","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","justknobx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(a){return d.sequence([function(a){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchBackupsMetadataStoredProcedure] Beginning execution."),c("justknobx")._("1101")?d.sequence([function(a){return d.sequence([function(a){return void 0!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),void 0,d.i64.cast([0,1478]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[9]=a[0],a})},function(a){return e[9]?e[10]=!0:e[10]=!1,e[10]&&!0?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[12]="LSDataTraceMciTraceLog native op not supported",function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",e[12]].join("")),e[11]=d.createArray(),void 0!==void 0?e[13]=(e[11].push(void 0),e[11]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",e[12],e[11],d.i64.cast([0,3]))):d.resolve()}])},function(a){return d.forEach(d.db.table(196).fetch(),function(a){return a["delete"]()})},function(a){return d.db.table(172).fetch([[[d.i64.cast([0,1])]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?e[7]=void 0:(b=a.item,e[7]=b.backupId)})},function(a){return d.i64.neq(e[7],void 0)?d.sequence([function(a){return d.forEach(d.filter(d.db.table(196).fetch([[[e[7]]]]),function(a){return d.i64.eq(a.backupId,e[7])&&d.i64.lt(a.authorityLevel,d.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return d.db.table(196).add({backupId:e[7],authorityLevel:d.i64.cast([0,20]),backupSize:d.i64.cast([0,0]),creationTime:d.i64.cast([0,0]),lastSyncTime:d.i64.cast([0,0])})},function(a){return e[9]=new d.Map(),e[9].set("trace_id",void 0),e[10]=d.toJSON(e[9]),d.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"encrypted_backups_setup",d.i64.cast([0,50022]),e[10],d.i64.cast([0,0]),d.i64.cast([0,93]),d.i64.cast([0,0]),void 0,d.i64.cast([0,0])).then(function(a){return a=a,e[11]=a[0],a})}]):d.sequence([function(a){return e[9]="Backup is not initialized",e[9]!==void 0?(function(a){d.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsFetchBackupsMetadataStoredProcedure] ","",e[9]].join("")),e[10]=d.createArray(),void 0!==void 0?e[11]=(e[10].push(void 0),e[10]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchBackupsMetadataStoredProcedure",e[9],e[10],d.i64.cast([0,3]))):d.resolve()},function(a){return d.forEach(d.db.table(196).fetch(),function(a){return a["delete"]()})},function(a){return d.forEach(d.filter(d.db.table(196).fetch([[[d.i64.cast([-1,4294967295])]]]),function(a){return d.i64.eq(a.backupId,d.i64.cast([-1,4294967295]))&&d.i64.lt(a.authorityLevel,d.i64.cast([0,80]))}),function(a){return a["delete"]()})},function(a){return d.db.table(196).add({backupId:d.i64.cast([-1,4294967295]),authorityLevel:d.i64.cast([0,80]),backupSize:d.i64.cast([-1,4294967295]),creationTime:d.i64.cast([-1,4294967295]),lastSyncTime:d.i64.cast([-1,4294967295])})}])}]):d.resolve(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchBackupsMetadataStoredProcedure] is_backup_metadata_enabled is disabled"))},function(a){return e[1]=d.i64.of_float(Date.now()),e[2]=d.i64.random(),e[4]="Finishing execution. Execution time: ",e[5]=d.i64.to_string(d.i64.sub(e[1],e[0])),e[6]=" ms",e[3]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsFetchBackupsMetadataStoredProcedure] ",e[3],e[4],e[3],e[5],e[3],e[6]].join("")),d.i64.eq(d.i64.mod_(e[2],d.i64.cast([0,1e3])),d.i64.cast([0,0]))?(e[7]=",",e[8]=d.createArray(),void 0!==void 0?e[9]=(e[8].push(void 0),e[8]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsFetchBackupsMetadataStoredProcedure",[e[4],e[7],e[5],e[7],e[6]].join(""),e[8],d.i64.cast([0,4]))):d.resolve()}])},function(a){return d.resolve(f)}])}a.__sproc_name__="LSEncryptedBackupsFetchBackupsMetadataStoredProcedure";a.__tables__=["encrypted_backups_metadata","encrypted_backups"];d=a;g["default"]=d}),98);
__d("LSFetchBackupsMetadataStoredProcedure",["LSFetchBackupsMetadata","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){e===void 0&&(e={});a=a.storedProcedure(c("LSFetchBackupsMetadata"),e.traceId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSFetchOTCEligibleEBDevicesV2",["LSIssueNewEbTaskAndGetTaskIDV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(a){return c.sequence([function(a){return c.forEach(c.db.table(261).fetch(),function(a){return a["delete"]()})},function(a){return d[0]="",c.forEach(c.filter(c.db.table(261).fetch([[[d[0]]]]),function(a){return a.deviceId===d[0]&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(261).add({deviceId:d[0],authorityLevel:c.i64.cast([0,20])})},function(a){return d[1]=new c.Map(),d[2]=c.toJSON(d[1]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"meb_fetch_otc_eligible_devices",c.i64.cast([0,50028]),d[2],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[3]=a[0],a})}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsFetchOTCEligibleEBDevicesV2StoredProcedure";a.__tables__=["encrypted_backups_otc_devices"];e.exports=a}),null);
__d("LSFetchOTCEligibleEBDevicesV2StoredProcedure",["LSFetchOTCEligibleEBDevicesV2","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a){a=a.storedProcedure(c("LSFetchOTCEligibleEBDevicesV2"));return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSGetActiveSession",["LSLogMebClientEvent.nop","LSQplInteractionHelper.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(b){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][getActiveSession] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.count(c.filter(c.db.table(258).fetch(),function(b){return c.i64.eq(b.messageType,c.i64.cast([0,0]))&&c.i64.eq(b.clientType,a[1])&&b.initiatorId===void 0||c.i64.eq(b.clientType,a[1])&&b.initiatorId===a[0]&&![c.i64.cast([0,1]),c.i64.cast([0,2]),c.i64.cast([0,3]),c.i64.cast([0,4]),c.i64.cast([0,21]),c.i64.cast([0,15]),c.i64.cast([0,23])].some(function(a){return c.i64.eq(b.messageType,a)})&&c.i64.neq(b.sessionId,c.i64.cast([-1,4294967295]))})).then(function(a){return d[2]=a})},function(e){return c.i64.le(d[2],c.i64.cast([0,1]))?c.sequence([function(e){return c.filter(c.db.table(258).fetch(),function(b){return c.i64.eq(b.messageType,c.i64.cast([0,0]))&&c.i64.eq(b.clientType,a[1])&&b.initiatorId===void 0||c.i64.eq(b.clientType,a[1])&&b.initiatorId===a[0]&&![c.i64.cast([0,1]),c.i64.cast([0,2]),c.i64.cast([0,3]),c.i64.cast([0,4]),c.i64.cast([0,21]),c.i64.cast([0,15]),c.i64.cast([0,23])].some(function(a){return c.i64.eq(b.messageType,a)})&&c.i64.neq(b.sessionId,c.i64.cast([-1,4294967295]))}).next().then(function(a,e){var f=a.done;a=a.value;return f?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,17]))},function(a){return a=[c.i64.cast([-1,4294967295]),void 0,void 0],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]):(e=a.item,c.sequence([function(a){return d[19]=e.responderId,d[19]!==void 0?c.resolve((a=[c.i64.cast([0,0]),e.sessionId,d[19]],d[16]=a[0],d[17]=a[1],d[18]=a[2],a)):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),"PAKE_DS_SESSION_ONGOING_RESPONDER_ID_NULL_FAILURE",c.i64.cast([0,0]),void 0)},function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(a){return a=[c.i64.cast([-1,4294967294]),void 0,void 0],d[16]=a[0],d[17]=a[1],d[18]=a[2],a}])},function(a){return a=[d[16],d[17],d[18]],d[12]=a[0],d[13]=a[1],d[14]=a[2],a}]))})},function(a){return a=[d[12],d[13],d[14]],d[3]=a[0],d[4]=a[1],d[5]=a[2],a}]):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,18]))},function(a){return a=[c.i64.cast([-1,4294967294]),void 0,void 0],d[3]=a[0],d[4]=a[1],d[5]=a[2],a}])},function(a){return d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][getActiveSession] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"getActiveSession",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[3],d[4],d[5]],e[0]=a[0],e[1]=a[1],e[2]=a[2],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSPakeMessagesGetActiveSessionStoredProcedure";a.__tables__=["pake_messages"];e.exports=a}),null);
__d("LSGetActiveSessionStoredProcedure",["LSGetActiveSession","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSGetActiveSession"),e.initiatorId,e.clientType);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSIssueAttachmentBackupTask",["LSArrayGetObjectAt","LSBase64Encode.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSQplAnnotateString.nop","LSQplMarkEnd.nop","LSQplMarkPoint.nop","LSQplStartTrace.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] Beginning execution."),a[5]!==void 0?c.resolve(d[1]=a[5]):c.sequence([function(a){return d[27]=c.i64.random(),d[28]=c.i64.to_string(d[27]),d[28]!==void 0?c.nativeOperation(b("LSQplStartTrace.nop"),c.i64.cast([0,637738637]),d[28],!0,void 0):c.resolve()},function(a){return d[1]=d[28]}])},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkPoint.nop"),c.i64.cast([0,637738637]),d[1],"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure_start"):c.resolve()},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0,void 0],d[2]=f[0],d[3]=f[1],d[4]=f[2],d[5]=f[3],d[6]=f[4],d[7]=f[5],d[8]=f[6],d[9]=f[7],d[10]=f[8],d[11]=f[9],d[12]=f[10],d[13]=f[11],d[14]=f[12],d[15]=f[13],d[16]=f[14],d[17]=f[15],d[18]=f[16],d[19]=f[17],f):(e=a.item,c.sequence([function(a){return d[32]=e.backupTenancy,d[31]=e.encryptionVersion,d[27]=void 0,c.i64.neq(d[27],void 0)?c.resolve(d[28]=d[27]):c.sequence([function(a){return d[33]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[34]=a[0],a})},function(a){return d[34]?d[43]=(d[33].push(c.i64.cast([0,0])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[43]=(d[33].push(c.i64.cast([0,2])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[43]=(d[33].push(c.i64.cast([0,3])),d[33]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[43]=(d[33].push(c.i64.cast([0,4])),d[33]):0,d[38]=c.createArray(),d[39]=c.i64.of_int32(d[33].length),c.i64.gt(d[39],c.i64.cast([0,0]))?c.loopAsync(d[39],function(a){return d[43]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[33],d[43]).then(function(a){return a=a,d[44]=a[0],d[45]=a[1],a})},function(a){return d[46]=(d[38].push(d[44]),d[38])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[43]=c.createArray(),d[44]=c.i64.of_int32(d[38].length),c.i64.gt(d[44],c.i64.cast([0,0]))?c.loopAsync(d[44],function(a){return d[46]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[38],d[46]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return d[49]=(d[43].push(c.i64.to_string(d[47])),d[43])}])}):c.resolve()},function(a){return d[45]=d[43].join(","),d[40]=d[45]}])},function(a){return d[38].some(function(a){return c.i64.eq(d[31],a)})?d[41]=d[31]:d[41]=void 0,c.i64.neq(d[41],void 0)?d[42]=d[41]:d[42]=void 0,d[28]=d[42]}])},function(a){return c.i64.neq(d[28],void 0)?d[29]=d[28]:d[29]=c.i64.cast([0,0]),c.i64.neq(d[32],void 0)?d[30]=d[32]:d[30]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[29],d[30],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0,void 0],d[2]=a[0],d[3]=a[1],d[4]=a[2],d[5]=a[3],d[6]=a[4],d[7]=a[5],d[8]=a[6],d[9]=a[7],d[10]=a[8],d[11]=a[9],d[12]=a[10],d[13]=a[11],d[14]=a[12],d[15]=a[13],d[16]=a[14],d[17]=a[15],d[18]=a[16],d[19]=a[17]}]))})},function(e){return c.blobs.neq(d[5],void 0)?c.i64.neq(d[3],void 0)?(d[27]=c.i64.to_string(d[2]),d[27]!==void 0?c.sequence([function(e){return d[28]=c.createArray(),d[63]=(d[28].push(d[27]),d[28]),d[63]=(d[28].push(a[0]),d[28]),d[29]=c.toJSON(d[28]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[29]).then(function(a){return a=a,d[30]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2NvcGU="),d[30]).then(function(a){return a=a,d[31]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[31]).then(function(a){return a=a,d[32]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),d[27]).then(function(a){return a=a,d[34]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[34]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[35]).then(function(a){return a=a,d[36]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[36]).then(function(a){return a=a,d[37]=a[0],a})},function(e){return d[38]=new c.Map(),d[38].set("attachment_index_key",d[33]==null?"":d[33]),d[38].set("delivery_object_id",a[0]),d[38].set("device_id",d[3]),d[38].set("mailbox_partial_id",d[37]==null?"":d[37]),d[38].set("media_type",a[2]),d[38].set("product_type",a[1]),d[38].set("trace_id",d[1]),d[39]=new c.Map(),d[39].set("otid",a[3]),d[39].set("server_thread_key",a[6]),d[39].set("timestamp",void 0),c.nativeOperation(b("LSGetBlobFromString.nop"),a[3]).then(function(a){return a=a,d[40]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[40]).then(function(a){return a=a,d[41]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[42]).then(function(a){return a=a,d[43]=a[0],a})},function(e){return d[38].set("salt_partial_id",d[43]==null?"":d[43]),c.nativeOperation(b("LSGetBlobFromString.nop"),a[4]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[44]).then(function(a){return a=a,d[45]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[45]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[46]).then(function(a){return a=a,d[47]=a[0],a})},function(e){return d[38].set("thread_partial_id",d[47]==null?"":d[47]),c.nativeOperation(b("LSGetBlobFromString.nop"),a[3]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[49]).then(function(a){return a=a,d[50]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[50]).then(function(a){return a=a,d[51]=a[0],a})},function(e){return d[38].set("message_partial_id",d[51]==null?"":d[51]),d[52]=c.createArray(),d[63]=(d[52].push(a[3]),d[52]),d[63]=(d[52].push(a[0]),d[52]),d[53]=c.toJSON(d[52]),d[38].set("raw_identifiers",d[39]),d[38].set("backup_id",d[27]),d[38].set("thread_id",a[4]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[53]).then(function(a){return a=a,d[54]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF90b2tlbl9zYWx0X3Njb3Bl"),d[54]).then(function(a){return a=a,d[55]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[55]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[56]).then(function(a){return a=a,d[57]=a[0],a})},function(a){return d[38].set("salt_partial_access_token",d[57]==null?"":d[57]),c.nativeOperation(b("LSGetBlobFromString.nop"),d[29]).then(function(a){return a=a,d[58]=a[0],a})},function(a){return c.nativeOperation(b("LSHmac_v2.nop"),c.blob("YXR0YWNobWVudF9rZXlfc2FsdF9zY29wZQ=="),d[58]).then(function(a){return a=a,d[59]=a[0],a})},function(a){return c.nativeOperation(b("LSOcmfClientMap.nop"),d[5],d[59]).then(function(a){return a=a,d[60]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[60]).then(function(a){return a=a,d[61]=a[0],a})},function(a){return d[38].set("salt_partial_attachment_index_key",d[61]==null?"":d[61]),d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,637738637]),d[1],!0):c.resolve()},function(a){return d[62]=c.toJSON(d[38]),c.storedProcedure(b("LSIssueNewTask"),"encrypted_backups_attachment_upload",c.i64.cast([0,50012]),d[62],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(a){return d[29]="Missing backup_id for IssueAttachmentBackupTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] ","",d[29]].join("")),d[28]=c.createArray(),void 0!==void 0?d[31]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",d[29],d[28],c.i64.cast([0,3]))},function(a){return d[30]=["LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",".","missing_backup_id"].join(""),d[1]!==void 0?d[30]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,637738637]),d[1],"error",d[30]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,637738637]),d[1],!1):c.resolve()}])):c.sequence([function(a){return d[28]="Missing device_id for IssueAttachmentBackupTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] ","",d[28]].join("")),d[27]=c.createArray(),void 0!==void 0?d[30]=(d[27].push(void 0),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",d[28],d[27],c.i64.cast([0,3]))},function(a){return d[29]=["LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",".","missing_device_id"].join(""),d[1]!==void 0?d[29]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,637738637]),d[1],"error",d[29]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,637738637]),d[1],!1):c.resolve()}]):c.sequence([function(a){return d[28]="Missing ocmf_client_state_blob for IssueAttachmentBackupTask",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] ","",d[28]].join("")),d[27]=c.createArray(),void 0!==void 0?d[30]=(d[27].push(void 0),d[27]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",d[28],d[27],c.i64.cast([0,3]))},function(a){return d[29]=["LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",".","missing_ocmf_client_state_blob"].join(""),d[1]!==void 0?d[29]!==void 0?c.nativeOperation(b("LSQplAnnotateString.nop"),c.i64.cast([0,637738637]),d[1],"error",d[29]):c.resolve():c.resolve()},function(a){return d[1]!==void 0?c.nativeOperation(b("LSQplMarkEnd.nop"),c.i64.cast([0,637738637]),d[1],!1):c.resolve()}])},function(a){return d[21]=c.i64.of_float(Date.now()),d[22]=c.i64.random(),d[24]="Finishing execution. Execution time: ",d[25]=c.i64.to_string(c.i64.sub(d[21],d[0])),d[26]=" ms",d[23]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure] ",d[23],d[24],d[23],d[25],d[23],d[26]].join("")),c.i64.eq(c.i64.mod_(d[22],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[27]=",",d[28]=c.createArray(),void 0!==void 0?d[29]=(d[28].push(void 0),d[28]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure",[d[24],d[27],d[25],d[27],d[26]].join(""),d[28],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueAttachmentBackupTaskStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state"];e.exports=a}),null);
__d("LSIssueAttachmentBackupTaskStoredProcedure",["LSIssueAttachmentBackupTask","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueAttachmentBackupTask"),e.deliveryObjectId,e.productType,e.mediaType,e.messageId,e.threadId,e.traceId,e.serverThreadKey);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSIssueThreadRemove",["LSArrayGetObjectAt","LSIsEncryptionVersionSecure","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(a){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][issueThreadRemove] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[15]=new c.Map(),d[15].set("error_msg","Expected a nonempty query result"),d[15].set("code",c.i64.cast([0,3])),d[15].set("src_line","MEBClientStateUtils.php:256 MEBClientStateUtils::maybeClientStateFromDatabaseDirectly()"),d[16]=c.createArray(),d[17]=(d[16].push(d[15]),d[16]),e=[void 0,d[16]],d[2]=e[0],d[3]=e[1]):(b=a.item,d[15]=new c.Map(),d[15].set("backup_id",b.backupId),d[15].set("device_public_key_blob",b.devicePublicKeyBlob),d[15].set("device_private_key_blob",b.devicePrivateKeyBlob),d[15].set("epoch_storage_public_key_blob",b.epochStoragePublicKeyBlob),d[15].set("epoch_storage_private_key_blob",b.epochStoragePrivateKeyBlob),d[15].set("epoch_auth_public_key_blob",b.epochAuthPublicKeyBlob),d[15].set("epoch_auth_private_key_blob",b.epochAuthPrivateKeyBlob),d[15].set("mailbox_root_key_blob",b.mailboxRootKeyBlob),d[15].set("ocmf_client_state_blob",b.ocmfClientStateBlob),d[15].set("orf_client_state_v2_blob",void 0),d[15].set("orf_v2_authority_level",void 0),d[15].set("oblivious_validation_token_blob",b.obliviousValidationTokenBlob),d[15].set("device_id",b.deviceId),d[15].set("backup_tenancy",b.backupTenancy),d[15].set("encryption_version",b.encryptionVersion),d[15].set("revision_version",b.revisionVersion),d[15].set("initialize_restore_result",void 0),d[15].set("device_creation_timestamp_sec",void 0),d[15].set("authority_level",b.authorityLevel),e=[d[15],void 0],d[2]=e[0],d[3]=e[1])})},function(e){return d[5]=new c.Map(),d[5].set("value",d[2]),d[5].set("errors",d[3]),d[6]=d[5].get("value"),d[6]!==void 0?c.sequence([function(e){return d[15]=d[6].get("backup_id"),d[16]=d[6].get("device_public_key_blob"),d[17]=d[6].get("device_private_key_blob"),d[18]=d[6].get("epoch_storage_public_key_blob"),d[19]=d[6].get("epoch_storage_private_key_blob"),d[20]=d[6].get("epoch_auth_public_key_blob"),d[21]=d[6].get("epoch_auth_private_key_blob"),d[22]=d[6].get("mailbox_root_key_blob"),d[23]=d[6].get("ocmf_client_state_blob"),d[24]=d[6].get("orf_client_state_v2_blob"),d[25]=d[6].get("orf_v2_authority_level"),d[26]=d[6].get("oblivious_validation_token_blob"),d[27]=d[6].get("device_id"),d[28]=d[6].get("backup_tenancy"),d[29]=d[6].get("encryption_version"),d[30]=d[6].get("revision_version"),d[31]=d[6].get("initialize_restore_result"),d[32]=d[6].get("device_creation_timestamp_sec"),d[33]=d[6].get("authority_level"),c.i64.neq(d[27],void 0)?c.sequence([function(a){return d[36]=void 0,c.i64.neq(d[36],void 0)?c.resolve(d[37]=d[36]):c.sequence([function(a){return d[43]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[44]?d[53]=(d[43].push(c.i64.cast([0,0])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[45]=a[0],a})},function(a){return d[45]?d[53]=(d[43].push(c.i64.cast([0,2])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[46]?d[53]=(d[43].push(c.i64.cast([0,3])),d[43]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[47]=a[0],a})},function(a){return d[47]?d[53]=(d[43].push(c.i64.cast([0,4])),d[43]):0,d[48]=c.createArray(),d[49]=c.i64.of_int32(d[43].length),c.i64.gt(d[49],c.i64.cast([0,0]))?c.loopAsync(d[49],function(a){return d[53]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[43],d[53]).then(function(a){return a=a,d[54]=a[0],d[55]=a[1],a})},function(a){return d[56]=(d[48].push(d[54]),d[48])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[53]=c.createArray(),d[54]=c.i64.of_int32(d[48].length),c.i64.gt(d[54],c.i64.cast([0,0]))?c.loopAsync(d[54],function(a){return d[56]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[48],d[56]).then(function(a){return a=a,d[57]=a[0],d[58]=a[1],a})},function(a){return d[59]=(d[53].push(c.i64.to_string(d[57])),d[53])}])}):c.resolve()},function(a){return d[55]=d[53].join(","),d[50]=d[55]}])},function(a){return d[48].some(function(a){return c.i64.eq(d[29],a)})?d[51]=d[29]:d[51]=void 0,c.i64.neq(d[51],void 0)?d[52]=d[51]:d[52]=void 0,d[37]=d[52]}])},function(e){return c.i64.neq(d[37],void 0)?d[38]=d[37]:d[38]=c.i64.cast([0,0]),c.i64.neq(d[28],void 0)?d[39]=d[28]:d[39]=c.i64.cast([0,1]),d[40]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSIssueNewTaskAndGetTaskID"),["eb_upload",":",a[0]].join(""),c.i64.cast([0,50026]),"",void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),c.i64.cast([0,93]),void 0,c.i64.le(c.i64.cast([0,0]),c.i64.cast([0,0]))?c.i64.cast([0,0]):c.i64.add(d[40],c.i64.sub(c.i64.cast([0,0]),c.i64.mod_(d[40],c.i64.cast([0,0])))),c.i64.cast([0,0])).then(function(a){return a=a,d[41]=a[0],a})},function(b){return c.db.table(177).add({pk:void 0,pendingBackupTaskId:d[41],actionType:c.i64.cast([0,2]),contentType:c.i64.cast([0,2]),backupStatus:c.i64.cast([0,1]),listKey:a[0],uniqueKey:a[0],sortKey:a[1],persistentId:"",isInstamadillo:!1,lsTraceId:a[3],error:a[4]})},function(b){return c.i64.eq(c.i64.cast([0,2]),c.i64.cast([0,1]))?c.i64.eq(c.i64.cast([0,2]),c.i64.cast([0,1]))?(d[43]=c.createArray(),d[45]=(d[43].push("Successfully issued message backup task. act thread id = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[45]=(d[43].push(", otid = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[44]=d[43].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[44]].join("")),c.resolve()):(d[43]=c.createArray(),d[45]=(d[43].push("Successfully issued message remove task. act thread id = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[45]=(d[43].push(", otid = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[44]=d[43].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[44]].join("")),c.resolve()):(d[43]=c.createArray(),d[45]=(d[43].push("Successfully issued thread remove task. act thread id = "),d[43]),d[45]=(d[43].push(a[0]),d[43]),d[44]=d[43].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[44]].join("")),c.resolve())},function(a){return d[42]=new c.Map(),d[42].set("task_id",d[41]),a=[d[42],void 0],d[34]=a[0],d[35]=a[1]}]):c.sequence([function(b){return d[36]=c.createArray(),d[39]=(d[36].push("Skipping thread remove since EB is disabled. act thread id = "),d[36]),d[39]=(d[36].push(a[0]),d[36]),d[37]=d[36].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[37]].join("")),c.resolve()},function(a){return d[38]=new c.Map(),d[38].set("error_code",c.i64.cast([0,24])),d[38].set("stored_procedure","LSEncryptedBackupsIssueThreadRemoveStoredProcedure"),d[38].set("error_message",""),a=[void 0,d[38]],d[34]=a[0],d[35]=a[1]}])},function(a){return a=[d[34],d[35]],d[7]=a[0],d[8]=a[1],a}]):c.sequence([function(b){return d[15]=d[5].get("errors"),d[16]=d[5].get("errors"),d[17]=c.createArray(),d[20]=(d[17].push("Skipping thread remove since EB is disabled. act thread id = "),d[17]),d[20]=(d[17].push(a[0]),d[17]),d[18]=d[17].join(void 0||""),function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ","",d[18]].join("")),c.resolve()},function(a){return d[19]=new c.Map(),d[19].set("error_code",c.i64.cast([0,1])),d[19].set("stored_procedure","LSEncryptedBackupsIssueThreadRemoveStoredProcedure"),d[19].set("error_message",""),a=[void 0,d[19]],d[7]=a[0],d[8]=a[1]}])},function(a){return d[9]=c.i64.of_float(Date.now()),d[10]=c.i64.random(),d[12]="Finishing execution. Execution time: ",d[13]=c.i64.to_string(c.i64.sub(d[9],d[0])),d[14]=" ms",d[11]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][issueThreadRemove] ",d[11],d[12],d[11],d[13],d[11],d[14]].join("")),c.i64.eq(c.i64.mod_(d[10],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[15]=",",d[16]=c.createArray(),void 0!==void 0?d[17]=(d[16].push(void 0),d[16]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"issueThreadRemove",[d[12],d[15],d[13],d[15],d[14]].join(""),d[16],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[7],d[8]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsIssueThreadRemoveStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","pending_backups_context_v2"];e.exports=a}),null);
__d("LSIssueThreadRemoveStoredProcedure",["LSIssueThreadRemove","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSIssueThreadRemove"),e.actThreadId,e.sortKey,e.source,e.traceId,e.error);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSOptimisticallyUpdateMessagingPrivacySettings",["LSGetViewerFBID","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(a){return c.storedProcedure(b("LSGetViewerFBID")).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.forEach(c.db.table(288).fetch([[[d[0]]]]),function(b){var c=b.update;b.item;return c({readReceiptsDisabled:a[0]})})},function(e){return d[1]=new c.Map(),d[1].set("read_receipts_disabled",a[0]),d[2]=c.toJSON(d[1]),c.storedProcedure(b("LSIssueNewTask"),"toggle_rr",c.i64.cast([0,731]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSOmnistoreSettingsOptimisticallyUpdateMessagingPrivacySettingsStoredProcedure";a.__tables__=["messaging_privacy_settings"];e.exports=a}),null);
__d("LSOptimisticallyUpdateMessagingPrivacySettingsStoredProcedure",["LSOptimisticallyUpdateMessagingPrivacySettings","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSOptimisticallyUpdateMessagingPrivacySettings"),e.readReceiptsDisabled);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSSendPakeMessage",["LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][sendPakeMessage] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[4])&&c.i64.eq(b.sessionId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[4])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,7]),clientType:a[4]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,7])})}))}):(f=e.item,d[17]=f.responderId,d[18]=f.initiatorId,d[15]=f.responderUserId,d[16]=f.initiatorUserId,a[1]===d[18]?(c.i64.eq(a[4],c.i64.cast([0,1]))?d[19]=d[15]:d[19]=void 0,d[9]=d[19]):(a[1]===d[17]?(c.i64.eq(a[4],c.i64.cast([0,1]))?d[20]=d[16]:d[20]=void 0,d[19]=d[20]):d[19]=void 0,d[9]=d[19]),c.i64.eq(a[4],c.i64.cast([0,1]))?d[10]=d[15]:d[10]=void 0,c.i64.eq(a[4],c.i64.cast([0,1]))?d[11]=d[16]:d[11]=void 0,d[12]=new c.Map(),d[12].set("session_id",a[0]),d[12].set("responder_id",d[17]),d[12].set("initiator_id",d[18]),d[12].set("message_payload",a[2]==null?f.messagePayload:a[2]),d[12].set("pake_secret",f.pakeSecret),d[12].set("sender_id",a[1]),d[12].set("message_type",a[3]),d[12].set("client_type",a[4]),d[12].set("message_recipient_id",d[9]),d[12].set("initiator_user_id",d[11]),d[12].set("responder_user_id",d[10]),d[13]=c.toJSON(d[12]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"PakeMessages",c.i64.cast([0,717]),d[13],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[14]=a[0],a}))})},function(a){return d[3]=c.i64.of_float(Date.now()),d[4]=c.i64.random(),d[6]="Finishing execution. Execution time: ",d[7]=c.i64.to_string(c.i64.sub(d[3],d[0])),d[8]=" ms",d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][sendPakeMessage] ",d[5],d[6],d[5],d[7],d[5],d[8]].join("")),c.i64.eq(c.i64.mod_(d[4],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[9]=",",d[10]=c.createArray(),void 0!==void 0?d[11]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"sendPakeMessage",[d[6],d[9],d[7],d[9],d[8]].join(""),d[10],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSPakeMessagesSendPakeMessageStoredProcedure";a.__tables__=["pake_messages"];e.exports=a}),null);
__d("LSSendPakeMessageOne",["LSBase64Encode.nop","LSIssueNewEbTaskAndGetTaskIDV2","LSLogMebClientEvent.nop","LSQplInteractionHelper.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][sendPakeMessageOne] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.nativeOperation(b("LSBase64Encode.nop"),a[2]).then(function(a){return a=a,d[2]=a[0],a})},function(e){return c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[3])&&c.i64.eq(b.sessionId,a[0])}).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,7]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[3])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,7]),clientType:a[3]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,7])})}))})}]):(f=e.item,d[10]=f.responderId,d[10]!==void 0?(c.i64.eq(a[3],c.i64.cast([0,1]))?d[11]=f.responderUserId:d[11]=void 0,c.i64.eq(a[3],c.i64.cast([0,1]))?d[12]=f.initiatorUserId:d[12]=void 0,d[13]=new c.Map(),d[13].set("session_id",a[0]),d[13].set("responder_id",d[10]),d[13].set("initiator_id",a[1]),d[13].set("message_payload",d[2]==null?"":d[2]),d[13].set("message_payload_v2",void 0),d[13].set("pake_secret",void 0),d[13].set("sender_id",a[1]),d[13].set("message_type",c.i64.cast([0,1])),d[13].set("client_type",a[3]),d[13].set("message_recipient_id",d[11]),d[13].set("initiator_user_id",d[12]),d[13].set("responder_user_id",d[11]),d[14]=c.toJSON(d[13]),c.storedProcedure(b("LSIssueNewEbTaskAndGetTaskIDV2"),"PakeMessages",c.i64.cast([0,717]),d[14],c.i64.cast([0,0]),c.i64.cast([0,93]),c.i64.cast([0,0]),void 0,c.i64.cast([0,0])).then(function(a){return a=a,d[15]=a[0],a})):c.sequence([function(a){return c.nativeOperation(b("LSQplInteractionHelper.nop"),void 0,c.i64.cast([0,3]),c.i64.cast([0,8]))},function(b){return c.islc(c.filter(c.db.table(258).fetch([[[a[0]]]]),function(b){return c.i64.eq(b.clientType,a[3])&&c.i64.eq(b.sessionId,a[0])}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(b,d){d=b.done;b=b.value;return d?c.db.table(258).add({sessionId:a[0],messageType:c.i64.cast([0,8]),clientType:a[3]}):(b.item,c.forEach(c.db.table(258).fetch([[[a[0]]]]),function(a){var b=a.update;a.item;return b({messageType:c.i64.cast([0,8])})}))})}]))})},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][sendPakeMessageOne] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"sendPakeMessageOne",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSPakeMessagesSendPakeMessageOneStoredProcedure";a.__tables__=["pake_messages"];e.exports=a}),null);
__d("LSSendPakeMessageOneStoredProcedure",["LSSendPakeMessageOne","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSSendPakeMessageOne"),e.sessionId,e.initiatorId,e.messagePayload,e.clientType);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSSendPakeMessageStoredProcedure",["LSSendPakeMessage","LSSynchronousPromise","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSSendPakeMessage"),e.sessionId,e.senderId,e.messagePayload,e.messageType,e.clientType);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSUpdateBackupsTable",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSDeleteAndReenrollDeviceState","LSDeleteBackupOnClient","LSFlushDataTrace.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUpdateBackupsTableStoredProcedure] Beginning execution."),c.sequence([function(d){return a[5]!==void 0?c.storedProcedure(b("LSAppendDataTraceAddon"),a[5],c.i64.cast([0,1467]),c.i64.cast([0,2]),void 0,void 0):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[7]?d[8]=!0:d[8]=!1,d[8]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[10]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[10]].join("")),d[9]=c.createArray(),void 0!==void 0?d[11]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[10],d[9],c.i64.cast([0,3]))):c.resolve()}])},function(e){return a[0]?c.sequence([function(a){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(a,b){b=a.done;a=a.value;return b?d[7]=!1:(a.item,d[7]=!0)})},function(e){return d[7]&&!0?c.sequence([function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(a,e){var f=a.done;a=a.value;return f?(f=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20]),void 0,void 0],d[11]=f[0],d[12]=f[1],d[13]=f[2],d[14]=f[3],d[15]=f[4],d[16]=f[5],d[17]=f[6],d[18]=f[7],d[19]=f[8],d[20]=f[9],d[21]=f[10],d[22]=f[11],d[23]=f[12],d[24]=f[13],d[25]=f[14],d[26]=f[15],d[27]=f[16],d[28]=f[17],f):(e=a.item,c.sequence([function(a){return d[37]=e.backupTenancy,d[36]=e.encryptionVersion,d[32]=void 0,c.i64.neq(d[32],void 0)?c.resolve(d[33]=d[32]):c.sequence([function(a){return d[38]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[39]=a[0],a})},function(a){return d[39]?d[48]=(d[38].push(c.i64.cast([0,0])),d[38]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[40]=a[0],a})},function(a){return d[40]?d[48]=(d[38].push(c.i64.cast([0,2])),d[38]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[41]=a[0],a})},function(a){return d[41]?d[48]=(d[38].push(c.i64.cast([0,3])),d[38]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]?d[48]=(d[38].push(c.i64.cast([0,4])),d[38]):0,d[43]=c.createArray(),d[44]=c.i64.of_int32(d[38].length),c.i64.gt(d[44],c.i64.cast([0,0]))?c.loopAsync(d[44],function(a){return d[48]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[38],d[48]).then(function(a){return a=a,d[49]=a[0],d[50]=a[1],a})},function(a){return d[51]=(d[43].push(d[49]),d[43])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[48]=c.createArray(),d[49]=c.i64.of_int32(d[43].length),c.i64.gt(d[49],c.i64.cast([0,0]))?c.loopAsync(d[49],function(a){return d[51]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[43],d[51]).then(function(a){return a=a,d[52]=a[0],d[53]=a[1],a})},function(a){return d[54]=(d[48].push(c.i64.to_string(d[52])),d[48])}])}):c.resolve()},function(a){return d[50]=d[48].join(","),d[45]=d[50]}])},function(a){return d[43].some(function(a){return c.i64.eq(d[36],a)})?d[46]=d[36]:d[46]=void 0,c.i64.neq(d[46],void 0)?d[47]=d[46]:d[47]=void 0,d[33]=d[47]}])},function(a){return c.i64.neq(d[33],void 0)?d[34]=d[33]:d[34]=c.i64.cast([0,0]),c.i64.neq(d[37],void 0)?d[35]=d[37]:d[35]=c.i64.cast([0,1]),a=[e.backupId,e.deviceId,e.mailboxRootKeyBlob,e.ocmfClientStateBlob,void 0,void 0,d[34],d[35],e.epochAuthPublicKeyBlob,e.epochAuthPrivateKeyBlob,e.devicePublicKeyBlob,e.devicePrivateKeyBlob,e.epochStoragePublicKeyBlob,e.epochStoragePrivateKeyBlob,e.obliviousValidationTokenBlob,e.authorityLevel,void 0,void 0],d[11]=a[0],d[12]=a[1],d[13]=a[2],d[14]=a[3],d[15]=a[4],d[16]=a[5],d[17]=a[6],d[18]=a[7],d[19]=a[8],d[20]=a[9],d[21]=a[10],d[22]=a[11],d[23]=a[12],d[24]=a[13],d[25]=a[14],d[26]=a[15],d[27]=a[16],d[28]=a[17]}]))})},function(e){return d[30]=!1,d[31]=c.i64.of_int32(a[3].length),c.i64.gt(d[31],c.i64.cast([0,0]))?c.loopAsync(d[31],function(e){return d[32]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[3],d[32]).then(function(a){return a=a,d[33]=a[0],d[34]=a[1],a})},function(a){return d[35]=d[33].get("device_id"),d[30]=d[30]||c.i64.eq(d[12],d[35])}])}):c.resolve()},function(e){return d[30]?c.resolve():(function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUpdateBackupsTableStoredProcedure] Client device id not in the list of device ids associated with the backupDeleting backup client state"),c.i64.neq(d[12],void 0)?c.storedProcedure(b("LSDeleteBackupOnClient"),void 0,void 0,!1,a[5],void 0,!0):c.storedProcedure(b("LSDeleteBackupOnClient"),void 0,void 0,!1,a[5],void 0,!0))}]):c.resolve()},function(a){return c.forEach(c.filter(c.db.table(184).fetch(),function(a){return c.i64.neq(a.removalStatus,c.i64.cast([0,2]))}),function(a){return a["delete"]()})},function(e){return d[9]=c.i64.of_int32(a[2].length),c.i64.gt(d[9],c.i64.cast([0,0]))?c.loopAsync(d[9],function(e){return d[11]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[2],d[11]).then(function(a){return a=a,d[12]=a[0],d[13]=a[1],a})},function(a){return d[14]=d[12].get("virtual_devices"),d[14]?d[15]=!1:d[15]=!0,d[15]?c.resolve():(d[16]=c.i64.of_int32(d[14].length),c.i64.gt(d[16],c.i64.cast([0,0]))?c.loopAsync(d[16],function(a){return d[17]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[14],d[17]).then(function(a){return a=a,d[18]=a[0],d[19]=a[1],a})},function(a){return d[20]=d[18].get("virtual_device_id"),d[21]=d[18].get("virtual_device_type"),d[22]=d[18].get("creation_time"),d[23]=d[18].get("device_created_on"),d[24]=d[18].get("cloud_service_account"),d[25]=d[18].get("hsm_pin_normalization_status"),d[26]=d[18].get("requires_hsm_migration"),d[27]=d[18].get("hsm_migration_status"),d[28]=d[18].get("security_question_type"),d[29]=d[18].get("trusted_contact_id"),d[30]=d[18].get("recovery_code"),d[31]=d[12].get("backup_id"),c.count(c.filter(c.db.table(184).fetch(),function(a){return c.i64.eq(a.backupId,d[31])&&c.blobs.eq(a.virtualDeviceId,d[20])})).then(function(a){return d[32]=a})},function(a){return c.i64.eq(d[32],c.i64.cast([0,0]))?(d[33]=d[12].get("backup_id"),c.db.table(184).add({pk:void 0,backupId:d[33],virtualDeviceId:d[20],virtualDeviceType:d[21],creationTime:d[22],deviceCreatedOn:d[23],requiresHsmMigration:d[26]})):c.resolve()}])}):c.resolve())}])}):c.resolve()},function(a){return c.forEach(c.db.table(172).fetch(),function(a){return a["delete"]()})},function(e){return d[10]=c.i64.of_int32(a[1].length),c.i64.gt(d[10],c.i64.cast([0,0]))?c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[1],c.i64.cast([0,0])).then(function(a){return a=a,d[11]=a[0],d[12]=a[1],a})},function(a){return d[13]=d[11].get("backup_id"),d[14]=d[11].get("backup_tenancy"),c.forEach(c.filter(c.db.table(172).fetch([[[c.i64.cast([0,1])]]]),function(a){return c.i64.eq(a.pk,c.i64.cast([0,1]))&&c.i64.lt(a.authorityLevel,c.i64.cast([0,80]))}),function(a){return a["delete"]()})},function(b){return c.db.table(172).add({pk:c.i64.cast([0,1]),backupId:d[13],authorityLevel:c.i64.cast([0,80]),backupTenancy:d[14],isUserOptedOut:a[6],hasOtcEligibleDevices:a[7],encryptionManagementDelegatorId:a[8]})}]):c.sequence([function(a){return c.forEach(c.filter(c.db.table(172).fetch([[[c.i64.cast([0,1])]]]),function(a){return c.i64.eq(a.pk,c.i64.cast([0,1]))&&c.i64.lt(a.authorityLevel,c.i64.cast([0,80]))}),function(a){return a["delete"]()})},function(b){return c.db.table(172).add({pk:c.i64.cast([0,1]),authorityLevel:c.i64.cast([0,80]),isUserOptedOut:a[6],hasOtcEligibleDevices:a[7],encryptionManagementDelegatorId:a[8]})}])}]):c.sequence([function(e){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsUpdateBackupsTableStoredProcedure] Fetch backup task did not succeed."),d[7]=c.createArray(),a[5]!==void 0?d[8]=(d[7].push(a[5]),d[7]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsUpdateBackupsTableStoredProcedure","Fetch backup task did not succeed.",d[7],c.i64.cast([0,3]))},function(a){return c.forEach(c.db.table(172).fetch(),function(a){return a["delete"]()})},function(a){return c.forEach(c.filter(c.db.table(172).fetch([[[c.i64.cast([0,1])]]]),function(a){return c.i64.eq(a.pk,c.i64.cast([0,1]))&&c.i64.lt(a.authorityLevel,c.i64.cast([0,80]))}),function(a){return a["delete"]()})},function(a){return c.db.table(172).add({pk:c.i64.cast([0,1]),backupId:c.i64.cast([-1,4294967295]),authorityLevel:c.i64.cast([0,80]),hasOtcEligibleDevices:!1})},function(e){return c.sequence([function(d){return a[5]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[5]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[8]=a[0],a})},function(a){return d[8]?d[9]=!0:d[9]=!1,d[9]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[11]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[11]].join("")),d[10]=c.createArray(),void 0!==void 0?d[12]=(d[10].push(void 0),d[10]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[11],d[10],c.i64.cast([0,3]))):c.resolve()}])}])},function(e){return c.sequence([function(d){return a[5]!==void 0?c.nativeOperation(b("LSFlushDataTrace.nop"),a[5]):c.resolve()},function(a){return c.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,d[7]=a[0],a})},function(a){return d[7]?d[8]=!0:d[8]=!1,d[8]&&!0?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),d[10]="LSDataTraceMciTraceLog native op not supported",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][MEBTraceUtils] ","",d[10]].join("")),d[9]=c.createArray(),void 0!==void 0?d[11]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils",d[10],d[9],c.i64.cast([0,3]))):c.resolve()}])},function(a){return d[1]=c.i64.of_float(Date.now()),d[2]=c.i64.random(),d[4]="Finishing execution. Execution time: ",d[5]=c.i64.to_string(c.i64.sub(d[1],d[0])),d[6]=" ms",d[3]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsUpdateBackupsTableStoredProcedure] ",d[3],d[4],d[3],d[5],d[3],d[6]].join("")),c.i64.eq(c.i64.mod_(d[2],c.i64.cast([0,1e3])),c.i64.cast([0,0]))?(d[7]=",",d[8]=c.createArray(),void 0!==void 0?d[9]=(d[8].push(void 0),d[8]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsUpdateBackupsTableStoredProcedure",[d[4],d[7],d[5],d[7],d[6]].join(""),d[8],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}a.__sproc_name__="LSEncryptedBackupsUpdateBackupsTableStoredProcedure";a.__tables__=["secure_encrypted_backups_client_state","encrypted_backups_virtual_devices","encrypted_backups"];e.exports=a}),null);
__d("LSUpdateBackupsTableStoredProcedure",["LSSynchronousPromise","LSUpdateBackupsTable","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSUpdateBackupsTable"),e.isSuccess,e.backupIds,e.virtualDevices,e.deviceIds,e.backupMetadata,e.traceId,e.isUserOptedOut,e.hasOtcEligibleDevices,e.encryptionManagementDelegatorId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSUpdateE2EEMetadataParticipants",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[0].set("user_self_remove",!1),d[1]=d[0].get("thread_key"),d[2]=c.toJSON(d[0]),c.storedProcedure(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,394]),d[2],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}a.__sproc_name__="LSE2EEMessagingMetadataMailboxUpdateE2EEMetadataParticipantsStoredProcedure";a.__tables__=[];e.exports=a}),null);
__d("LSUpdateE2EEMetadataParticipantsStoredProcedure",["LSSynchronousPromise","LSUpdateE2EEMetadataParticipants","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSUpdateE2EEMetadataParticipants"),e.threadKey);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSUpsertAttachmentRange",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[];return b.sequence([function(c){return b.sequence([function(c){return b.forEach(b.db.table(17).fetch([[[a[0],a[1]]]]),function(a){return a["delete"]()})},function(c){return b.db.table(17).add({threadKey:a[0],mediaGroup:a[1],minTimestampMs:a[2],maxTimestampMs:b.i64.cast([2328,1316134911]),hasMoreBefore:a[3],hasMoreAfter:!1,isLoadingBefore:!1,isLoadingAfter:!1,lastLoadedMessageId:a[4]})}])},function(a){return b.resolve(c)}])}a.__sproc_name__="LSMailboxUpsertAttachmentRangeStoredProcedure";a.__tables__=["attachments_ranges_v2__generated"];e.exports=a}),null);
__d("LSUpsertAttachmentRangeStoredProcedure",["LSSynchronousPromise","LSUpsertAttachmentRange","Promise","cr:8709"],(function(a,b,c,d,e,f,g){var h;function a(a,e){a=a.storedProcedure(c("LSUpsertAttachmentRange"),e.threadKey,e.mediaGroup,e.newMinTs,e.hasMoreBefore,e.newLastLoadedMessageId);return(h||(h=b("Promise"))).resolve(d("LSSynchronousPromise").maybeExtractValueIfSynchronousPromise(a))}g["default"]=a}),98);
__d("LSUserVisibleErrorsUtil",["LSFactory","LSRemoveErrorStoredProcedure","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("promiseDone")(a.runInTransaction(function(a){return c("LSRemoveErrorStoredProcedure")(c("LSFactory")(a),{errorId:b})},"readwrite",void 0,void 0,f.id+":24"))}g.removeUserVisibleErrorFromTable=a}),98);
__d("MAWFTSRawStringMatcher",["JSResourceForInteraction","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h=c("JSResourceForInteraction")("WAFtsMultiLangTokenizer").__setRef("MAWFTSRawStringMatcher"),i=null;async function a(){i=await h.load();return k}function j(a){return new(c("nullthrows")(i))().tokenize(a)}function k(a,b){a=Array.from(j(a)).filter(function(a){return a.length>1});if(a.length===0)return!1;var c=Array.from(j(b));return a.every(function(a){return c.some(function(b){return b.startsWith(a)})})}g.load=a}),98);
__d("addMAWBridgeSearchMessagesToUniversalSearch",["I64","LSIntEnum","LSMessageSearchType","MAWCurrentUser","MAWUniversalMessageSearch","MWContentSearchUtils","MWSearchThreadUtils","ReQL","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("LSIntEnum")).ofNumber(c("LSMessageSearchType").THREAD);async function a(a,b,e,g,h){var k;d("MAWUniversalMessageSearch").updateSecureMsgMatchCountForThread(b,g.length);var l=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.message_search_results).getKeyRange(j,e,b)),m=l==null;k=(i||(i=d("I64"))).to_int32((k=l==null?void 0:l.matchCount)!=null?k:(i||(i=d("I64"))).zero);var n=k+g.length;k=await d("MWSearchThreadUtils").getThreadDataByThreadKey(a,b,i.of_string(d("MAWCurrentUser").getID()),j);if(k==null)return;var o=k.profilePicUrl,p=k.secondaryProfilePicUrl,q=k.threadDisplayName,r=k.threadType,s=l==null?void 0:l.globalIndex,t=d("MWContentSearchUtils").getGlobalIndex(g[0].sortOrderMs,l==null?void 0:l.globalIndex),u=async function(a){var c;await a.message_search_results.upsert([j,e,b,s!=null?s:t],babelHelpers.extends({},d("MWContentSearchUtils").getContextLineAndMatches(e,n,(c=g[0].msg)==null?void 0:c.content,j),{displayName:q,globalIndex:t,matchCount:(i||(i=d("I64"))).of_int32(n),messageTimestampMs:d("MWContentSearchUtils").getMessageTimestamp(g[0].sortOrderMs),profilePicUrl:o,query:e,secondaryProfilePicUrl:p,threadKey:b,threadType:r,type_:j}));m&&await a.message_search_queries.put(babelHelpers.extends({},h,{resultCount:(i||(i=d("I64"))).add(h.resultCount,i.one)}))};c("promiseDone")(a.runInTransaction(async function(a){await u(a)},"readwrite",void 0,void 0,f.id+":113"))}g.default=a}),98);
__d("MAWBridgeAddMessageSearchResultHandler",["I64","LSIntEnum","LSMessageSearchType","MAWCurrentUser","MAWFTSRawStringMatcher","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MWInboxSecureContentSearch","ReQL","addMAWBridgeSearchMessagesToUniversalSearch","emptyFunction","isMAWUniversalSearchWithEBEnabled","promiseDone","waitForMiActMappingForUniversalSearch"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||(h=d("LSIntEnum"))).ofNumber(c("LSMessageSearchType").MESSAGE),k=h.ofNumber(c("LSMessageSearchType").THREAD);function a(a,b,d){return d.length===0?Promise.resolve():Promise.all([m(a,b,d),n(a,b,d)]).then(c("emptyFunction"))}async function l(a,b){var c=await d("MAWFTSRawStringMatcher").load();return b.filter(function(b){b=(b=b.msg)==null?void 0:b.content;return b==null?!1:c(a,b)})}async function m(a,b,e){var f=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.message_search_queries).getKeyRange(j));if(f.length===0)return;return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(b,e[0].chatJid,"MAWBridgeAddMessageSearchResultHandler",function(b,g){return async function(){var c=f.filter(function(a){return(i||(i=d("I64"))).equal(a.threadKeyV2,g)})[0];if(c==null)return;var h=c.query;if(h==null||h.length<2)return;var j=(i||(i=d("I64"))).to_int32(c.resultCount);h=await l(h,e);if(h.length===0)return;await d("MWInboxSecureContentSearch").addBridgeSearchMsgsToSearchResult(a,b,c.query,h,j+h.length,i.of_string(d("MAWCurrentUser").getID()))}().then(c("emptyFunction"))})}async function n(a,b,e){if(!c("isMAWUniversalSearchWithEBEnabled")())return;var f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(b.message_search_queries).getKeyRange(k).filter(function(a){return(i||(i=d("I64"))).equal(a.threadKeyV2,i.one)}));if(f==null)return;var g=f.query;if(g==null||g.length<2)return;var h=await l(g,e);if(h.length===0)return;c("promiseDone")(c("waitForMiActMappingForUniversalSearch")(a,e[0].chatJid),function(b){if(b!=null)return c("addMAWBridgeSearchMessagesToUniversalSearch")(a,b.serverThreadKey,g,h,f)})}g.call=a}),98);
__d("MAWBridgeCallRestoreNativeOpHandler",["I64","MAWMpsGating","Promise","WAJids","WALogger","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("requireDeferred")("LSProtobufRestoreHandler").__setRef("MAWBridgeCallRestoreNativeOpHandler"),l=c("requireDeferred")("LSRestoreEchoBlobs.nop").__setRef("MAWBridgeCallRestoreNativeOpHandler");function a(a,c){var e=c.chatJid,f=c.decryptedMessagesProtobufs,g=c.echoMessages,m=c.hasMoreAfter,n=c.hasMoreBefore,o=c.isPointQuery,p=c.nextMessageTimestampMsAfter,q=c.nextMessageTimestampMsBefore,r=c.referenceTimestamp,s=c.requestId,t=c.taskSource;if(d("MAWMpsGating").isFullMpsEnabled())return(j||(j=b("Promise"))).resolve();if(f!=null)return k.load().then(function(a){return a.handleProtobufRestoreHelper(d("WAJids").threadIdForChatJid(e),{convertedProtobufs:f,type:"convertedProtobufs"},n,q,m,p,o,s,r,void 0,void 0,t,e)});else if(g!=null)return l.load().then(function(c){return c(a,0,(i||(i=d("I64"))).zero,g,n,q,m,p,o,d("WAJids").threadIdForChatJid(e),s,r,t,e).then(function(){return(j||(j=b("Promise"))).resolve()})});else d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Unable to call restore native op - echo and protobuf messages are both null"])));return(j||(j=b("Promise"))).resolve()}g.call=a}),98);
__d("MAWBridgeDeleteGroupInviteHandler",["LSThreadBitOffset","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ReQL","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeDeleteGroupInviteHandler",async function(b,e){var f=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.group_invites).getKeyRange(e));return Promise.all(f.map(function(a){return b.group_invites.delete(a.threadKey,a.inviterId,a.inviteeId)})).then(function(){c("promiseDone")(d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(e)),function(b){if(b==null)return;var c=d("LSThreadBitOffset").clear([105],b.capabilities,b.capabilities2,b.capabilities3,b.capabilities4,b.capabilities5),e=c[0],f=c[1],g=c[2],h=c[3];c=c[4];return a.threads.put(babelHelpers.extends({},b,{capabilities:e,capabilities2:f,capabilities3:g,capabilities4:h,capabilities5:c,snippet:void 0}))})})})}g.call=a}),98);
__d("MAWBridgeDeleteMessagesOfThreadHandler",["EBIsEbEnabled","LSFactory","LSIntEnum","LSIssueThreadRemoveStoredProcedure","LSMEBTaskCreationSource"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b){if(b.actionType===2){if(!await d("EBIsEbEnabled").isEbEnabledLS(a))return;await c("LSIssueThreadRemoveStoredProcedure")(c("LSFactory")(a),{actThreadId:b.threadId,sortKey:b.ts.toString(),source:(h||(h=d("LSIntEnum"))).ofNumber(c("LSMEBTaskCreationSource").TAM_WEB)})}}g.call=a}),98);
__d("MAWBridgeEphemeralSettingsUpdatedForUIHandler",["MAWChatJid","MAWEphemeralSettingsUpdate","cr:17100"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,c){var e=await d("MAWChatJid").toThreadKeyMaybe(a,c.chatJid);return e!=null?d("MAWEphemeralSettingsUpdate").updateEphemeralSettingsWithTxn(a,c.ephemeralSettingArgs.ephemeralExpirationInSec,await b("cr:17100").castUnixTimeToMillisTime(c.ephemeralSettingArgs.ephemeralLastUpdatedOrSetTimestamp),c.isEphemeralSettingReset,e,!1,c.author):Promise.resolve()}g.call=a}),98);
__d("MAWBridgeFulfillRestorePromisePayloadHandler",["MAWAsyncEBPendingQueryPromise","MAWEBRestoreTrackingUtils","Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){a.success?(d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryUponReStore(a.value.traceId),d("MAWEBRestoreTrackingUtils").markEBRestoreSuccess(a.value.traceId)):(d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(a.error.traceId,c("err")(a.error.message)),d("MAWEBRestoreTrackingUtils").markEBRestoreFail(a.error.traceId));return(h||(h=b("Promise"))).resolve()}g.call=a}),98);
__d("MAWBridgeGQLUploadUtils",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";async function a(b,d){var a=await c("JSResourceForInteraction")("MAWEncryptedBackupsMessageUploadMutation").__setRef("MAWBridgeGQLUploadUtils").load();return a.uploadMessageOverGQL(b,d)}g.uploadMessageOverGQL=a}),98);
__d("MAWBridgeGroupInfoUpdatedHandler",["I64","MAWMiActMappingTableAPI","MWFBLogger","ODS","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=d("MWFBLogger").MWLogger().tags(["bridgeUIEvent","Occam","Middleware"]);async function a(a,b){var c,e=await d("MAWMiActMappingTableAPI").getMappingRowForChatJid(a,b.chatJid);if(e==null){m.WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Missing thread key for chatJid: ",""])),b.chatJid);return}c=(c=b.threadName)!=null?c:void 0;e=e.serverThreadKey;a=a.threads;var f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(e));if(f==null){(k||(k=d("ODS"))).bumpEntityKey(3185,"armadillo_group_info_update","missing_thread");m.WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Missing thread for updating group with threadKey: ",""])),(l||(l=d("I64"))).to_string(e));return}else c==null&&(c=f.threadName,m.WARN(j||(j=babelHelpers.taggedTemplateLiteralLoose(['MAWDB groupInfo is missing "name" field for threadKey: ',""])),(l||(l=d("I64"))).to_string(e)));e=b.memberAddMode!=="all_member_add";await a.put(babelHelpers.extends({},f,{needsAdminApprovalForNewParticipant:e,threadName:c}))}g.call=a}),98);
__d("MAWBridgeGroupInviteUpdateHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWUpdateLSThreadCapabilities","Promise","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,e){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,e.threadJid,"MAWBridgeGroupInviteUpdateHandler",function(a,f){var g=(i||(i=d("I64"))).of_string(e.inviterId);return(h||(h=b("Promise"))).all([d("MAWUpdateLSThreadCapabilities").setGroupInviteTxn(a,f,g)]).then(c("emptyFunction"))})}g.call=a}),98);
__d("MAWBridgeHandleCOPDigest",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){return(g||(g=b("Promise"))).resolve()}f.call=a}),66);
__d("MAWBridgeMediaExpiredHandler",["MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeMediaExpiredHandler.bs",function(a,c){return a.attachments["delete"](c,b.msgId,String(b.plaintextHash))})}g.call=a}),98);
__d("MAWBridgeMsgUpdatedHandler",["FBLogger","MAWAdminMsgCTA","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWMsgFetchLSReplyMsgAndAttachment","MAWUpdateMsg","MsgrWebGating","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.chatJid,"MAWBridgeMsgUpdatedHandler",async function(e,f){var g,i=await (g=d("ReQL")).firstAsync(g.fromTableAscending(e.messages.index("messageId")).getKeyRange(b.msgId));g=await g.firstAsync(g.fromTableAscending(e.attachments).getKeyRange(f,b.msgId));if(i==null){c("FBLogger")("messenger_web").info("existing message is null for type %s, and attachment is null: %s",b.type_,g==null);return}g=await d("MAWAdminMsgCTA").getAdminMsgCtaStep(e,f,b);f=await h(a,b);return d("MAWUpdateMsg").call(e,f,i,g)})}async function h(a,b){if(d("MsgrWebGating").isQuotedMessagesInLsEnabled()){a=await d("MAWMsgFetchLSReplyMsgAndAttachment").fetchReplyLocalViaLS(a,b);return a!=null?a:b}return Promise.resolve(b)}g.call=a}),98);
__d("MAWBridgeNewMediaRangeHandler",["I64","LSFactory","LSIntEnum","LSUpsertAttachmentRangeStoredProcedure","MAWMediaGalleryEBTaggingUtils","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","cr:20238","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,e){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,e.threadJid,"MAWBridgeNewMediaRangeHandler",function(a,f){var g=(h||(h=d("I64"))).of_float(e.earliestLoadedMediaTs),j=e.mediaGalleryGroup,k=b("cr:20238")!=null?b("cr:20238").getMediaRestoreEBRange().getRange(f):null;k=Boolean(k==null?void 0:k.hasMoreBefore)&&d("MAWMediaGalleryEBTaggingUtils").isMediaGalleryGroupSupportedForTaggedRestore(j);k=e.hasMoreBefore||k;return c("LSUpsertAttachmentRangeStoredProcedure")(c("LSFactory")(a),{hasMoreBefore:k,mediaGroup:(i||(i=d("LSIntEnum"))).ofNumber(j),newLastLoadedMessageId:e.lastLoadedMessageId,newMinTs:g,threadKey:f})})}function a(a,b){return j(a,b).then(c("emptyFunction"))}g.call=a}),98);
__d("MAWCreateOptimisticThread",["I64","LSAuthorityLevel","LSCreateOfflineThreadingIDStoredProcedure","LSFactory","LSIntEnum","LSMailboxType","LSRtcCallState"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function j(a){a=await c("LSCreateOfflineThreadingIDStoredProcedure")(c("LSFactory")(a),{timestampMs:(h||(h=d("I64"))).of_float(Date.now())});a=a[0];return a}async function k(a,b){var e={authorityLevel:(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),folderName:"inbox",lastReadWatermarkTimestampMs:(h||(h=d("I64"))).of_float(0),mailboxType:i.ofNumber(c("LSMailboxType").MESSENGER),ongoingCallState:i.ofNumber(c("LSRtcCallState").NO_ONGOING_CALL),parentThreadKey:h.zero,threadKey:b,threadType:i.ofNumber(15)};await a.threads.put(e);return b}async function a(a){var b=await j(a);await k(a,b);return b}g.createOfflineThreadingId=j;g.createOptimisticThreadWithThreadKey=k;g.createOptimisticThread=a}),98);
__d("MAWBridgeOccamadilloCreateE2EEMetadataThreadHandlerV2",["DedupMiThreadCreationCache","FBLogger","I64","LSAuthorityLevel","LSCreateE2EEMetadataThreadStoredProcedure","LSFactory","LSIntEnum","MAWCreateOptimisticThread","MAWFolderUtils","MAWJids","MAWThreadLoadingState","MAWThreadUtils"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j="[Occamadillo][CreateE2EEMetadataThreadHandlerV2]";async function a(a,b){var e=b.bumpTimestampMs,f=b.creationSource,g=b.folderId,i=b.jid;b=b.optimisticThreadKey;m(f,i);b=b!=null?await a.threads.get((h||(h=d("I64"))).of_string(b)):null;if(b!=null&&d("DedupMiThreadCreationCache").DedupMiThreadCreationCache.has(i)){q(i);return}if(b!=null&&k(b)){n(i,(h||(h=d("I64"))).to_string(b.threadKey));return}e={bumpTimestampMs:e,createdByLocalDevice:f==="outgoing_message",folderType:d("MAWFolderUtils").systemFolderToLSCoreClientFolder(g),offlineThreadKey:await l(b,i,a),threadType:d("MAWThreadUtils").getLSThreadTypeFromJid(i),waJid:d("MAWJids").convertChatJidToIntJid(i)};p(e);return c("LSCreateE2EEMetadataThreadStoredProcedure")(c("LSFactory")(a),e).then(function(){d("DedupMiThreadCreationCache").addToDedupMiThreadCreationCache(i)})}function k(a){a=(i||(i=d("LSIntEnum"))).unwrapIntEnum(a.authorityLevel);switch(a){case c("LSAuthorityLevel").CLIENT_PARTIAL:case c("LSAuthorityLevel").OPTIMISTIC:case c("LSAuthorityLevel").SERVER_PARTIAL:return!1;case c("LSAuthorityLevel").AUTHORITATIVE:case c("LSAuthorityLevel").AUTHORITATIVE_PENDING_REPLACEMENT:case c("LSAuthorityLevel").CLIENT_AUTHORITATIVE_DELETE:return!0;default:a;throw c("FBLogger")("messenger_web").mustfixThrow("Unknown authority level")}}async function l(a,b,c){if(a!=null)return Promise.resolve(a.threadKey);a=await d("MAWCreateOptimisticThread").createOfflineThreadingId(c);o(b,a);await Promise.all([d("MAWCreateOptimisticThread").createOptimisticThreadWithThreadKey(c,a),d("MAWThreadLoadingState").markActThreadLoadingAsCompleted(c,{intJid:d("MAWJids").convertChatJidToIntJid(b),threadKey:a})]);return a}function m(a,b){c("FBLogger")("messenger_web").info(j+" handler called from %s for jid %s",a,b)}function n(a,b){c("FBLogger")("messenger_web").info(j+" handler returned early for jid %s because thread %s was already authoritative",a,b)}function o(a,b){c("FBLogger")("messenger_web").info(j+" no thread exists for jid %s, creating optimistic thread with key %s",a,(h||(h=d("I64"))).to_string(b))}function p(a){c("FBLogger")("messenger_web").info(j+" Calling LSCreateE2EEMetadataThreadStoredProcedure with params: bumpTimestampMs: %s, createdByLocalDevice: %s, folderType: %s, offlineThreadKey: %s, offlineThreadKeySource: %s, threadType: %s, waJid: %s",(h||(h=d("I64"))).to_string(a.bumpTimestampMs),a.createdByLocalDevice,h.to_string(a.folderType),h.to_string(a.offlineThreadKey),h.to_string(a.threadType),h.to_string(a.waJid))}function q(a){c("FBLogger")("messenger_web").info(j+" LSCreateE2EEMetadataThreadStoredProcedure has already been called for jid %s, early returning",a)}g.call=a}),98);
__d("MAWBridgeParticipantRemovedHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeParticipantRemovedHandler",function(a,c){return a.participants["delete"](c,(h||(h=d("I64"))).of_string(b.userId))})}g.call=a}),98);
__d("MAWBridgeRavenActionMsgForUIHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWMsg","MAWRavenUtils","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h=["ephemeralMediaState"],i;function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeRavenActionMsgForUIHandler",async function(a,c){a=a.attachments;c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a).getKeyRange(c,b.ravenMsgId));if(c==null)return Promise.resolve();if(c.ephemeralMediaState==null)return Promise.resolve();var e=(i||(i=d("I64"))).to_int32(c.ephemeralMediaState);if(c.ephemeralMediaViewMode==null)return Promise.resolve();var f=i.to_int32(c.ephemeralMediaViewMode);e=d("MAWMsg").MAWRavenMsgEphemeralMediaState.cast(e);f=d("MAWMsg").MAWRavenMsgEphemeralType.cast(f);if(e==null||f==null)return Promise.resolve();e=d("MAWRavenUtils").getNextRavenMessageEphemeralState(e,f);if(e==null)return Promise.resolve();c.ephemeralMediaState;f=babelHelpers.objectWithoutPropertiesLoose(c,h);c=babelHelpers.extends({ephemeralMediaState:i.of_int32(e)},f,{transportKey:"WhatsApp"});e=[f.threadKey,f.messageId,f.attachmentFbid];return a.upsert(e,c)})}g.call=a}),98);
__d("MAWBridgeReceivedReceiptHandler",["I64","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWTimeUtils","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;async function i(a,b,c){var e=(h||(h=d("I64"))).of_string(b.fbid);b=d("MAWTimeUtils").toTimestamp(b.deliveredWatermarkTs);c=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.participants).getKeyRange(c,e));c!=null&&await a.participants.put({authorityLevel:c.authorityLevel,contactId:c.contactId,deliveredWatermarkTimestampMs:(h||(h=d("I64"))).equal(b,(h||(h=d("I64"))).zero)?c.deliveredWatermarkTimestampMs:b,groupParticipantJoinState:c.groupParticipantJoinState,isAdmin:c.isAdmin,isModerator:c.isModerator,isSuperAdmin:c.isSuperAdmin,nickname:c.nickname,normalizedSearchTerms:c.normalizedSearchTerms,participantCapabilities:c.participantCapabilities,readActionTimestampMs:c.readActionTimestampMs,readWatermarkTimestampMs:c.readWatermarkTimestampMs,subscribeSource:c.subscribeSource,threadKey:c.threadKey,threadRoles:(h||(h=d("I64"))).zero})}function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.chatJid,"MAWBridgeReceivedReceiptHandler",function(a,c){return i(a,b,c)})}g.callWithoutWaitingForAnything=i;g.call=a}),98);
__d("MAWBridgeRefreshContactHandler",["LSFactory","LSRefetchContactRowIfExistsStoredProcedure"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return c("LSRefetchContactRowIfExistsStoredProcedure")(c("LSFactory")(a),{id:b})}g.call=a}),98);
__d("MAWBridgeRemoveMessageSearchResultHandler",["ReQL","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return async function(){var c=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.message_search_results).filter(function(a){return b.includes(a.messageOtid)}));await Promise.all(c.map(function(b){return a.message_search_results.delete(b.type_,b.query,b.threadKey,b.globalIndex)}))}().then(c("emptyFunction"))}g.call=a}),98);
__d("MAWBridgeResignAttachmentCDNUrlHandler",["I64","LSFactory","LSIssueAttachmentRestoreTaskStoredProcedure","MAWAsyncEBMediaDownloadPromise","MAWBridgeFireAndForget","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";var h,i="-8";function a(a,b){var e,f=b.traceId,g=(e=b.skipLegacyMediaDownloadFlow)!=null?e:!1;function j(a,b,c){!g&&f!=null&&d("MAWBridgeFireAndForget").fireAndForget("backend","addMediaDownloadQpl",{annotations:c!=null?c:void 0,pointName:b,qplInstanceKey:f,qplType:a})}j("point","resign_cdn_url_bridge_handler_start");return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeResignAttachmentCDNUrlHandler",function(a,e){e={backupEntFbid:(h||(h=d("I64"))).of_string(i),deliveryObjectId:b.deliveryObjectId,mediaType:b.mediaType,messageId:b.messageId,productType:b.productType,serverThreadKey:h.to_string(e),sortOrder:h.of_float(b.sortOrder),threadId:b.threadId,traceId:f.toString()};b.skipLegacyMediaDownloadFlow!==!0&&d("MAWAsyncEBMediaDownloadPromise").setMediaDownloadPayload({messageId:b.msgId,objectId:b.deliveryObjectId,plaintextHash:b.plaintextHash,threadId:b.threadId});j("point","resign_cdn_url_issue_attachment_task",{string:{taskTraceId:e.traceId}});return c("LSIssueAttachmentRestoreTaskStoredProcedure")(c("LSFactory")(a),e).then(function(){j("point","resign_cdn_url_issue_attachment_task_end")})["catch"](function(a){j("fail","resign_cdn_url_issue_attachment_task_fail",{string:{error:a.toString()}})})})}g.call=a}),98);
__d("MAWBridgeStartTraceWithTraceIdHandler",["MAWMainTraceUtils","MAWTimeUtils","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMainTraceUtils").startTraceWithTxn(a,d("MAWTimeUtils").toTimestamp(d("WATimeUtils").unixTime()),b.traceId,b.traceType,void 0,void 0,b.traceContext)}g.call=a}),98);
__d("MAWBridgeSyncContacts",["CurrentMessengerUser","I64","LSAuthorityLevel","LSContactBlockedByViewerStatus","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSIntEnum","LSVerifyContactRowExistsStoredProcedure","Promise","emptyFunction"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("CurrentMessengerUser").getID();function a(a,e){return e.reduce(function(b,e){var f=(i||(i=d("I64"))).of_string(e);return b.then(function(){return c("LSVerifyContactRowExistsStoredProcedure")(c("LSFactory")(a),{authorityLevel:(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC),blockedByViewerStatus:j.ofNumber(c("LSContactBlockedByViewerStatus").UNBLOCKED),contactIdType:j.ofNumber(c("LSContactIdType").FBID),contactType:j.ofNumber(c("LSContactType").USER),contactViewerRelationship:j.ofNumber(c("LSContactViewerRelationship").UNKNOWN),gender:j.ofNumber(c("LSContactGender").UNKNOWN),id:f,isBlocked:!1,isMemorialized:!1,isSelf:k===e,workForeignEntityType:j.ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN)})}).then(c("emptyFunction"))},(h||(h=b("Promise"))).resolve())}g.call=a}),98);
__d("MAWBridgeThreadHiddenV2Handler",["LSFactory","LSIntEnum","LSOptimisticRemoveThreadStoredProcedure","LSThreadRemoveType","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b,"MAWBridgeThreadHiddenV2Handler",function(a,b){a=c("LSFactory")(a);return c("LSOptimisticRemoveThreadStoredProcedure")(a,{removeType:(h||(h=d("LSIntEnum"))).ofNumber(c("LSThreadRemoveType").DELETE_THREAD),threadKey:b})})}g.call=a}),98);
__d("MAWBridgeThreadUpdatedHandler",["MAWBridgeBuildThreadSnippet","MAWBridgeUIEventDataValidation","MAWFolderUtils","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ReQL","getMAWLastMessageCtaType"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){var c=b.folder!=null?d("MAWFolderUtils").getMessagingFolderTag(b.folder):a.folderName;return(b=b.cannotReplyReason)!=null?b:c==="inbox"?void 0:a.cannotReplyReason}async function i(a,b,e){e=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.threads).getKeyRange(e));if(e==null)return;var f=d("MAWBridgeBuildThreadSnippet").buildBridgeThreadSnippet(b,e.snippet),g=h(e,b),i=c("getMAWLastMessageCtaType")(b.snippetType);g=babelHelpers.extends({},e,{cannotReplyReason:g,folderName:e.folderName,lastMessageCtaType:i,parentThreadKey:e.parentThreadKey,snippet:f,snippetSenderContactId:b.snippetSenderContactId==null?e.snippetSenderContactId:d("MAWBridgeUIEventDataValidation").stringToI64Opt(b.snippetSenderContactId)});await a.threads.put(g)}function a(a,b){var c=b.threadJid;return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,c,"MAWBridgeThreadUpdatedHandler",function(a,c){return i(a,b,c)})}g.callWithoutWaitingForAnything=i;g.call=a}),98);
__d("MAWBridgeUIEventQueueQPLLogger",["QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("QPLUserFlow").start(c("qpl")._(1056849266,"1765"),{annotations:{string_array:{events:b}},instanceKey:a})}function b(a,b){c("QPLUserFlow").addAnnotations(c("qpl")._(1056849266,"1765"),b,{instanceKey:a})}function d(a){c("QPLUserFlow").endSuccess(c("qpl")._(1056849266,"1765"),{instanceKey:a})}function e(a,b){c("QPLUserFlow").endFailure(c("qpl")._(1056849266,"1765"),"MAWBridgeUIEventHandlerFailure",{annotations:{string:{failedEventTag:b}},instanceKey:a})}g.start=a;g.addAnnotations=b;g.endSuccess=d;g.endFailure=e}),98);
__d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler",["Promise"],(function(a,b,c,d,e,f){"use strict";var g;function a(a,c){return(g||(g=b("Promise"))).resolve()}f.call=a}),66);
__d("MAWBridgeUpdateContactAsConnectedHandler",["FBLogger","I64","LSAddMessengerContactStoredProcedure","LSContactViewerRelationship","LSFactory","LSIntEnum","LSOptimisticAcceptMessageRequestStoredProcedure","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWUpdateLSThreadCapabilities","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a,b){var e=b.contactUserId;b=b.threadJid;var f=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.contacts).getKeyRange((h||(h=d("I64"))).of_string(e)));if(f==null){c("FBLogger")("messenger_web").warn("Missing contact in MAWBridgeUpdateContactAsConnectedHandler");return}var g=babelHelpers.extends({},f,{contactViewerRelationship:(i||(i=d("LSIntEnum"))).ofNumber(c("LSContactViewerRelationship").CONTACT_OF_VIEWER)});return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b,"MAWBridgeUpdateContactAsConnectedHandler",async function(a,b){await Promise.allSettled([a.contacts.upsert([f.id],g),c("LSAddMessengerContactStoredProcedure")(c("LSFactory")(a),{contactId:f.id}),d("MAWUpdateLSThreadCapabilities").updateNonMessageRequestThreadTxn(a,b),c("LSOptimisticAcceptMessageRequestStoredProcedure")(c("LSFactory")(a),{threadKey:b})])})}g.call=a}),98);
__d("MAWBridgeUpdateE2EEMetadataParticipantsHandler",["LSFactory","LSUpdateE2EEMetadataParticipantsStoredProcedure","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeThreadsLoadedHandler",function(a,b){return c("LSUpdateE2EEMetadataParticipantsStoredProcedure")(c("LSFactory")(a),{threadKey:b})})}g.call=a}),98);
__d("MAWBridgeUpdateThreadActivityHandler",["I64","LSBumpE2EEMetadataThreadStoredProcedure","LSFactory","MAWChatJid","MAWJids","MAWMiActGetThreadLifecycleState__DO_NOT_USE","MWFBLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i=d("MWFBLogger").MWLogger().tags(["bridgeUIEvent","Occam","ActivityUpdate"]);async function a(a,b){var c=await d("MAWChatJid").toThreadMaybe(a,b.chatJid);if(c==null){await n(a,b.chatJid);return}switch(b.source){case"outgoing_msg":case"incoming_msg":return j(a,c,b);case"deleted_msg":return k(a,c,b);case"inserted_admin_msg":return m(c,b,"No bump for admin message");case"eb_restore":return i.warn("Attempted bump from EB restore");default:b.source;throw i.mustfixThrow("Unknown source")}}async function j(a,b,d){if(l(b,d)){m(b,d,"Stale incoming bump");return}await c("LSBumpE2EEMetadataThreadStoredProcedure")(c("LSFactory")(a),{bumpedByLocalDeviceSend:d.source==="outgoing_msg",isUnbump:!1,serverAuthoritativeTimestampMs:d.bumpTimestampMs,threadKey:b.threadKey});m(b,d,"Thread bumped")}async function k(a,b,c){await a.threads.put(babelHelpers.extends({},b,{lastActivityTimestampMs:(h||(h=d("I64"))).min(b.lastActivityTimestampMs,c.bumpTimestampMs),lastReadWatermarkTimestampMs:h.min(b.lastReadWatermarkTimestampMs,c.bumpTimestampMs)})),m(b,c,"Thread unbumped")}function l(a,b){return b.source==="incoming_msg"&&(h||(h=d("I64"))).le(b.bumpTimestampMs,a.lastActivityTimestampMs)}function m(a,b,c){b=[(h||(h=d("I64"))).to_string(a.threadKey),b.source,h.to_string(b.bumpTimestampMs),h.to_string(a.lastActivityTimestampMs),h.to_string(a.lastReadWatermarkTimestampMs)];i.debug.apply(i,[c+". threadKey: %s, source: %s, bumpTimestampMs: %s, originalLastActivityTimestampMs: %s, originalLastReadWatermarkTimestampMs: %s"].concat(b))}async function n(a,b){a=await d("MAWMiActGetThreadLifecycleState__DO_NOT_USE").getThreadLifecycleStateByJid(a,d("MAWJids").convertChatJidToIntJid(b),"MAWBridgeUpdateThreadActivityHandler");i.mustfix("Missing LSDBThread when updating thread activity. jid: %s, thread state: %s",b,a.type)}g.call=a}),98);
__d("MAWBridgeUpdateTraceHandler",["ArmadilloDataTraceCheckPoint","I64","LSAppendDataTraceAddonStoredProcedure","LSDataTraceCheckPoint","LSFactory","LSIntEnum","MAWBridgeTraceEvent","Promise","ReQL","emptyFunction","updateAndFlushLSDataTrace"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(a,e,f){return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.data_trace_meta).filter(function(a){var b=a.contextThree;if(b!=null&&e.externalIds.includes(b)&&(j||(j=d("I64"))).equal(a.traceType,e.traceType))return a.shouldFlush===!1;else return!1})).then(function(g){var i=[];return g.reduce(function(b,g){return b.then(function(){i.push(g.traceId);var b=e.errorMessage;if(b!=null)return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:f,dataTraceId:g.traceId,errorMessage:b,syncChannel:(j||(j=d("I64"))).neg_one});else return c("LSAppendDataTraceAddonStoredProcedure")(c("LSFactory")(a),{checkPointId:f,dataTraceId:g.traceId,syncChannel:(j||(j=d("I64"))).neg_one})})},(h||(h=b("Promise"))).resolve()).then(function(){return i})})}function l(a,d){return d.reduce(function(b,d){return b.then(function(){return c("updateAndFlushLSDataTrace")(a,d)})},(h||(h=b("Promise"))).resolve())}function a(a,e){var f=e.event;if(f===c("MAWBridgeTraceEvent").ReceivedReceipt)return k(a,e,d("ArmadilloDataTraceCheckPoint").deliveryReceiptReceived).then(function(b){return l(a,b)});else if(f===c("MAWBridgeTraceEvent").ReceivedSent)return k(a,e,d("ArmadilloDataTraceCheckPoint").advancedCryptoMEMSendTaskComplete).then(c("emptyFunction"));else if(f===c("MAWBridgeTraceEvent").FlowEndForFailure)return k(a,e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE)).then(function(b){return l(a,b)});else if(f===c("MAWBridgeTraceEvent").FlowEndForSuccess)return k(a,e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_AND_FLUSH)).then(function(b){return l(a,b)});else return(h||(h=b("Promise"))).resolve()}g.call=a}),98);
__d("MAWBridgeUploadAttachmentHandler",["I64","LSDataTraceCheckPoint","LSFactory","LSIntEnum","LSIssueAttachmentBackupTaskStoredProcedure","LSRequestId","MAWEBFrontendQPLLogger","MAWEncryptedBackupUtils","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","MAWTimeUtils","MAWTraceUtils","Promise","isInstamadilloEB"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a,e){var f;if(c("isInstamadilloEB")())return(j||(j=b("Promise"))).resolve();var g=(f=e.traceId)!=null?f:c("LSRequestId").generate();f=e.mediaType;if(f==="document"){d("MAWTraceUtils").recordInvalidUploadRequestAndFlushTrace(g,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_ECHO_MESSAGE_UPLOAD_INVALID_REQUEST),[]);return(j||(j=b("Promise"))).resolve()}return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,e.threadJid,"MAWBridgeUploadAttachmentHandler",function(a,f){var k=(i||(i=d("I64"))).to_string(f),l=d("MAWTimeUtils").isTimestampNewerThanXDays(e.ts,30);return d("MAWEncryptedBackupUtils").getBackupTenancy(a,g).then(function(f){var i=e.productType;if(f!=null&&l)if(g!=null){d("MAWEBFrontendQPLLogger").startFlowUploadAttachmentBackup({deliveryObjectId:e.deliveryObjectId,flow:"old",mediaType:e.mediaType,messageId:e.messageId,threadId:e.threadId,traceId:g});return c("LSIssueAttachmentBackupTaskStoredProcedure")(c("LSFactory")(a),{deliveryObjectId:e.deliveryObjectId,mediaType:e.mediaType,messageId:e.messageId,productType:i,serverThreadKey:k,threadId:e.threadId,traceId:g})}else return c("LSIssueAttachmentBackupTaskStoredProcedure")(c("LSFactory")(a),{deliveryObjectId:e.deliveryObjectId,mediaType:e.mediaType,messageId:e.messageId,productType:i,serverThreadKey:k,threadId:e.threadId});else{d("MAWTraceUtils").recordInvalidUploadRequestAndFlushTrace(g,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_WEB_ECHO_MESSAGE_UPLOAD_INVALID_REQUEST),[]);d("MAWEBFrontendQPLLogger").endFlowUploadAttachmentBackup(g,!1,"old");return(j||(j=b("Promise"))).resolve()}})})}g.call=a}),98);
__d("MAWBridgeUploadMessageByBatchHandler",["MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUploadMessageHandler","MAWEBFrontendQPLLogger","QPLUserFlow","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){a.forEach(function(a){a.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(a.uploadTrackingInstanceKey,b)})}async function a(a,b){h(b.messages,"upload_tracking_bridge_batch_handler");b.qpl.forEach(function(a){return c("QPLUserFlow").addPoint(a.event,a.action.name,{instanceKey:a.instanceKey,timestamp:a.timestamp})});b.checkPoint.forEach(function(b){return c("promiseDone")(d("MAWBridgeTraceRecordCheckpointHandler").call(a,b))});for(b of b.messages)await d("MAWBridgeUploadMessageHandler").call(a,b);return Promise.resolve()}g.call=a}),98);
__d("MAWBridgeXMAShareExpiredHandler",["MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","Promise"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a,c,d){var e=String(d.xmaId);return a.attachments.get(c,d.msgId,e).then(function(f){if(f==null)return(h||(h=b("Promise"))).resolve();f=[f.defaultCtaId,f.attachmentCta1Id,f.attachmentCta2Id,f.attachmentCta3Id].filter(Boolean);f=f.map(function(b){return a.attachment_ctas["delete"](b)});return(h||(h=b("Promise"))).all(f).then(function(){return a.attachments["delete"](c,d.msgId,e)})})}function a(a,b){return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeXMAShareExpiredHandler",function(a,c){return i(a,c,b)})}g.callWithoutWaitingForAnything=i;g.call=a}),98);
__d("MAWBridgeXMAShareTombstonedHandler",["FBLogger","MAWMiActOnMiThreadExistsForJid__DO_NOT_USE","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var e=String(b.xmaId);return d("MAWMiActOnMiThreadExistsForJid__DO_NOT_USE").onMiThreadExistsForJidNoThrow__DO_NOT_USE(a,b.threadJid,"MAWBridgeXMAShareTombstonedHandler",function(a,f){return a.attachments.get(f,b.msgId,e).then(function(g){if(g==null)return Promise.resolve();g=[g.defaultCtaId,g.attachmentCta1Id,g.attachmentCta2Id,g.attachmentCta3Id].filter(Boolean);g=g.map(function(b){return a.attachment_ctas.delete(b)});return Promise.all(g).then(function(){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.attachments).getKeyRange(f,b.msgId,e)).then(async function(b){if(b!=null){b=babelHelpers.extends({},b,{attachmentCta1Id:void 0,attachmentCta2Id:void 0,attachmentCta3Id:void 0,cta1Title:void 0,cta1Type:void 0,cta2Title:void 0,cta2Type:void 0,cta3Title:void 0,cta3Type:void 0,defaultCtaId:void 0,defaultCtaTitle:void 0,maxSubtitleNumOfLines:void 0,maxTitleNumOfLines:void 0,previewHeight:void 0,previewHeightLarge:void 0,previewWidth:void 0,previewWidthLarge:void 0,subtitleText:void 0,titleText:void 0});await a.attachments.put(b)}c("FBLogger")("messenger_web_sharing").blameToPreviousFrame().mustfix("Trying to tombstone a secure xma attachment but no existing attachment");return Promise.resolve()})})})})}g.call=a}),98);
__d("isInstamadilloDYI",["qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){return c("qex")._("665")===!0}g["default"]=a}),98);
__d("MAWBridgeUIEventHandler",["EBLogger","MAWAbPropsClient","MAWBridgeAddMessageSearchResultHandler","MAWBridgeCallRestoreNativeOpHandler","MAWBridgeDeleteGroupInviteHandler","MAWBridgeDeleteMessagesHandler","MAWBridgeDeleteMessagesOfThreadHandler","MAWBridgeDeleteReactionHandler","MAWBridgeDropAllSecureThreadsHandler","MAWBridgeEditMsgHistoryAddedHandler","MAWBridgeEphemeralSettingsUpdatedForUIHandler","MAWBridgeFulfillRestorePromisePayloadHandler","MAWBridgeGroupInfoUpdatedHandler","MAWBridgeGroupInviteLoadedHandler","MAWBridgeGroupInviteUpdateHandler","MAWBridgeHandleCOPDigest","MAWBridgeMediaExpiredHandler","MAWBridgeMsgUpdatedHandler","MAWBridgeMsgsStartCountdownHandler","MAWBridgeNewMediaHandler","MAWBridgeNewMediaRangeHandler","MAWBridgeNewMsgHandler","MAWBridgeNewPollHandler","MAWBridgeNewReceiverFetchInfoHandler","MAWBridgeNewXMAHandler","MAWBridgeOccamadilloCreateE2EEMetadataThreadHandlerV2","MAWBridgeOccamadilloVerifyThreadExistsHandler","MAWBridgeOneToOneMessageRequestLoadedHandler","MAWBridgeParticipantRemovedHandler","MAWBridgeParticipantsUpdatedHandler","MAWBridgeRavenActionMsgForUIHandler","MAWBridgeReactionUpsertHandler","MAWBridgeReceivedChatStateHandler","MAWBridgeReceivedReceiptHandler","MAWBridgeRefreshContactHandler","MAWBridgeRemoveMessageSearchResultHandler","MAWBridgeResignAttachmentCDNUrlHandler","MAWBridgeStartTraceHandler","MAWBridgeStartTraceWithTraceIdHandler","MAWBridgeSyncContacts","MAWBridgeThreadHiddenV2Handler","MAWBridgeThreadUpdatedHandler","MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUIEventQueueQPLLogger","MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler","MAWBridgeUpdateClientRestoreStatus","MAWBridgeUpdateContactAsConnectedHandler","MAWBridgeUpdateE2EEMetadataParticipantsHandler","MAWBridgeUpdateThreadActivityHandler","MAWBridgeUpdateTraceHandler","MAWBridgeUploadAttachmentHandler","MAWBridgeUploadMessageByBatchHandler","MAWBridgeUploadMessageHandler","MAWBridgeXMAShareExpiredHandler","MAWBridgeXMAShareTombstonedHandler","MAWEphemeralMessageExpirationStorage","MAWLoggerUtils","MWFBLogger","WAResultOrError","WATimeUtils","emptyFunction","getErrorSafe","isArmadillo","isInstamadilloDYI","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=d("MWFBLogger").MWLogger().tags(["MAWBridgeUIEvent"]);function l(a,b,c){switch(c.tag){case"NewMsg":return d("MAWBridgeNewMsgHandler").call(b,c.value);case"MsgsStartCountdown":return d("MAWBridgeMsgsStartCountdownHandler").call(b,c.value);case"MsgClearCountdown":return Promise.resolve(d("MAWEphemeralMessageExpirationStorage").clearMessageFromExpiration(c.value));case"DropAllSecureThreads":return d("MAWBridgeDropAllSecureThreadsHandler").call(b);case"VerifyThreadExists":var e=c.value;return d("MAWBridgeOccamadilloVerifyThreadExistsHandler").call(b,e);case"CreateE2EEMetadataThreadV2":return d("MAWBridgeOccamadilloCreateE2EEMetadataThreadHandlerV2").call(b,c.value);case"EditMsgHistoryAdded":return d("MAWBridgeEditMsgHistoryAddedHandler").call(a,b,c.value);case"MsgUpdated":return d("MAWBridgeMsgUpdatedHandler").call(b,c.value);case"NewMedia":return d("MAWBridgeNewMediaHandler").call(b,c.value);case"NewMediaRange":return d("MAWBridgeNewMediaRangeHandler").call(b,c.value);case"MediaExpired":return d("MAWBridgeMediaExpiredHandler").call(b,c.value);case"XMAShareExpired":return d("MAWBridgeXMAShareExpiredHandler").call(b,c.value);case"NewXMA":return d("MAWBridgeNewXMAHandler").call(b,c.value);case"XMAShareTombstoned":return d("MAWBridgeXMAShareTombstonedHandler").call(b,c.value);case"ParticipantRemoved":return d("MAWBridgeParticipantRemovedHandler").call(b,c.value);case"UpdateE2EEMetadataParticipants":return d("MAWBridgeUpdateE2EEMetadataParticipantsHandler").call(b,c.value);case"ReceivedReceipt":return d("MAWBridgeReceivedReceiptHandler").call(b,c.value);case"ThreadUpdated":return d("MAWBridgeThreadUpdatedHandler").call(b,c.value);case"GroupInfoUpdated":return d("MAWBridgeGroupInfoUpdatedHandler").call(b,c.value);case"UpdateThreadActivity":return d("MAWBridgeUpdateThreadActivityHandler").call(b,c.value);case"StartTrace":return d("MAWBridgeStartTraceHandler").call(b,c.value);case"UpdateTrace":return d("MAWBridgeUpdateTraceHandler").call(b,c.value);case"ThreadHiddenV2":return d("MAWBridgeThreadHiddenV2Handler").call(b,c.value);case"SyncContacts":return d("MAWBridgeSyncContacts").call(b,c.value);case"ReceivedChatState":return d("MAWBridgeReceivedChatStateHandler").call(b,c.value);case"ClockSkewUpdated":return Promise.resolve(d("WATimeUtils").setClockSkew(c.value));case"ABPropsUpdated":k.warn("ABPropsUpdated has been deprecated. Please use the bridge with ABPropsUpdated");return Promise.resolve(d("MAWAbPropsClient").rewrite(c.value));case"COPDigestReceived":return d("MAWBridgeHandleCOPDigest").call(b,c.value);case"UpsertReaction":return d("MAWBridgeReactionUpsertHandler").call(b,c.value);case"DeleteReaction":return d("MAWBridgeDeleteReactionHandler").call(b,c.value);case"UploadMessage":return d("MAWBridgeUploadMessageHandler").call(b,c.value);case"UploadMessageByBatch":return d("MAWBridgeUploadMessageByBatchHandler").call(b,c.value);case"DeleteMessagesOfThread":return d("MAWBridgeDeleteMessagesOfThreadHandler").call(b,c.value);case"UploadAttachment":return d("MAWBridgeUploadAttachmentHandler").call(b,c.value);case"ResignAttachmentCDNUrl":return d("MAWBridgeResignAttachmentCDNUrlHandler").call(b,c.value);case"DeleteMessages":return d("MAWBridgeDeleteMessagesHandler").call(b,c.value);case"RestoreMessageBatch":d("EBLogger").EBLogger().tags(["labyrinth_dyi"]).WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Attempted to call the old DYI V1 flow"])));return Promise.resolve();case"OneToOneMessageRequestLoaded":return d("MAWBridgeOneToOneMessageRequestLoadedHandler").call(b,c.value);case"GroupInviteUpdate":return d("MAWBridgeGroupInviteUpdateHandler").call(b,c.value);case"UpdateDyiStatus":d("EBLogger").EBLogger().tags(["labyrinth_dyi"]).WARN(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Attempted to call the old DYI V1 flow"])));return Promise.resolve();case"DeleteGroupInvite":return d("MAWBridgeDeleteGroupInviteHandler").call(b,c.value);case"TraceRecordCheckpoint":return d("MAWBridgeTraceRecordCheckpointHandler").call(b,c.value);case"ParticipantsUpdated":return d("MAWBridgeParticipantsUpdatedHandler").call(b,c.value);case"StartTraceWithTraceId":return d("MAWBridgeStartTraceWithTraceIdHandler").call(b,c.value);case"UpdateClientRestoreStatus":return d("MAWBridgeUpdateClientRestoreStatus").call(b,c.value);case"NewMsgs":return d("MAWBridgeNewMsgHandler").bulkCall(b,c.value.msgs);case"UnArchivedSelfDeviceChangeAlerts":return d("MAWBridgeUnArchivedSelfDeviceChangeAlertsHandler").call(b,c.value);case"EphemeralSettingsUpdatedForUI":return d("MAWBridgeEphemeralSettingsUpdatedForUIHandler").call(b,c.value);case"RavenActionUpdate":return d("MAWBridgeRavenActionMsgForUIHandler").call(b,c.value);case"GroupInviteLoaded":return d("MAWBridgeGroupInviteLoadedHandler").call(b,c.value);case"RemoveMessageSearchResult":return d("MAWBridgeRemoveMessageSearchResultHandler").call(b,c.value);case"AddMessageSearchResult":return d("MAWBridgeAddMessageSearchResultHandler").call(a,b,c.value);case"FulfillRestorePromise":return d("MAWBridgeFulfillRestorePromisePayloadHandler").call(c.value);case"UpdateContactAsConnected":return d("MAWBridgeUpdateContactAsConnectedHandler").call(b,c.value);case"RefreshContact":return d("MAWBridgeRefreshContactHandler").call(b,c.value);case"NewReceiverFetchInfo":return d("MAWBridgeNewReceiverFetchInfoHandler").call(b,c.value);case"RestoreNativeOp":return d("MAWBridgeCallRestoreNativeOpHandler").call(b,c.value);case"NewPoll":return d("MAWBridgeNewPollHandler").call(b,c.value);default:return Promise.resolve()}}function a(a,b){if(!c("isArmadillo")()&&!c("isInstamadilloDYI")()){k.mustfix("User is neither part of armadillo QE and dual send QE but somehow loaded this handler");return}if(!(b.length===1&&b[0].tag==="TraceRecordCheckpoint")){var d={};d=b.reduce(function(a,b){a[b.tag]=((b=a[b.tag])!=null?b:0)+1;return a},d);k.DEBUG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Handle UI Events: ",""])),JSON.stringify(d))}c("promiseDone")(m(a,b),c("emptyFunction"),function(a){k.catching(a).mustfix("[MAWBridgeUIEventHandler] Failed to handle UI events: %s",b.map(function(a){return a.tag}).join(", "))})}async function m(a,b){var e=await a;a=d("MAWLoggerUtils").getInstanceKey();var g=b.map(function(a){return a.tag}),h="";d("MAWBridgeUIEventQueueQPLLogger").start(a,g);d("MAWBridgeUIEventQueueQPLLogger").addAnnotations(a,{int:{queue_size:b.length}});var i;try{i=await e.runInTransaction(async function(a){for(var f=0;f<b.length;f++){var g=b[f];try{await l(e,a,g)}catch(a){h=g.tag;return d("WAResultOrError").makeError(c("getErrorSafe")(a))}}return d("WAResultOrError").makeResult(!0)},"readwrite","background",{events:b,type:"maw_ui_bridge"},f.id+":285")}catch(a){i=d("WAResultOrError").makeError(c("getErrorSafe")(a))}!i.success?(d("MAWBridgeUIEventQueueQPLLogger").endFailure(a,h),k.catching(i.error).mustfix("MAWBridgeUIEventHandler] Did not commit UI events to DB, failed at %s, all events: %s",h,g.toString())):d("MAWBridgeUIEventQueueQPLLogger").endSuccess(a)}async function b(a,b,d){try{await l(a,b,d)}catch(b){a=c("getErrorSafe")(b);k.catching(a).mustfix("[handleShimEvent] Failed to handle UI event: %s",d.tag);throw b}}g.handleEvents=a;g.handleShimEvent=b}),98);
__d("MAWBridgeUpdateDYIStatusV2",["EBLogger","EncryptedBackupdDYIFileSaver","EncryptedBackupsDYIFileUtils","EncryptedBackupsDYITypes","QPLUserFlow","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";async function h(a,b,e){d("EncryptedBackupdDYIFileSaver").saveFile(a,b),window.setTimeout(function(){c("promiseDone")(e())},1e3)}async function a(a){var b=a.qplEvent,e=a.qplInstanceKeyE2E;a=a.status;var f=d("EBLogger").EBLogger().tags(["dyi"]);if(a===d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Completed)try{if(navigator.storage==null)throw f.mustfixThrow("Storage management API is not supported. Please try one of the supported browsers.");var g=d("EncryptedBackupsDYIFileUtils").DyiArchiveFilename,i=await d("EncryptedBackupsDYIFileUtils").getRootFolderHandle(),j=await d("EncryptedBackupsDYIFileUtils").readFile(i,g);await h(g,j,async function(){await i.removeEntry(g)});f.info("Saving file with filename ",g);b!=null&&e!=null&&c("QPLUserFlow").endSuccess(b,{instanceKey:e});f.info("DYI Complete")}catch(a){f.mustfix("Failed to download the DYI archive: %s",a);b!=null&&e!=null&&c("QPLUserFlow").endFailure(b,a.message,{instanceKey:e});return d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Failed}a===d("EncryptedBackupsDYITypes").EncryptedBackupsDYIState.Failed&&(b!=null&&e!=null&&c("QPLUserFlow").endFailure(b,"Unknown error",{instanceKey:e}));return a}g.call=a}),98);
__d("MAWBridgeUploadMessageGQLHandlerSingleTxn",["EBBucketUtils","EBIsEbEnabled","EncryptedBackupsWriteToMPSTables","MAWBridgeGQLUploadUtils","MAWEBFalcoLoggerUtils","MAWEBFrontendQPLLogger","MWEBODSCategory","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","ODS","WAErrorMessage","WAResultOrError","isInstamadilloEB"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b){try{if(c("isInstamadilloEB")()){d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_cancelled_instamadillo");b.forEach(function(a){var b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(a,b,"gql_cancelled_instamadillo")});return d("WAResultOrError").makeError("gql_cancelled_instamadillo")}d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_single_txn_start");var e="mps_write_failure",g=await a.runInTransaction(async function(f){if(!await d("EBIsEbEnabled").isEbEnabledLS(a.tables)){b.forEach(function(a){if(a.uploadTrackingInstanceKey!=null){var b,e=a.uploadTrackingInstanceKey;d("MAWEBFrontendQPLLogger").addPointEBUploadTracking(e,"user_device_not_enrolled_invalid_gql_request");var f=d("MWEBUseLocalStorage").mwEBGetIsLocalStorageEntryValuePresent(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_RESTORED_IN_CURRENT_SESSION);b=(b=d("MWEBUseLocalStorage").mwEBGetLocalStorageEntryValue(c("MWEncryptedBackupsLocalStorageEntryEnum").EBSM_CORRUPTION_WIPE))!=null?b:"no";f={bool:{wasEBEnabledPreviously:f},string:{wasEBSMWiped:b}};b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskSkipped(a,b,"user_device_not_enrolled");d("MAWEBFrontendQPLLogger").endEBUploadTracking(e,f)}});var g=[];e="user_device_not_enrolled";return g}else{d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_mps_write_start");g=await i(f,b);d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_mps_write_end");return g}},"readwrite",void 0,void 0,f.id+":87");g=g.filter(Boolean);if(g.length===0)return d("WAResultOrError").makeError(e);(h||(h=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,"graphql.batch.size."+g.length);h.bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_TRACKING,"graphql.batch.bucket"+d("EBBucketUtils").getBucketName(g.length));d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_upload_start");g.forEach(function(a){var b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskIssued(a,b)});var j=await d("MAWBridgeGQLUploadUtils").uploadMessageOverGQL(a,g);d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b,"upload_tracking_gql_handler_single_txn_end");!j.success?g.forEach(function(a){var b=a.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(a,b,j.error)}):g.forEach(function(a){d("MAWEBFalcoLoggerUtils").logEBFalcoEncryptedBackupUploadSuccess(a)});return j}catch(a){b.forEach(function(b){var c=b.echoDocument!=null?"dual_upload":"protobuf_only";d("MAWEBFalcoLoggerUtils").logEBFalcoTaskFailure(b,c,d("WAErrorMessage").maybeGetMessageFromError(a));b.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").failEBUploadTracking(b.uploadTrackingInstanceKey,"gql_upload_runtime_error",a instanceof Error?{string:{runtime_error:a.message}}:void 0)});return d("WAResultOrError").makeError("gql_upload_runtime_error")}}async function i(a,b){b=b.map(async function(b){var c=b.protoMsg,e=b.uploadTrackingInstanceKey!=null?d("MAWEBFrontendQPLLogger").makeEBFrontendQplFlowFromInstanceKey(b.uploadTrackingInstanceKey):null;if(c!=null){c=c.backupActionType===1?Promise.all([d("EncryptedBackupsWriteToMPSTables").writeToMPSTables(a,c,b.threadId,!1,e),d("EncryptedBackupsWriteToMPSTables").writeTagsToMPSTables(a,c,b.threadId)]).then(function(a){var b=a[0];a[1];return b}):d("EncryptedBackupsWriteToMPSTables").writeToMPSTables(a,c,b.threadId,!1,e);e=await c.then(function(a){if(!a.success&&b.uploadTrackingInstanceKey!=null){d("MAWEBFrontendQPLLogger").failEBUploadTracking(b.uploadTrackingInstanceKey,"mps_write_failed",{string:{error:a.error.errorMsg,errorMsgType:b.messageType}});return null}return b},function(a){b.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").failEBUploadTracking(b.uploadTrackingInstanceKey,"upload_tracking_gql_handler_failed_mps_write",{string:{error:d("WAErrorMessage").maybeGetMessageFromError(a),errorMsgType:b.messageType}});return null});return e}return b});b=await Promise.all(b);return b.filter(Boolean)}g.call=a}),98);
__d("MAWBridgeUploadMessageByBatchGQLHandler",["FBLogger","MAWBridgeSafeActionsWorkerAndUI","MAWBridgeUploadMessageGQLHandlerSingleTxn","MAWEBFrontendQPLLogger","MWEBODSEntityName.enum","ODS","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b){(h||(h=d("ODS"))).bumpEntityKey(7319,c("MWEBODSEntityName.enum").MAW_EB_UPLOAD_COUNTER,"main_thread");d("MAWEBFrontendQPLLogger").addPointForUploadMessageArray(b.messages,"upload_tracking_bridge_batch_handler_gql");var e=await d("MAWBridgeUploadMessageGQLHandlerSingleTxn").call(a,b.messages);if(e.success){a=b.messages.map(function(a){if(a.uploadTrackingInstanceKey!=null)return{instanceKey:a.traceId,success:!0};else return null}).filter(Boolean);d("MAWBridgeSafeActionsWorkerAndUI").fireAndForgetBackendWorkerAndUIShared("ackWithInstanceKeyBatched",{instancesWithOutcomes:a});c("FBLogger")("wmi_eb").info("Successfully completed GQL upload batch of size %s",b.messages.length);return d("WAResultOrError").makeResult()}b.messages.forEach(function(a){a.uploadTrackingInstanceKey!=null&&d("MAWEBFrontendQPLLogger").failEBUploadTracking(a.uploadTrackingInstanceKey,"gql_upload_failed",{string:{error:e.error}})});return d("WAResultOrError").makeError(e.error)}g.call=a}),98);
__d("MWRestoreMessagesFromEB",["EBIsEbEnabled","EBMessageRangeQueryWithPersistence","I64","MAWAsyncEBPendingQueryPromise","MAWMainTraceUtils","MWEncryptedBackUpEBNotEnabledError","Promise","WATagsLogger","err","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function a(a){var e=a.chatJid,f=a.newerNumMessages,g=a.passedTraceId,k=a.sortOrderMs,l=a.source;a=a.storage;if(!c("gkx")("23914"))return null;var m=g!=null?g:d("MAWMainTraceUtils").createTraceId();c("promiseDone")(d("EBIsEbEnabled").isEbEnabledLS(a.tables).then(function(a){if(a)return d("EBMessageRangeQueryWithPersistence").messageRangeQueryWithPersistence_DEPRECATED_DO_NOT_USE({chatJid:e,direction:(j||(j=d("I64"))).to_float(f)>0?"after":"before",includeOffset:c("gkx")("5340"),sortOrderMs:(j||(j=d("I64"))).to_string(k),source:l,traceId:m}).then(function(a){a.success||d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(m,c("err")(a.error))});else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore"]).WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Issuing message range query for chatJid: "," skipped. EB not enabled"])),e);d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(m,c("err")(d("MWEncryptedBackUpEBNotEnabledError").EB_NOT_ENABLED));return(i||(i=b("Promise"))).resolve()}}));return m}g["default"]=a}),98);
__d("MAWEBFetch",["EBFormatUtils","FBLogger","I64","LSMEBTaskCreationSource","MAWAsyncEBPendingQueryPromise","MWEncryptedBackUpEBNotEnabledError","MWRestoreMessagesFromEB","WAResultOrError","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h;b=c("justknobx")._("3177");var i=Math.max(3,b-5);async function a(a){var b=a.chatJid,e=a.count,f=a.db,g=a.direction,i=a.timestampMs;a=a.traceId;e=d("EBFormatUtils").adjustCount(e,g);var k=e[0];e=e[1];b=c("MWRestoreMessagesFromEB")({chatJid:b,newerNumMessages:(h||(h=d("I64"))).of_int32(e),numMessages:h.of_int32(k),passedTraceId:a,sortOrderMs:d("EBFormatUtils").adjustTs(i,g),source:c("LSMEBTaskCreationSource").MESSENGER_MESSAGE_LIST_PAGINATION,storage:f});if(b==null)return d("WAResultOrError").makeResult({hasMoreAfter:!1,hasMoreBefore:!1,isEndOfCurrentFormat:!1,messages:[],restoreType:"none"});e=d("MAWAsyncEBPendingQueryPromise").getWaitForRestorePromiseFromTrace(b);k=await e.then(function(a){return d("WAResultOrError").makeResult(a)}).catch(function(a){if(a&&(a==null?void 0:a.message)===d("MWEncryptedBackUpEBNotEnabledError").EB_NOT_ENABLED)return d("WAResultOrError").makeError(d("MWEncryptedBackUpEBNotEnabledError").EB_NOT_ENABLED);c("FBLogger")("messenger_web").catching(a).mustfix("[EBFetch] Failed to fetch");return d("WAResultOrError").makeError((a=a==null?void 0:a.message)!=null?a:"unknown")});if(k.success===!1)return k;a=k.value;i=a.hasMoreAfter;f=a.hasMoreBefore;b=a.messages;e=a.restoreType;return d("WAResultOrError").makeResult({hasMoreAfter:i,hasMoreBefore:f,isEndOfCurrentFormat:j(g,i,f,b),messages:b,restoreType:e})}function j(a,b,c,d){if(a==="before"&&c===!1)return!1;return a==="after"&&b===!1?!1:d.length<i}g.default=a}),98);
__d("MAWMessageIntegrityChecker",["FBLogger","MAWMessagesCompare","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b){if(a.externalId===b.externalId)return 0;if(a.sortOrderMs>b.sortOrderMs)return 1;return a.sortOrderMs<b.sortOrderMs?-1:-1}function i(a,b){var c=b.reduce(function(a,b){b.externalId!=null&&a.set(b.externalId,b.sortOrderMs);return a},new Map());return a.map(function(a){var b;return babelHelpers.extends({},a,{sortOrderMs:(b=a.externalId!=null?c.get(a.externalId):null)!=null?b:a.sortOrderMs})}).sort(d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc"))}function j(a,b,c){a=new Set(a.map(function(a){return a.externalId}).filter(Boolean));return b.toSorted(d("MAWMessagesCompare").makeCompareMessageMetadataForDescOrderFn(a)).slice(0,c)}function a(a,b,d,e,f){var g=new Set(a.map(function(a){return a.externalId})),l=new Set(b.map(function(a){return a.externalId})),m=k(g,l);l=k(l,g);g=i(a,b);a=j(g,b,d);b=0;var n=0,o=0,p=0,q=[],r=null;while(b<g.length&&n<a.length){var s=g[b],t=a[n];if(r!=null&&h(t,r)===0){n+=1;r=t;c("FBLogger")("messenger_web_missing_messages").mustfix("Detected duplicate messages in reference. Target source: %s, reference source: %s",e,f);continue}var u=h(s,t);u===0?(b+=1,n+=1,r=t,q.push([s,{result:"consistent"}])):u<0?(n+=1,r=t,o+=1,q.push([t,{result:"missing_in_target"}])):(b+=1,p+=1,q.push([s,{result:"missing_in_reference"}]))}while(b<g.length){u=g[b];b+=1;a.length<d?(p+=1,q.push([u,{result:"missing_in_reference"}])):q.push([u,{result:"skipped_in_target"}])}while(n<a.length){t=a[n];n+=1;g.length<d?(o+=1,q.push([t,{result:"missing_in_target"}])):q.push([t,{result:"skipped_in_reference"}])}if(o===0&&p===0)return{detailedResults:q,result:"consistent",setDifferenceInReference:l,setDifferenceInTarget:m};else if(o>0&&p===0)return{detailedResults:q,numOfMissingMessages:o,result:"missing_in_target",setDifferenceInReference:l,setDifferenceInTarget:m};else if(o===0&&p>0)return{detailedResults:q,numOfMissingMessages:p,result:"missing_in_reference",setDifferenceInReference:l,setDifferenceInTarget:m};else return{detailedResults:q,numOfMissingMessages:p+o,result:"missing_in_both",setDifferenceInReference:l,setDifferenceInTarget:m}}async function b(a,b,d){a=d.filter(function(a){a[0];a=a[1];return a.result==="missing_in_target"}).map(function(a){var b=a[0];a[1];return b.externalId});var e={admin:!1,editMsgHistory:!1,media:!1,polls:!1,reactions:!1,receiverFetch:!1,xma:!1},f=await b.fetchMessagesByExternalId(a,e),g=new Set(f.map(function(a){return a.externalId}));return Promise.all(d.map(async function(a){var b=a[0];a=a[1];if(!g.has(b.externalId))return[b,a];a=f.find(function(a){return a.externalId===b.externalId});if(!a){c("FBLogger")("messenger_web_missing_messages").mustfix("Failed to find msg with external id: %s in MAW",b.externalId);return[b,{result:"missing_in_target_invalid_sortOrder"}]}var d={sortOrderSkewMs:a.sortOrderMs-b.sortOrderMs,sortOrderSkewNumberOfMsg:0},e={result:"missing_in_target_invalid_sortOrder",sortOrderSkewMs:0};d.sortOrderSkewNumberOfMsg!=null&&(e=babelHelpers.extends({},e,{sortOrderSkewNumberOfMsg:d.sortOrderSkewNumberOfMsg}));return[babelHelpers.extends({},b,{msgType:a.msgType}),e]}))}async function e(a,b){var c=b.filter(function(a){a[0];a=a[1];return a.result==="missing_in_target"}).map(function(a){var b=a[0];a[1];return b.externalId});if(c.length===0)return b;c=c.map(function(b){return d("ReQL").fromTableAscending(a.tables.messages.index("optimistic")).getKeyRange(b)});var e=c.length===1;c=c.length>1?d("ReQL").union.apply(void 0,c):c[0];var f=await d("ReQL").toArrayAsync(c);return b.map(function(a){var b=a[0];a=a[1];var c=f.find(function(a){return a.offlineThreadingId===b.externalId});if(c!=null)return[b,{result:"missing_in_target_exists_in_lsdb",transportKey:c.transportKey,wouldHaveThrownS518614:e}];a.wouldHaveThrownS518614=e;return[b,a]})}function k(a,b){var c=0;for(a of a)b.has(a)||(c+=1);return c}g.checkIntegrityforMessageList=a;g.checkMsgsExistenceInMAWAndDecomposeTargetConsistencyResult=b;g.checkMsgsExistenceInLSDB=e}),98);
__d("MAWMessageIntegrityMissingInTargetCategory",["FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.hasEBFetchFailed,c=a.mawVsEB;a=a.uiVsEB;var d=i(a);a=c.detailedResults.filter(function(a){var b=a[0];a[1];return d.has(b.externalId)});return a.map(function(a){var c=a[0];a=a[1];a=h(c.externalId,a,b);return a==null?null:[c,a]}).filter(Boolean)}function h(a,b,d){switch(b.result){case"consistent":return"client_inconsistency";case"missing_in_target":return d?"eb_restore_timeout":"message_not_persisted_after_eb_restore";case"missing_in_target_invalid_sortOrder":return b.sortOrderSkewMs==null||b.sortOrderSkewMs===0?"message_out_of_order_same_timestamp":"message_out_of_order_different_timestamp";case"skipped_in_target":return"client_inconsistency_skipped";case"skipped_in_reference":return"unknown_skipped";case"missing_in_reference":case"missing_in_target_exists_in_lsdb":c("FBLogger")("messenger_web_missing_messages").mustfix("Unexpected consistency result %s for message with externalId %s when calculating missing in target category",b.result,a);return null;default:b.result;return null}}function i(a){return a.detailedResults.reduce(function(a,b){var c=b[0];b=b[1];b.result==="missing_in_target"&&a.add(c.externalId);return a},new Set())}g.calculateMissingInTargetCategory=a}),98);
__d("MAWMessageIntegrityCompareMessagesData",["I64","MAWMessageIntegrityChecker","MAWMessageIntegrityMissingInTargetCategory","WATagsLogger"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=d("WATagsLogger").TAGS(["MissingMessages"]);async function a(a,b,c,d,e,f){var g=e.S518614_messagesBacktest,h=g.backendMessages,i=g.ebMessages,j=g.mpsMessages;g=g.uiMessages;var k=e.S518614_pageSizeBacktest,l=e.messages,n=l.backendMessages,o=l.ebMessages,p=l.mpsMessages;l=l.uiMessages;e=e.pageSize;n=await m(a,b,c,d,f,n,o,p,l,e);o=n.mawVsEB;p=n.missingInTargetCategory;l=n.mpsVsEB;var q=n.mpsVsMaw,r=n.uiVsEB;n=n.uiVsMaw;a=await m(a,b,c,d,f,h,i,j,g,k,!0);b=a.mawVsEB;c=a.mpsVsEB;d=a.mpsVsMaw;f=a.uiVsEB;h=a.uiVsMaw;i=a.wouldHaveThrownS518614;return{S518614_mawVsEB:b,S518614_mpsVsEB:c,S518614_mpsVsMaw:d,S518614_pageSize:k,S518614_uiVsEB:f,S518614_uiVsMaw:h,S518614_wouldHaveThrown:i,mawVsEB:o,missingInTargetCategory:p,mpsVsEB:l,mpsVsMaw:q,pageSize:e,uiVsEB:r,uiVsMaw:n}}async function m(a,b,c,e,f,g,m,o,p,q,r){r===void 0&&(r=!1);var s=d("MAWMessageIntegrityChecker").checkIntegrityforMessageList(p,g,q,"ui","maw"),t=d("MAWMessageIntegrityChecker").checkIntegrityforMessageList(p,m,q,"ui","eb"),u=d("MAWMessageIntegrityChecker").checkIntegrityforMessageList(g,m,q,"maw","eb");g=o?d("MAWMessageIntegrityChecker").checkIntegrityforMessageList(o,g,q,"mps","maw"):null;o=o?d("MAWMessageIntegrityChecker").checkIntegrityforMessageList(o,m,q,"mps","eb"):null;t.result!=="consistent"&&(!r?l.WARN(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Missing message detected for ",", result: ",", num of messages missing: ",""])),(k||(k=d("I64"))).to_float(e),t.result,t.numOfMissingMessages):l.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["S518614 backtest: Missing message detected for ",", result: ",", num of messages missing: ",""])),(k||(k=d("I64"))).to_float(e),t.result,t.numOfMissingMessages));(t.result==="missing_in_target"||t.result==="missing_in_both")&&(t.detailedResults=n(t.detailedResults,p));(u.result==="missing_in_target"||u.result==="missing_in_both")&&(u.detailedResults=await d("MAWMessageIntegrityChecker").checkMsgsExistenceInMAWAndDecomposeTargetConsistencyResult(c,b,u.detailedResults));var v=!1;if(s.result==="missing_in_target"||s.result==="missing_in_both")try{s.detailedResults=await d("MAWMessageIntegrityChecker").checkMsgsExistenceInLSDB(a,s.detailedResults),s.detailedResults.map(function(a){a[0];a=a[1];v||(v=a.wouldHaveThrownS518614===!0)})}catch(a){l.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed to get detailed results for UI vs MAW comparison: ",""])),a)}m=d("MAWMessageIntegrityMissingInTargetCategory").calculateMissingInTargetCategory({hasEBFetchFailed:f,mawVsEB:u,uiVsEB:t});return{mawVsEB:u,missingInTargetCategory:m,mpsVsEB:o,mpsVsMaw:g,pageSize:q,uiVsEB:t,uiVsMaw:s,wouldHaveThrownS518614:v}}function n(a,b){var c=new Set(b.map(function(a){return a.externalId}));return a.map(function(a){var b=a[0];a=a[1];return a.result==="missing_in_target"&&c.has(b.externalId)?[b,babelHelpers.extends({},a,{existingInUISamePage:!0})]:[b,a]})}g.compareMessagesData=a}),98);
__d("MAWMessageIntegrityFetchMessagesData",["I64","MAWBridgeSendAndReceive","MAWDbMsg","MAWEBDeanonFetch","MAWMessagesCompare","MAWMpsGating","MAWMpsMessageIntegrityFetch","MpsTypes","WAResultOrError","WAStanzaUtils","WATimeUtils","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b,c,e,f,g){var h=await d("MAWBridgeSendAndReceive").sendAndReceive("backend","identifyXMAWithAssociatedTextByExternalId",{externalIds:g.map(function(a){return d("WAStanzaUtils").toStanzaId(a.offlineThreadingId)})}),m=g.map(k);a=await Promise.all([l(g),d("MAWMpsGating").isFullMpsEnabled()?[]:i(a,b,c,f,e),j(c,f,e),d("MAWMpsMessageIntegrityFetch").mpsMessageIntegrityFetch(c,"before",f,e)]);b=a[0];c=a[1];f=a[2];a=a[3];var n=await d("MAWBridgeSendAndReceive").sendAndReceive("backend","identifyCollapsedMessagesByExternalId",{externalIds:f.map(function(a){return d("WAStanzaUtils").toStanzaId(a.externalId)})});function o(a){return!h.includes(a.externalId)}function p(a){return!n.includes(a.externalId)}function q(a){return o(a)&&p(a)}var r=b.filter(q),s=c.filter(q),t=f.filter(q),u=a==null?null:a.filter(q);m=m.filter(q);q=g.length-m.length;g=e-q;if(t.length===0)return d("WAResultOrError").makeError("EB result not available");m=d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc");q=[].concat(s).sort(m).slice(0,g);s=[].concat(t).sort(m).slice(0,g);t=r.sort(m).slice(0,g);r=u!=null?[].concat(u).sort(m).slice(0,g):null;u=e;e=[].concat(c).sort(m).slice(0,u);c=[].concat(f).sort(m).slice(0,u);f=[].concat(b).sort(m).slice(0,u);b=a!=null?[].concat(a).sort(m).slice(0,u):null;return d("WAResultOrError").makeResult({S518614_messagesBacktest:{backendMessages:e,ebMessages:c,mpsMessages:b,uiMessages:f},S518614_pageSizeBacktest:u,messages:{backendMessages:q,ebMessages:s,mpsMessages:r,uiMessages:t},pageSize:g})}async function i(a,b,c,e,f){e=m(e);var g=e.msgId;e=e.timestampMs;b=await b.requestMessages(a,c,(h||(h=d("I64"))).of_float(e),g,"before",f,{admin:!1,editMsgHistory:!1,media:!1,polls:!1,reactions:!1,receiverFetch:!1,xma:!1},"integrity");return b.msgs}async function j(a,b,c){var e=m(b),f=e.msgId;e=e.timestampMs;f=await (f==null?Promise.resolve(null):d("MAWBridgeSendAndReceive").sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:f}));var g=(f=f==null?void 0:f.externalId)!=null?f:(f=b.lastItemFromPreviousPage)==null?void 0:f.offlineThreadingId;b=await d("MAWEBDeanonFetch").fetchMessagesMetadataFromEBDeanon({chatJid:a,count:c*2,direction:"before",includeReferenceTimestamp:!0,referenceExternalId:g,referenceTimestampMs:e});if(b.success===!1)return[];f=b.value.sort(d("MAWMessagesCompare").getSortComparisonFunctionForDirection("desc"));a=f.findIndex(function(a){return a.externalId===g});return f.slice(a+1)}function k(a){return{externalId:a.offlineThreadingId,msgType:(h||(h=d("I64"))).to_string(a.displayedContentTypes),sortOrderMs:h.to_float(a.primarySortKey)}}function l(a){var b=function(a){var b=d("MAWDbMsg").toMsgId(a.messageId);return b==null?Promise.resolve(k(a)):d("MAWBridgeSendAndReceive").sendAndReceive("backend","getProtocolMsgIdByMsgId",{msgId:b}).then(function(b){return babelHelpers.extends({},a,{offlineThreadingId:(b=b==null?void 0:b.externalId)!=null?b:a.offlineThreadingId})}).then(k)};return Promise.all(a.map(b))}function m(a){if(a.type==="lastItemFromPreviousPage")return{messageId:d("MpsTypes").toMessageId(a.lastItemFromPreviousPage.offlineThreadingId),msgId:d("MAWDbMsg").toMsgId(a.lastItemFromPreviousPage.messageId),timestampMs:d("WATimeUtils").castToMillisTime((h||(h=d("I64"))).to_float(a.lastItemFromPreviousPage.primarySortKey))};a.type;return c("gkx")("15880")===!0?{messageId:null,msgId:null,timestampMs:a.timeOfSnapshotMs}:{messageId:null,msgId:null,timestampMs:d("WATimeUtils").millisTime()}}g.fetchMessagesDataForComparison=a;g.getRangeDetailsFromMessageIntegrityFromReference=m}),98);
__d("MAWMpsMessageIntegrityFetch",["MAWCurrentUser","MAWEBLSInWorkerSwitch","MAWEBSwitch","MAWMessageIntegrityFetchMessagesData","MAWMessagesDirection","MpsOverBridge","MpsTypes","WAPromiseDelays"],(function(a,b,c,d,e,f,g){"use strict";async function a(a,b,e,f){e=d("MAWMessageIntegrityFetchMessagesData").getRangeDetailsFromMessageIntegrityFromReference(e);var g=e.messageId;e=e.timestampMs;c("MAWEBSwitch").isEnabled()===!0&&await Promise.race([d("WAPromiseDelays").delayMs(1e4),await c("MAWEBLSInWorkerSwitch").waitForEBEnabled()]);b=await d("MpsOverBridge").mps().loadMessages({config:{shouldFetchSupplementals:!1,shouldIgnoreLocalOnly:!0,strategy:"full-fetch"},debug:{purpose:"integrity-check"},direction:d("MAWMessagesDirection").translateMawDirectionToMwpDirection(b),from:[d("MpsTypes").toTimestamp(e),g],numMessages:f*2,threadId:d("MpsTypes").toThreadId(a)});return b.success===!1?null:b.value.messages.map(function(a){return{externalId:a.toplevelProtobuf.messageId,isOutgoing:a.toplevelProtobuf.senderId!==d("MAWCurrentUser").getID(),msgType:"",sortOrderMs:a.toplevelProtobuf.timestampMs}})}g.mpsMessageIntegrityFetch=a}),98);
__d("MAWSecureDataSource",[],(function(a,b,c,d,e,f){"use strict";a=10;f.DEFAULT_NUM_MESSAGES=a}),66);
__d("MAWSecureLocalDBDataSource",["I64","MAWBridgeSendAndReceive","MAWDataSourceLogger","MAWDbMsg","MAWMessagesDirection","MAWMessagesPaginationUtils","MAWMiActOnActThreadReady","MAWPutMessagesToDB","MAWSecureDataSource","MAWSecureLocalDBFetch","MLV2DataSourceLogger","ReQL","WAStanzaUtils","WATagsLogger","err","isEbEnabledWithIGDEligibilityCheck","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=c("requireDeferred")("MAWEBFetch").__setRef("MAWSecureLocalDBDataSource"),n=d("WATagsLogger").TAGS(["MAWSecureLocalDBDataSource"]);function o(a){return a.msgs.map(function(a){return{externalId:a.externalId,isOptimistic:a.ack<1,isOutgoing:a.isAuthorMe,msgType:a.type_,sortOrderMs:a.sortOrderMs}})}a=function(){function a(){}var b=a.prototype;b.$1=async function(a,b,e,g,j,k,o,p,q){if(j==="after")return;j;n.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["Fetch more: ",""])),b);d("MAWDataSourceLogger").logLoadMoreMsgsThreadWaiting(o,"before",b);j=await d("MAWMiActOnActThreadReady").waitForACTThreadReady(a.tables,b,"MAWSecureLocalDBDataSource");j=j.chatJid;d("MAWDataSourceLogger").logLoadMoreMsgsThreadReadyFetchMsgs(o);d("MAWDataSourceLogger").logLoadMessagesFromLocalDBStart(o);var r=g.minMessageId,s=await d("MAWMessagesPaginationUtils").getExternalIdByMsgId(r);p=await c("MAWSecureLocalDBFetch")({actionType:p,chatJid:j,config:{admin:!0,editMsgHistory:!0,media:!0,polls:!0,reactions:!0,receiverFetch:!0,xma:!0},count:k,direction:"before",offsetMsg:{externalId:s,includeOriginalMsg:!1,messageId:r},timestampMs:e});if(p.success===!1){throw(s=p.payload)!=null?s:c("err")(p.error)}var t=p.value;d("MAWDataSourceLogger").logLoadMessagesFromLocalDBEnd(o);d("MAWDataSourceLogger").logInsertMessageResponseToLSDBStart(o);d("MAWMessagesPaginationUtils").populateExternalIdCache(t.msgs);var u=t.msgs.length>0?t.msgs[t.msgs.length-1].msgId:g.minMessageId;await a.runInTransaction(async function(b){var c;await d("MAWPutMessagesToDB").insertMessageResponseToDBInExistingTransaction(a,b,t,q,o);c=await (c=b.messages_ranges_v2__generated).get.apply(c,[g.threadKey,g.minTimestampMs,g.minMessageId]);if(c==null)return;var e=t.hasMoreBefore;t.hasMoreBefore===!1&&await d("isEbEnabledWithIGDEligibilityCheck").isEbEnabledWithIGDEligibilityCheck(a)&&(e=!0);await b.messages_ranges_v2__generated.upsert([c.threadKey,c.minTimestampMs,c.minMessageId],{hasMoreAfter:!1,hasMoreBefore:e,isLoadingAfter:!1,isLoadingBefore:!1,maxMessageId:c.maxMessageId,maxTimestampMs:c.maxTimestampMs,minMessageId:u,minTimestampMs:(l||(l=d("I64"))).zero,threadKey:g.threadKey})},"readwrite","ui",void 0,f.id+":146");d("MAWDataSourceLogger").logInsertMessageResponseToLSDBEnd(o);d("MAWDataSourceLogger").logLoadMoreMsgsFetched(o,t.hasMoreBefore);if(t.hasMoreBefore){d("MAWDataSourceLogger").logLoadMoreMsgsSuccess(o);return}r=await d("MAWBridgeSendAndReceive").sendAndReceive("backend","getMaybeNextNonAdminMsgSortOrderMs",{chatJid:j,mayBeAdminMsgId:d("MAWDbMsg").toMsgId(g.minMessageId)});d("WATagsLogger").TAGS(["labyrinth_web","useFetchSecureMessages"]).LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["useFetchSecureMessages: threadJid: "," minMsgSortOrderTsResponse ",""])),j,r.minMsgTimestampMs);d("MAWDataSourceLogger").logLoadMoreMsgsRangeQuery(o,r.minMsgTimestampMs);e=await m.load();s=await e({chatJid:j,count:k,db:a,direction:"before",timestampMs:(l||(l=d("I64"))).of_float(r.minMsgTimestampMs)});s.success&&s.value.hasMoreBefore===!1&&await a.runInTransaction(async function(c){var e=g.minTimestampMs,f=await d("ReQL").firstAsync(d("ReQL").fromTableDescending(a.tables.messages_ranges_v2__generated).getKeyRange(b).bounds({lte:[e]}).filter(function(a){var b=a.maxTimestampMs;a=a.minTimestampMs;return(l||(l=d("I64"))).ge(e,a)&&(l||(l=d("I64"))).le(e,b)}));if(f==null)return;await c.messages_ranges_v2__generated.upsert([f.threadKey,f.minTimestampMs,f.minMessageId],babelHelpers.extends({},f,{hasMoreBefore:!1,isLoadingBefore:!1}))},"readwrite","ui",void 0,f.id+":231");d("MAWDataSourceLogger").logLoadMoreMsgsSuccess(o)};b.requestMessages=async function(a,b,e,f,g,h,i,j){a=await d("MAWMessagesPaginationUtils").getExternalIdByMsgId(f);j=await c("MAWSecureLocalDBFetch")({actionType:j,chatJid:b,config:i,count:h!=null?h:d("MAWSecureDataSource").DEFAULT_NUM_MESSAGES,direction:g,offsetMsg:f==null?null:{externalId:a,includeOriginalMsg:!1,messageId:f},timestampMs:e});if(j.success===!1){throw(b=j.payload)!=null?b:c("err")(j.error)}i=j.value;d("MAWMessagesPaginationUtils").populateExternalIdCache(i.msgs);h=i.msgs.map(function(a){return{externalId:a.externalId,isOptimistic:a.ack<1,isOutgoing:a.isAuthorMe,msgType:a.type_,sortOrderMs:a.sortOrderMs}});return{hasMoreAfter:i.hasMoreAfter,hasMoreBefore:i.hasMoreBefore,msgs:h}};b.fetchSecureMessagesProtocol=function(a,b,c,e,f,g,h,i,k){h===void 0&&(h=d("MAWSecureDataSource").DEFAULT_NUM_MESSAGES);c=d("MAWDataSourceLogger").logLoadMoreMsgsStart(c);return this.$1(a,b,e,f,g,h,c,i,k).catch(function(a){var c;n.ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Failed to fetch messages: ",""])),a);(c=d("MLV2DataSourceLogger").getMLV2LoggerForThread(b,d("MAWMessagesDirection").translateMawDirectionToMwpDirection(g)))==null||c.markQPLFailure(a)})};b.fetchMessagesByExternalId=function(a,b){a.length>2&&n.WARN(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Fetching "," messages by external id, which is not optimal.\n      Consider migrating 'loadMsgsByExternalId' backend request to a batch version "])),a.length);a=a.map(function(a){return d("MAWBridgeSendAndReceive").sendAndReceive("backend","loadMsgsByExternalId",{config:b,externalId:d("WAStanzaUtils").toStanzaId(a)})});return Promise.all(a).then(function(a){return a.map(function(a){return o(a)}).flat()})};return a}();g.default=a}),98);
__d("MAWMessageIntegrityFetchAndCompareData",["MAWMessageIntegrityCompareMessagesData","MAWMessageIntegrityFetchMessagesData","MAWMiActOnActThreadReady","MAWSecureLocalDBDataSource","WAResultOrError"],(function(a,b,c,d,e,f,g){"use strict";var h=new(c("MAWSecureLocalDBDataSource"))();async function a(a){var b=a.db,c=a.fromReferencePoint,e=a.hasEbFetchFailed,f=a.localMessages,g=a.pageSize;a=a.threadKey;var i=await d("MAWMiActOnActThreadReady").waitForACTThreadReady(b.tables,a,"fetchAndCompareMessagesData");i=i.chatJid;g=await d("MAWMessageIntegrityFetchMessagesData").fetchMessagesDataForComparison(b,h,i,g,c,f);if(g.success===!1)return g;c=await d("MAWMessageIntegrityCompareMessagesData").compareMessagesData(b,h,i,a,g.value,e);return d("WAResultOrError").makeResult(c)}g.fetchAndCompareMessagesData=a}),98);
__d("MAWMessagesIntegrityEphemeralSettings",["I64","MAWGetEphemeralSettings","MAWMiActOnActThreadReady","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a,b,c){a=await d("MAWMiActOnActThreadReady").waitForACTThreadReady(a.tables,b,"getIsEphemeralMessagesEnabledForPage");a=a.chatJid;a=await d("MAWGetEphemeralSettings").getEphemeralSetting(a,b);if(a==null||a.ephemeralLastUpdatedOrSetTimestamp===d("WATimeUtils").DEFAULT_UNIXTIME)return"disabled";return d("WATimeUtils").castUnixTimeToMillisTime(a.ephemeralLastUpdatedOrSetTimestamp)<(h||(h=d("I64"))).to_float(c)?a.ephemeralExpirationInSec>0?"enabled":"disabled":a.ephemeralExpirationInSec>0?"maybeDisabled":"maybeEnabled"}g.getEphemeralMessagesStatusForPage=a}),98);
__d("MAWMessageIntegrityCheck",["CometDebounce","DateConsts","EbFetchTimeoutMsForMLv2","I64","MAWBridgeSendAndReceive","MAWEBCombinedSwitch","MAWMessageIntegrityCheckFlytrapResultCache","MAWMessageIntegrityEBFetchStatus","MAWMessageIntegrityFetchAndCompareData","MAWMessageIntegrityTruncateStatus","MAWMessagesIntegrityEphemeralSettings","MAWMiActOnActThreadReady","WACommsConnectionState","WAPromiseDelays","WATagsLogger","WATimeUtils","gkx","justknobx","logMessengerWebFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v="11",w=1e3*60*2,x=d("WATagsLogger").TAGS(["MissingMessages"]),y=c("CometDebounce")(c("logMessengerWebFalcoEvent"));function z(a){if(a.length===0)return null;var b=0;for(a of a)b=Math.max(b,(u||(u=d("I64"))).to_float(a.primarySortKey));return d("WATimeUtils").castToMillisTime(b)}function A(a,b){a=z(a);if(a==null)return b;var d=Math.abs(a-b),e=c("justknobx")._("4843");return d<e?a:b}async function a(a,b,e,f,g,z,D,H,I,J){x.LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["run Message Integrity Check - threadKey: ",", lastItem: ",", pageSize: ",""])),(u||(u=d("I64"))).to_string(b),z==null?"null":(u||(u=d("I64"))).to_float(z.primarySortKey),g);if(d("WATimeUtils").millisTime()-I>w){x.LOG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check skipped for threadKey: ",", lastItem: ",", reason: check was scheduled more than 2 minutes ago"])),(u||(u=d("I64"))).to_string(b),z==null?"null":(u||(u=d("I64"))).to_float(z.primarySortKey));return}var K=d("MAWEBCombinedSwitch").MAWEBCombinedSwitch.isEnabled();if(z==null&&d("WACommsConnectionState").WACommsConnectionState.isConnected()===!1&&c("gkx")("15879")===!0){x.LOG(j||(j=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check skipped for threadKey: ",", lastItem: ",", reason: WACOMMS is disconnected"])),(u||(u=d("I64"))).to_string(b),z==null?"null":(u||(u=d("I64"))).to_float(z.primarySortKey));return}var L=z==null&&c("gkx")("15880")===!0;if(L){var M=c("justknobx")._("4844"),N=I+M;N=Math.min(N-d("WATimeUtils").millisTime(),M);x.LOG(k||(k=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check - threadKey "," - Latest Page - waiting ","ms"])),(u||(u=d("I64"))).to_string(b),N);await d("WAPromiseDelays").delayMs(N)}M=d("WATimeUtils").millisTime();N=c("gkx")("1626");var O=d("MAWMessageIntegrityEBFetchStatus").hasEBFailure(b),P=d("MAWMessageIntegrityTruncateStatus").getThreadThuncateState(b),Q=z!=null?{lastItemFromPreviousPage:z,type:"lastItemFromPreviousPage"}:{timeOfSnapshotMs:A(D,I),type:"latestPageSnapshot"};Q=await d("MAWMessageIntegrityFetchAndCompareData").fetchAndCompareMessagesData({db:a,fromReferencePoint:Q,hasEbFetchFailed:O,localMessages:D,pageSize:g,threadKey:b});if(Q.success===!1){x.LOG(l||(l=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check skipped for threadKey: ",", lastItem: ",", reason: ",""])),(u||(u=d("I64"))).to_string(b),z==null?"null":(u||(u=d("I64"))).to_float(z.primarySortKey),Q.error);return}g=Q.value;c("gkx")("4852")&&g.uiVsEB.detailedResults.some(function(a){a[0];a=a[1];return a==="missing_in_target"})&&J();Q=d("MAWMessageIntegrityCheckFlytrapResultCache").generateMessageIntegrityCheckPageKey(b,D);d("MAWMessageIntegrityCheckFlytrapResultCache").cacheMessageIntegrityCheckResult(Q,g.missingInTargetCategory);x.LOG(m||(m=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check result - threadKey: ",", lastItem: ",", result against backend data: ",""])),u.to_string(b),z==null?"null":(u||(u=d("I64"))).to_float(z.primarySortKey),JSON.stringify(g.uiVsMaw));x.LOG(n||(n=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check result - threadKey: ",", lastItem: ",", result against EB data: ",""])),u.to_string(b),z==null?"null":(u||(u=d("I64"))).to_float(z.primarySortKey),JSON.stringify(g.uiVsEB));x.LOG(o||(o=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check result - threadKey: ",", lastItem: ",", MPS (target) vs MAW (reference): ",""])),u.to_string(b),z==null?"null":(u||(u=d("I64"))).to_float(z.primarySortKey),JSON.stringify(g.mpsVsMaw));x.LOG(p||(p=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check result - threadKey: ",", lastItem: ",", MPS (target) vs EB (reference): ",""])),u.to_string(b),z==null?"null":(u||(u=d("I64"))).to_float(z.primarySortKey),JSON.stringify(g.mpsVsEB));x.LOG(q||(q=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check Flytrap result - threadKey: ",", missingInTargetCategory: ",""])),u.to_string(b),JSON.stringify(g.missingInTargetCategory));x.LOG(r||(r=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check Truncate state - threadKey: ",", state: ",""])),u.to_string(b),JSON.stringify(P));J=C(g.mawVsEB);Q=C(g.uiVsEB);var R=C(g.uiVsMaw),S=g.mpsVsMaw!=null?C(g.mpsVsMaw):{},T=g.mpsVsEB!=null?C(g.mpsVsEB):{},U=C(g.S518614_mawVsEB),V=C(g.S518614_uiVsEB),W=C(g.S518614_uiVsMaw),X=g.S518614_mpsVsMaw!=null?C(g.S518614_mpsVsMaw):{},Y=g.S518614_mpsVsEB!=null?C(g.S518614_mpsVsEB):{};D=E(D);var Z=await d("MAWMessagesIntegrityEphemeralSettings").getEphemeralMessagesStatusForPage(a,b,D);a=await F(a,b);var $=await d("WAPromiseDelays").withTimeout(G({messages:[]}).catch(function(a){x.ERROR(s||(s=babelHelpers.taggedTemplateLiteralLoose(["Failed to get extra debug info: ",""])),a);return"error"}),1e4,function(){return"timeout"});T={MAW_vs_EB_detailedResults:J.detailedResults,MAW_vs_EB_numOfMissingInReference:J.numOfMissingInReference,MAW_vs_EB_numOfMissingInTarget:J.numOfMissingInTarget,MAW_vs_EB_numOfMissingInTargetInvalidSortOrder:J.numOfMissingInTargetInvalidSortOrder,MAW_vs_EB_setNumOfMissingInReference:J.setDifferenceInReference,MAW_vs_EB_setNumOfMissingInTarget:J.setDifferenceInTarget,MPS_vs_EB_detailedResults:(J=T.detailedResults)!=null?J:"",MPS_vs_EB_numOfMissingInReference:(J=T.numOfMissingInReference)!=null?J:"",MPS_vs_EB_numOfMissingInTarget:(J=T.numOfMissingInTarget)!=null?J:"",MPS_vs_MAW_detailedResults:(T=S.detailedResults)!=null?T:"",MPS_vs_MAW_numOfMissingInReference:(J=S.numOfMissingInReference)!=null?J:"",MPS_vs_MAW_numOfMissingInTarget:(T=S.numOfMissingInTarget)!=null?T:"",S518614_MAW_vs_EB_detailedResults:(J=U.detailedResults)!=null?J:"",S518614_MPS_vs_EB_detailedResults:(S=Y.detailedResults)!=null?S:"",S518614_MPS_vs_MAW_detailedResults:(T=X.detailedResults)!=null?T:"",S518614_pageSize:g.S518614_pageSize.toString(),S518614_UI_vs_EB_detailedResults:(U=V.detailedResults)!=null?U:"",S518614_UI_vs_MAW_detailedResults:(J=W.detailedResults)!=null?J:"",S518614_wouldHaveThrown:B(g.S518614_wouldHaveThrown),UI_vs_EB_detailedResults:Q.detailedResults,UI_vs_EB_numOfMissingInReference:Q.numOfMissingInReference,UI_vs_EB_numOfMissingInTarget:Q.numOfMissingInTarget,UI_vs_EB_setNumOfMissingInReference:Q.setDifferenceInReference,UI_vs_EB_setNumOfMissingInTarget:Q.setDifferenceInTarget,UI_vs_MAW_detailedResults:R.detailedResults,UI_vs_MAW_numOfMissingInReference:R.numOfMissingInReference,UI_vs_MAW_numOfMissingInTarget:R.numOfMissingInTarget,UI_vs_MAW_setNumOfMissingInReference:R.setDifferenceInReference,UI_vs_MAW_setNumOfMissingInTarget:R.setDifferenceInTarget,ebMetadataCacheStatus:a,ebTimeoutSec:(c("EbFetchTimeoutMsForMLv2")()/d("DateConsts").MS_PER_SEC).toString(),endRangeTimestampMs:u.to_string(D),ephemeralMessagesStatus:Z+"",extraDebugInfo:$,hasAdditionalData:B(N),hasEBFetchFailed:B(O),integrityCheckScheduleTimestampMs:I.toString(),isDogfooding:B(c("gkx")("2972")),isEbEnabled:B(K),isEbGraphQL:K?"false":B(c("gkx")("7083")),isHoldout_H2_2025:B(c("gkx")("15728")),isJidOptimisationInRestoreEnabled:B(c("gkx")("3137")),isMpsEnabled:"true",isUsePageTimeForLatestPage:B(L),isUsingLsInitCache:B(c("gkx")("15958")),lastItemExternalId:(Y=z==null?void 0:z.offlineThreadingId)!=null?Y:"null",lastItemTimestamp:u.to_string((S=z==null?void 0:z.primarySortKey)!=null?S:(u||(u=d("I64"))).zero),missingInTargetCategory:JSON.stringify(g.missingInTargetCategory),pageIndex:H+"",pageSize:g.pageSize+"",reportTimeMs:M.toString(),truncateState:(X=JSON.stringify(P))!=null?X:"null",version:K?v:"0",waCommsIsConnected:B(d("WACommsConnectionState").WACommsConnectionState.isConnected())};c("gkx")("970")&&x.DEV(t||(t=babelHelpers.taggedTemplateLiteralLoose(["Message Integrity Check - Falco Report"]))).devConsole({falcoReport:T});y({threadKey:b,threadType:e},"message_integrity_check",f,T)}function B(a){return a===!0?"true":"false"}function C(a){var b=0,c=0,d=0;a.detailedResults.forEach(function(a){a[0];a=a[1];switch(a.result){case"missing_in_target":case"missing_in_target_exists_in_lsdb":b+=1;break;case"missing_in_target_invalid_sortOrder":c+=1;b+=1;break;case"missing_in_reference":d+=1;break;case"consistent":case"skipped_in_target":case"skipped_in_reference":break;default:a.result}});return{detailedResults:D(a.detailedResults),numOfMissingInReference:d+"",numOfMissingInTarget:b+"",numOfMissingInTargetInvalidSortOrder:c+"",setDifferenceInReference:a.setDifferenceInReference+"",setDifferenceInTarget:a.setDifferenceInTarget+""}}function D(a){a=a.map(function(a){var b=a[0];a=a[1];var d=a.existingInUISamePage,e=a.result,f=a.sortOrderSkewMs;a=a.sortOrderSkewNumberOfMsg;return babelHelpers.extends({existingInUISamePage:d,externalId:b.externalId,isOutgoing:b.isOutgoing},c("gkx")("1626")?{msgType:b.msgType,sortOrderMs:b.sortOrderMs}:{},{result:e,sortOrderSkewMs:f!=null?f:0,sortOrderSkewNumberOfMsg:a!=null?a:0})});return JSON.stringify(a)}function E(a){return a.length===0?(u||(u=d("I64"))).min_int:a.map(function(a){return a.timestampMs}).sort((u||(u=d("I64"))).compare)[0]}async function F(a,b){a=await d("MAWMiActOnActThreadReady").waitForACTThreadReady(a.tables,b,"fetchAndCompareMessagesData");b=a.chatJid;a=await d("MAWBridgeSendAndReceive").sendAndReceive("backend","getEBMetadataCacheDetailsForThread",{chatJid:b});return JSON.stringify(a)}async function G(a){a={browser:{loadEventEnd:window.performance.timing.loadEventEnd,navigationStart:window.performance.timing.navigationStart},worker:await d("MAWBridgeSendAndReceive").sendAndReceive("backend","getWorkerBasedMessageIntegrityDebugInfo",a)};return JSON.stringify(a)}b={runMessageIntegrityCheck:a};g.default=b}),98);
__d("MWXIconMenuItemHouseKeyhole",["MWXSvgIcon","SVGIcon","cr:22704","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:22704")),c("gkx")("23219"));g["default"]=a}),98);
__d("MAWSecurityAlertsBadgeMenuItem.react",["fbt","FDSNumberedBadge.react","JSResourceForInteraction","MWJewelPopoverDialogContext.react","MWPBumpEntityKey","MWXIconMenuItemHouseKeyhole","MWXMenuItem.react","gkx","react","react-compiler-runtime","useMWXLazyDialog"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useContext,l=c("JSResourceForInteraction")("MAWSecurityAlertsDialog.react").__setRef("MAWSecurityAlertsBadgeMenuItem.react");function a(a){var b=d("react-compiler-runtime").c(12);a=a.count;var e=c("useMWXLazyDialog")(l),f=e[0];e=k(c("MWJewelPopoverDialogContext.react"));var g=e.setIsOpenForDialog;e=c("gkx")("23219");var i;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(i=h._(/*BTDS*/"View security alerts"),b[0]=i):i=b[0];i=i;var m;b[1]!==a?(m=h._(/*BTDS*/"_j{\"*\":\"{number} security alerts\",\"_1\":\"1 security alert\"}",[h._plural(a,"number")]),b[1]=a,b[2]=m):m=b[2];b[3]!==a||b[4]!==m?(e={badge:j.jsx(c("FDSNumberedBadge.react"),{accessibilityText:m,color:e?"red":"lightBlue",value:a}),type:"numberedBadge"},b[3]=a,b[4]=m,b[5]=e):e=b[5];b[6]!==g||b[7]!==f?(a=function(){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","security_alerts"),g(!0),f({})},b[6]=g,b[7]=f,b[8]=a):a=b[8];b[9]!==e||b[10]!==a?(m=j.jsx(c("MWXMenuItem.react"),{auxItem:e,icon:c("MWXIconMenuItemHouseKeyhole"),id:"security_alerts_badge_menu_item",onClick:a,primaryText:i}),b[9]=e,b[10]=a,b[11]=m):m=b[11];return m}g["default"]=a}),226);
__d("MAWSecurityAlertsBadgeMenuItemWrapper.react",["MAWSecurityAlertsBadgeMenuItem.react","react","react-compiler-runtime","useMAWSecurityAlertsPreferences"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));h.useMemo;function a(a){var b=d("react-compiler-runtime").c(3);a=a.value;var e=c("useMAWSecurityAlertsPreferences")();e=e.securityAlertsPreferences;e==null||e.allowSecurityAlertForSelf;var f;b[0]!==(e==null?void 0:e.allowSecurityAlertForSelf)||b[1]!==a?(f=e!=null&&e.allowSecurityAlertForSelf?i.jsx(c("MAWSecurityAlertsBadgeMenuItem.react"),{count:a}):null,b[0]=e==null?void 0:e.allowSecurityAlertForSelf,b[1]=a,b[2]=f):f=b[2];e=f;return e}g["default"]=a}),98);
__d("MAWSecurityAlertsMenuItem.react",["fbt","JSResourceForInteraction","MWJewelPopoverDialogContext.react","MWPBumpEntityKey","MWXMenuItem.react","react","react-compiler-runtime","useMWXLazyDialog"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useContext,l=c("JSResourceForInteraction")("MAWSecurityAlertsDialog.react").__setRef("MAWSecurityAlertsMenuItem.react");function a(){var a=d("react-compiler-runtime").c(7),b=c("useMWXLazyDialog")(l),e=b[0];b=k(c("MWJewelPopoverDialogContext.react"));var f=b.setIsOpenForDialog;a[0]!==f||a[1]!==e?(b=function(){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","security_alerts"),f(!0),e({})},a[0]=f,a[1]=e,a[2]=b):b=a[2];var g,i;a[3]===Symbol["for"]("react.memo_cache_sentinel")?(g=h._(/*BTDS*/"Security alerts"),i=h._(/*BTDS*/"View and manage alerts for logins and key changes"),a[3]=g,a[4]=i):(g=a[3],i=a[4]);a[5]!==b?(g=j.jsx(c("MWXMenuItem.react"),{onClick:b,primaryText:g,secondaryText:i,testid:void 0}),a[5]=b,a[6]=g):g=a[6];return g}g["default"]=a}),226);
__d("MAWXMAPreviewsSettingsMenuItem.react",["fbt","JSResourceForInteraction","MWXMenuItem.react","react","react-compiler-runtime","useMWXLazyDialog","useXMAPreviewsDisabledSetting"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k=h._(/*BTDS*/"Previews"),l=h._(/*BTDS*/"See previews of Facebook content"),m=c("JSResourceForInteraction")("MAWXMAPreviewSettingsDialog.react").__setRef("MAWXMAPreviewsSettingsMenuItem.react");function a(){var a=d("react-compiler-runtime").c(9),b=c("useXMAPreviewsDisabledSetting")(),e=c("useMWXLazyDialog")(m),f=e[0];a[0]!==b?(e=b?h._(/*BTDS*/"Off"):h._(/*BTDS*/"On"),a[0]=b,a[1]=e):e=a[1];a[2]!==e?(b={auxText:e,type:"text"},a[2]=e,a[3]=b):b=a[3];a[4]!==f?(e=function(){return f({})},a[4]=f,a[5]=e):e=a[5];var g;a[6]!==b||a[7]!==e?(g=j.jsx(c("MWXMenuItem.react"),{auxItem:b,onClick:e,primaryText:k,secondaryText:l}),a[6]=b,a[7]=e,a[8]=g):g=a[8];return g}g["default"]=a}),226);
__d("MWChatEncryptedBackupsAddDeviceWithEBKeys",["EBMainThreadEBDBApiDeferred","EBSMAPI","EBWorkerODSEntityName.enum","cr:21222"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.backupId,f=a.db,g=a.newDeviceRegistrationId,h=a.previousDeviceId;return c("EBSMAPI").addDeviceWithEBKeys({backupId:e,db:f,newDeviceRegistrationId:g,previousDeviceId:h,source:c("EBWorkerODSEntityName.enum").MW_EB_AUTO_RESTORE_MAIN_THREAD,trackAddingDevice:function(a){void d("EBMainThreadEBDBApiDeferred").addNewDevice(a)}}).then(function(){return b("cr:21222")==null?void 0:b("cr:21222").fireAndForget("backend","addDeviceWithKeysInWorker",{backupId:e,deviceRegistrationId:g,isAutoRestore:!0,previousDeviceId:h,source:c("EBWorkerODSEntityName.enum").MW_EB_AUTO_RESTORE_WORKER})})}g.addDeviceWithEBKeys=a}),98);
__d("MWChatEncryptedBackupsHandleRestoreWrapper.react",["cr:6736","cr:8598","cr:8599","cr:8601"],(function(a,b,c,d,e,f,g){"use strict";function a(){b("cr:8598")==null||b("cr:8598")();b("cr:8599")==null||b("cr:8599")();b("cr:8601")==null||b("cr:8601")();b("cr:6736")==null||b("cr:6736")();return null}g["default"]=a}),98);
__d("MWChatEncryptedBackupsRestoreJewelForgotPinButtonSuspender.react",["MWEncryptedBackupsForgotPinStep","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h=["children","href","onClick","onHoverEnd","onHoverStart","onPressStart","rel","target"],i;i||d("react");function a(a){var b=d("react-compiler-runtime").c(24),c=a.children;a=a.dismissSoftblock;var e;b[0]!==a?(e={onDismiss:a},b[0]=a,b[1]=e):e=b[1];a=d("MWEncryptedBackupsForgotPinStep").useForgotPinLinkShowDialogProps(e);var f,g,i,j,k,l,m,n;b[2]!==a?(e=a.children,g=a.href,i=a.onClick,j=a.onHoverEnd,k=a.onHoverStart,l=a.onPressStart,m=a.rel,n=a.target,f=babelHelpers.objectWithoutPropertiesLoose(a,h),b[2]=a,b[3]=f,b[4]=g,b[5]=e,b[6]=i,b[7]=j,b[8]=k,b[9]=l,b[10]=m,b[11]=n):(f=b[3],g=b[4],e=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11]);if(b[12]!==c||b[13]!==f||b[14]!==a||b[15]!==g||b[16]!==e||b[17]!==i||b[18]!==j||b[19]!==k||b[20]!==l||b[21]!==m||b[22]!==n){var o=babelHelpers["extends"]({},f,{label:e,linkProps:g!=null?{rel:m,target:n,url:g}:void 0,onHoverIn:k,onHoverOut:j,onPress:i,onPressIn:l});o=c({buttonProps:o,linkProps:a});b[12]=c;b[13]=f;b[14]=a;b[15]=g;b[16]=e;b[17]=i;b[18]=j;b[19]=k;b[20]=l;b[21]=m;b[22]=n;b[23]=o}else o=b[23];return o}g["default"]=a}),98);
__d("MWChatSidebarEncryptedBackupsMenuItem.react",["fbt","MAWEncryptedBackupsStateManager","MWChatEncryptedBackupsSettingsDialog.entrypoint","MWEBEntrypointsKillswitch.enum","MWJewelPopoverDialogContext.react","MWXMenuItem.react","promiseDone","react","react-compiler-runtime","requireDeferred","useMWEBBackupState","useMWXEntryPointDialog","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react")),l=j.useContext,m=c("requireDeferred")("MWEncryptedBackupsFetchBackupMetadata").__setRef("MWChatSidebarEncryptedBackupsMenuItem.react"),n=h._(/*BTDS*/"Message storage"),o=h._(/*BTDS*/"Manage how you store and access your chat history.");function a(){var a=d("react-compiler-runtime").c(13),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b={},a[0]=b):b=a[0];b=c("useMWXEntryPointDialog")(c("MWChatEncryptedBackupsSettingsDialog.entrypoint"),b);var e=b[0];b=l(c("MWJewelPopoverDialogContext.react"));var f=b.setIsOpenForDialog,g=(i||(i=c("useReStore")))();a[1]===Symbol["for"]("react.memo_cache_sentinel")?(b={entrypoint:c("MWEBEntrypointsKillswitch.enum").EB_SETTINGS},a[1]=b):b=a[1];var j=c("useMWEBBackupState")(b);a[2]!==j||a[3]!==f||a[4]!==e||a[5]!==g?(b=function(){d("MAWEncryptedBackupsStateManager").eligibleForEBUX(j)&&m.onReady(function(a){a=a.fetchBackupMetadata;c("promiseDone")(a(g))}),f(!0),e({})},a[2]=j,a[3]=f,a[4]=e,a[5]=g,a[6]=b):b=a[6];b=b;var p=j===-1||j===1,q;a[7]!==j||a[8]!==p?(q=p?void 0:{auxText:j===3?h._(/*BTDS*/"On"):h._(/*BTDS*/"Off"),type:"text"},a[7]=j,a[8]=p,a[9]=q):q=a[9];a[10]!==b||a[11]!==q?(p=k.jsx(c("MWXMenuItem.react"),{auxItem:q,onClick:b,primaryText:n,role:"button",secondaryText:o,testid:void 0}),a[10]=b,a[11]=q,a[12]=p):p=a[12];return p}g["default"]=a}),226);
__d("MWChatSidebarSettingsE2EEChatsMenu.react",["fbt","MAWSecurityAlertsMenuItem.react","MAWXMAPreviewsSettingsMenuItem.react","MWXDivider.react","MWXMenuItemWithSubmenu.react","cr:3079","cr:6692","cr:6733","cr:7398","cr:8596","cr:8597","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k={divider:{marginTop:"x1gslohp",marginBottom:"x12nagc",marginInlineStart:"xyqm7xq",marginInlineEnd:"x1ys307a",marginLeft:null,marginRight:null,$$css:!0}},l=h._(/*BTDS*/"End-to-end encrypted chats"),m=h._(/*BTDS*/"Manage your end-to-end encrypted chat settings"),n=(f=(e=b("cr:8596"))!=null?e:b("cr:8597"))!=null?f:b("cr:6733");function a(){var a=d("react-compiler-runtime").c(4),e,f,g;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(e={title:l},f=n!=null?j.jsx(n,{},"encrypted-backups-comet"):null,g=j.jsx(c("MAWSecurityAlertsMenuItem.react"),{},"security-alerts-after-redesign"),a[0]=e,a[1]=f,a[2]=g):(e=a[0],f=a[1],g=a[2]);a[3]===Symbol["for"]("react.memo_cache_sentinel")?(e=j.jsx(c("MWXMenuItemWithSubmenu.react"),{primaryText:l,secondaryText:m,submenu:{header:e,items:[f,g,j.jsxs(j.Fragment,{children:[j.jsx(c("MWXDivider.react"),{xstyle:k.divider}),j.jsx(c("MAWXMAPreviewsSettingsMenuItem.react"),{})]},"settings-xma-previews"),b("cr:3079")!=null?j.jsx(b("cr:3079"),{},"encrypted-backups-dev-options"):null,b("cr:6692")&&j.jsx(b("cr:6692"),{},"persisted-eb-state-menu"),b("cr:7398")!=null?j.jsx(b("cr:7398"),{},"reset-menu"):null]},testid:void 0}),a[3]=e):e=a[3];return e}g["default"]=a}),226);
__d("MWSupportInboxDialogQuery$Parameters",["MWSupportInboxDialogQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("MWSupportInboxDialogQuery_facebookRelayOperation"),metadata:{},name:"MWSupportInboxDialogQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("MWSupportInboxDialog.entrypoint",["JSResourceForInteraction","MWSupportInboxDialogQuery$Parameters","WebPixelRatio"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(){return{queries:{queryReference:{options:{fetchPolicy:"network-only"},parameters:c("MWSupportInboxDialogQuery$Parameters"),variables:{scale:d("WebPixelRatio").get()}}}}},root:c("JSResourceForInteraction")("MWSupportInboxDialog.react").__setRef("MWSupportInboxDialog.entrypoint")};g["default"]=a}),98);
__d("XSupportInboxControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/support/",Object.freeze({second:!1,shimmed_in_item:!1}),void 0);b=a;g["default"]=b}),98);
__d("MWSupportInboxMenuItem.react",["fbt","MWJewelPopoverDialogContext.react","MWPBumpEntityKey","MWSupportInboxDialog.entrypoint","MWXMenuItem.react","MessengerWebUXLogger","QPLUserFlow","XSupportInboxControllerRouteBuilder","gkx","qpl","react","react-compiler-runtime","useMWXEntryPointDialog"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useContext;function a(){var a=d("react-compiler-runtime").c(12),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b={},a[0]=b):b=a[0];b=c("useMWXEntryPointDialog")(c("MWSupportInboxDialog.entrypoint"),b);var e=b[0];b=k(c("MWJewelPopoverDialogContext.react"));var f=b.setIsOpenForDialog,g=c("MessengerWebUXLogger").useInteractionLogger();a[1]===Symbol["for"]("react.memo_cache_sentinel")?(b={eventName:"support_inbox_entrypoint_impression"},a[1]=b):b=a[1];b=c("MessengerWebUXLogger").useImpressionLoggerRef(b);var i;a[2]===Symbol["for"]("react.memo_cache_sentinel")?(i=c("gkx")("23433")?void 0:c("XSupportInboxControllerRouteBuilder").buildURL({}),a[2]=i):i=a[2];var l;a[3]!==g||a[4]!==f||a[5]!==e?(l=function(){g==null||g({eventName:"support_inbox_entrypoint_click"}),c("gkx")("23433")&&(c("QPLUserFlow").start(c("qpl")._(25305734,"469")),d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","support_inbox"),f(!0),e({}))},a[3]=g,a[4]=f,a[5]=e,a[6]=l):l=a[6];var m;a[7]===Symbol["for"]("react.memo_cache_sentinel")?(m=h._(/*BTDS*/"Reported chats"),a[7]=m):m=a[7];var n;a[8]===Symbol["for"]("react.memo_cache_sentinel")?(n=h._(/*BTDS*/"View updates about your reports"),a[8]=n):n=a[8];a[9]!==b||a[10]!==l?(i=j.jsx(c("MWXMenuItem.react"),{href:i,onClick:l,primaryText:m,ref:b,secondaryText:n}),a[9]=b,a[10]=l,a[11]=i):i=a[11];return i}g["default"]=a}),226);
__d("MWChatSidebarSettingsPrivacyMenu.react",["fbt","FDSMenuSeparator.react","MWEBEntrypointsKillswitch.enum","MWPBumpEntityKey","MWSupportInboxMenuItem.react","MWXIconMenuItemHouseKeyhole","MWXMenuItemWithSubmenu.react","cr:20183","cr:7253","cr:8073","react","react-compiler-runtime","useMWEBBackupState"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(){var a=d("react-compiler-runtime").c(10),e;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(e={entrypoint:c("MWEBEntrypointsKillswitch.enum").SIDEBAR_SETTINGS_PRIVACY_MENU},a[0]=e):e=a[0];e=c("useMWEBBackupState")(e);var f;if(a[1]!==e){f=[];if(b("cr:7253")!=null){var g;a[3]===Symbol["for"]("react.memo_cache_sentinel")?(g=j.jsx(b("cr:7253"),{},"settings-e2ee-chats"),a[3]=g):g=a[3];f.push(g)}if(b("cr:20183")!=null){a[4]===Symbol["for"]("react.memo_cache_sentinel")?(g=j.jsx(b("cr:20183"),{},"settings-read-receipts"),a[4]=g):g=a[4];f.push(g)}a[5]===Symbol["for"]("react.memo_cache_sentinel")?(g=j.jsx(c("MWSupportInboxMenuItem.react"),{},"settings-support-inbox"),a[5]=g):g=a[5];f.push(g);if(b("cr:8073")!=null&&e===3){a[6]===Symbol["for"]("react.memo_cache_sentinel")?(g=j.jsxs(j.Fragment,{children:[j.jsx(c("FDSMenuSeparator.react"),{}),j.jsx(b("cr:8073"),{})]},"settings-verify-keys-in-chat"),a[6]=g):g=a[6];f.push(g)}a[1]=e;a[2]=f}else f=a[2];a[7]===Symbol["for"]("react.memo_cache_sentinel")?(g=h._(/*BTDS*/"Privacy and safety"),a[7]=g):g=a[7];a[8]!==f?(e=j.jsx(c("MWXMenuItemWithSubmenu.react"),{icon:c("MWXIconMenuItemHouseKeyhole"),onClick:k,primaryText:g,submenu:{items:f},testid:void 0}),a[8]=f,a[9]=e):e=a[9];return e}function k(){return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","privacy_submenu")}g["default"]=a}),226);
__d("MWDeserializeSecretsAndAddDevice",["LSDeserializeSecretsAndAddDeviceStoredProcedure","LSFactory"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.initiatorId,d=a.secrets;a=a.storage;return a.runInTransaction(function(a){return c("LSDeserializeSecretsAndAddDeviceStoredProcedure")(c("LSFactory")(a),{deviceRegistrationId:b,serializedPayload:d})},"readwrite",void 0,void 0,f.id+":31")}g["default"]=a}),98);
__d("useMWDropEBDbMenuDialog",["fbt","EBDB","promiseDone","react-compiler-runtime","setTimeout","useMWXConfirmationDialog"],(function(a,b,c,d,e,f,g,h){"use strict";function a(){var a=d("react-compiler-runtime").c(3),b=c("useMWXConfirmationDialog")(),e;a[0]===Symbol.for("react.memo_cache_sentinel")?(e=async function(){await d("EBDB").clearAll()},a[0]=e):e=a[0];var f=e;a[1]!==b?(e=function(){return b({body:h._(/*BTDS*/"Confirm deleting persisted state for encrypted backups?"),cancel:h._(/*BTDS*/"Cancel"),confirm:h._(/*BTDS*/"Delete"),title:h._(/*BTDS*/"Clear Messaging Data")},function(){c("promiseDone")(f().then(i))})},a[1]=b,a[2]=e):e=a[2];return e}function i(){c("setTimeout")(j,500)}function j(){window.location.reload()}g.default=a}),226);
__d("MWDropEBDbMenu.react",["cr:5086","react","react-compiler-runtime","useMWDropEBDbMenuDialog"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(){var a=d("react-compiler-runtime").c(2),e=c("useMWDropEBDbMenuDialog")(),f;a[0]!==e?(f=b("cr:5086")!=null?i.jsx(b("cr:5086"),{onClick:e,primaryText:"[Fb-only] Clear persisted EB DB"}):null,a[0]=e,a[1]=f):f=a[1];return f}g["default"]=a}),98);
__d("MWEBAutoRestoreNoticeDialogStep.react",["fbt","CometRelay","MWChatEncryptedBackupsDismissalDialogContext","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsSettingsDialog.entrypoint","MWXButton.react","MWXColumn.react","MWXColumnItem.react","MWXDialogHeader.react","MWXDialogPage.react","MWXLink.react","MWXRow.react","MWXRowItem.react","MWXText.react","gkx","qex","react","react-compiler-runtime","useCometRelayEntrypointContextualEnvironmentProvider","useEncryptedBackupsQplImpressionRef","useMergeRefs","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));f=i;f.useCallback;var k=f.useContext,l=f.useRef,m=c("gkx")("23219");function a(){var a=d("react-compiler-runtime").c(2),b=k(c("MWChatEncryptedBackupsDismissalDialogContext")),e=b.isDismissedDisabled,f=b.setIsDismissedDisabled,g=l(e);a[0]!==f?(b={onHidden:function(){f(g.current)},onVisible:function(){f(!0)}},a[0]=f,a[1]=b):b=a[1];return c("useVisibilityObserver")(b)}function b(){}f=(f=(f=c("qex")._("3628"))!=null?f:c("qex")._("2123"))!=null?f:!1;var n=f?a:b;function e(a){var b=d("react-compiler-runtime").c(26),e=a.onComplete,f=a.pushPage;a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,"AUTO_RESTORE_NOTICE_SCREEN_IMPRESSION");var g=c("useCometRelayEntrypointContextualEnvironmentProvider")(),i;b[0]!==g||b[1]!==e||b[2]!==f?(i=function(){var a=d("CometRelay").loadEntryPoint(g,c("MWChatEncryptedBackupsSettingsDialog.entrypoint"),{});f(function(){return j.jsx(d("CometRelay").EntryPointContainer,{entryPointReference:a,props:{onClose:e,pushPageFromParent:f}})},{withoutBackButton:!0})},b[0]=g,b[1]=e,b[2]=f,b[3]=i):i=b[3];i=i;var k=n();a=c("useMergeRefs")(a,k);b[4]===Symbol["for"]("react.memo_cache_sentinel")?(k=h._(/*BTDS*/"Changes to secure storage settings"),b[4]=k):k=b[4];b[5]!==e?(k=j.jsx(c("MWXDialogHeader.react"),{onClose:e,title:k,withBackButton:!1,withCloseButton:!0}),b[5]=e,b[6]=k):k=b[6];if(b[7]!==i){var l;b[9]===Symbol["for"]("react.memo_cache_sentinel")?(l=h._(/*BTDS*/"Settings"),b[9]=l):l=b[9];l=j.jsx(c("MWXLink.react"),{onClick:i,children:l});var o;b[10]!==l?(o=j.jsx(c("MWXText.react"),{color:"blueLink",type:"bodyLink3",children:l}),b[10]=l,b[11]=o):o=b[11];l=h._(/*BTDS*/"After you've restored chat history, messages will continue to sync automatically even if you log out and log back in. You can turn this off in {[Armadillo] Inline settings link parameter.}.",[h._param("[Armadillo] Inline settings link parameter.",o)]);b[7]=i;b[8]=l}else l=b[8];b[12]!==l?(o=j.jsx(c("MWXColumnItem.react"),{paddingHorizontal:m?8:0,paddingTop:12,children:j.jsx(c("MWXText.react"),{align:"start",type:"body3",children:l})}),b[12]=l,b[13]=o):o=b[13];b[14]===Symbol["for"]("react.memo_cache_sentinel")?(i=h._(/*BTDS*/"OK"),b[14]=i):i=b[14];b[15]!==e?(l=j.jsx(c("MWXColumnItem.react"),{paddingTop:16,children:j.jsx(c("MWXRow.react"),{align:"end",paddingHorizontal:0,paddingTop:16,children:j.jsx(c("MWXRowItem.react"),{expanding:m,children:j.jsx(c("MWXButton.react"),{label:i,onPress:e,padding:"wide",testid:void 0})})})}),b[15]=e,b[16]=l):l=b[16];b[17]!==o||b[18]!==l?(i=j.jsxs(c("MWXColumn.react"),{paddingVertical:8,testid:void 0,children:[o,l]}),b[17]=o,b[18]=l,b[19]=i):i=b[19];b[20]!==a||b[21]!==i?(o=j.jsx("div",{ref:a,children:i}),b[20]=a,b[21]=i,b[22]=o):o=b[22];b[23]!==k||b[24]!==o?(l=j.jsx(c("MWXDialogPage.react"),{footer:null,header:k,children:o}),b[23]=k,b[24]=o,b[25]=l):l=b[25];return l}g["default"]=e}),226);
__d("MWEBOTCDialog.entrypoint",["JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(){return{queries:{}}},root:c("JSResourceForInteraction")("MWEBOTCDialog.react").__setRef("MWEBOTCDialog.entrypoint")};g["default"]=a}),98);
__d("MWEBQPWithPinState.enum",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({INITIAL:0,RESTORE_IN_PROGRESS:1});c=a;f["default"]=c}),66);
__d("MWEBRestoreQPWithPin_viewer.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MWEBRestoreQPWithPin_viewer",selections:[{alias:null,args:null,concreteType:"MessengerDefaultEncryptedBackup",kind:"LinkedField",name:"messenger_default_encrypted_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"VestaGetUserInfoResponse",kind:"LinkedField",name:"vesta_user_info",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"useMWChatEncryptedBackupsVestaUserInfo_vestaGetUserInfoResponse"}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"encrypted_backup",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"has_seen_eb_auto_restore_notice",storageKey:null}],storageKey:null},{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"qp_with_pin_state",storageKey:null}]}],type:"Viewer",abstractKey:null};e.exports=a}),null);
__d("MWEBRestoreQPWithPin.react",["fbt","CometPlaceholder.react","CometRelay","CometVisualCompletionAttributes","EncryptedBackupsSupportedPlatformUtils","FBLogger","FocusRegion.react","JSResourceForInteraction","MWChatEBPinCodeVerifyIndicator.react","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsNumericCodeErrorWrapper.react","MWChatEncryptedBackupsNumericCodeInput.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWChatEncryptedBackupsRestoreJewelForgotPinButtonSuspender.react","MWEBFlowSourceContextProvider.react","MWEBOTCDialog.entrypoint","MWEBQPWithPinState.enum","MWEBRestoreQPWithPin_viewer.graphql","MWEncryptedBackupsForgotPinStep","MWEncryptedBackupsRetrieveQplLoggingAnnotations","MWJewelPopoverDialogContext.react","MWLogInboxFiltersInteraction","MWLogInteraction","MWXCircleButton.react","MWXColumn.react","MWXColumnItem.react","MWXIconCross","MWXImage.react","MWXLink.react","MWXRow.react","MWXRowItem.react","MWXText.react","QPLUserFlow","cr:6334","cr:6335","focusScopeQueries","getMWEBRestoreQPCautionCircleProperties","gkx","promiseDone","react","react-compiler-runtime","useAsyncReStore","useLabyrinthLogging","useMWChatEncryptedBackupsPinCodeRestore","useMWChatEncryptedBackupsVestaUserInfo","useMWEBFlowSourceContext","useMWXEntryPointDialog","useMWXLazyDialog","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));e=j;var l=e.useCallback,m=e.useContext,n=e.useEffect,o=e.useMemo,p=e.useRef,q=e.useState,r=c("JSResourceForInteraction")("MWChatEncryptedBackupsPinCodeBlockedDialog.react").__setRef("MWEBRestoreQPWithPin.react"),s="chat-encrypted-backups-jewel-qp-with-pin-input",t={icon:{paddingTop:"x889kno",$$css:!0}};function u(a){var e,f,g=a.clientID,j=a.doesUserHaveOtcEligibleDevices,u=a.fragmentKey,v=a.isInbox,w=a.setClosed,x=a.setDismissed,y=d("CometRelay").useFragment(i!==void 0?i:i=b("MWEBRestoreQPWithPin_viewer.graphql"),u),z=d("CometRelay").useRelayEnvironment(),A=l(function(a){return d("CometRelay").commitLocalUpdate(z,function(b){b=b.getRoot().getLinkedRecord("viewer");if(b==null){c("FBLogger")("wmi_eb").mustfix("[labyrinth][jewel_softblock_state] A viewer record does not exist when propagating EB restore qp with pin state");return}b.setValue(a,"qp_with_pin_state")})},[z]);a=y==null||(e=y.messenger_default_encrypted_backup)==null?void 0:e.vesta_user_info;var B=c("useMWChatEncryptedBackupsVestaUserInfo")({vestaGetUserInfoResponse$key:a}),C=B.attemptsRemaining===0||B.loginTimeoutRemainingSecs!=null;u=q(!1);var D=u[0],E=u[1],F=p(!1);a=c("useMWXLazyDialog")(r);var G=a[0];n(function(){C&&D===!0&&F.current!==!0&&(F.current=!0,G({attemptsRemaining:B.attemptsRemaining,loginTimeoutRemainingSecs:B.loginTimeoutRemainingSecs,onDismiss:function(){}}))},[C,G,D,B.attemptsRemaining,B.loginTimeoutRemainingSecs]);u=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var H=u.startFlow,I=c("useAsyncReStore")(),J=c("useMWEBFlowSourceContext")(),K=o(function(){return J()},[J]),L=l(function(a){c("promiseDone")(I.then(function(b){d("MWEncryptedBackupsRetrieveQplLoggingAnnotations").encryptedBackupsRetrieveQplLoggingAnnotations({db:b,onFetch:function(b){var e=b.ebsmWiped,f=b.firstUpsellTime,g=b.hasEbKeysLocally,h=b.hasEBSM,i=b.hasPDB,k=b.hasUserRestoredBefore;b=b.hasUserRestoredBeforeTemp;H({additionalAnnotations:{eb_session_identifier:f,ebsm_wiped:e,has_eb_keys_locally:g,has_ebsm:h,has_pdb:i,has_user_restored_before:k,has_user_restored_before_temp:b,is_otc_eligible:j.toString(),is_pin_set:"true",restore_upsell_first_impression_time:f},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:K});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,a)}})}))},[I,H,j,K]);a=l(function(){var a=v?"RESTORE_QP_WITH_PIN_INBOX_DISMISSED":"RESTORE_QP_WITH_PIN_JEWEL_DISMISSED";L(a);d("MWChatEncryptedBackupsLogging").cancelFlow({cancelEndPoint:"thread_list_qp_with_pin",event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent});w();x()},[v,w,x,L]);u=m(c("MWJewelPopoverDialogContext.react"));var M=u.setIsOpenForDialog,N=b("cr:6334")==null?void 0:b("cr:6334")(),O=b("cr:6335")==null?void 0:b("cr:6335")();u=l(function(){w();if(N!=null)N(K);else if(O!=null){var a,b;O({hasSeenNotice:(a=y==null||(b=y.encrypted_backup)==null?void 0:b.has_seen_eb_auto_restore_notice)!=null?a:!1,source:K})}M(!0);A(c("MWEBQPWithPinState.enum").INITIAL)},[w,N,O,A,K,M,y==null||(f=y.encrypted_backup)==null?void 0:f.has_seen_eb_auto_restore_notice]);g=d("useMWChatEncryptedBackupsPinCodeRestore").useMWChatEncryptedBackupsPinCodeRestore({clientID:g,focusRegionId:s,onSubmitPin:function(){E(!0),d("MWLogInteraction").logPopoverOpenCancel("initiate_restore"),d("MWLogInboxFiltersInteraction").logInboxFiltersNavigationCancel("initiate_restore"),A(c("MWEBQPWithPinState.enum").RESTORE_IN_PROGRESS)},onSubmitPinFailure:function(){A(c("MWEBQPWithPinState.enum").INITIAL)},onVestaComplete:u});u=g.inputProps;var P=g.invalidKeyPressedError,Q=g.isInProgress,R=g.isLabyrinthError,S=g.isPinCodeIncorrect;g=g.isVestaError;Q=(y==null?void 0:y.qp_with_pin_state)===c("MWEBQPWithPinState.enum").RESTORE_IN_PROGRESS||Q;var T=c("useVisibilityObserver")({onVisible:function(){d("FocusRegion.react").focusRegionById(s,d("focusScopeQueries").tabbableScopeQuery);var a=v?"RESTORE_QP_WITH_PIN_INBOX_IMPRESSION":"RESTORE_QP_WITH_PIN_JEWEL_IMPRESSION";L(a)}}),U=c("useMWXEntryPointDialog")(c("MWEBOTCDialog.entrypoint"),{}),V=U[0],W=l(function(){V({source:v?c("MWChatEncryptedBackupsQPLSource.enum").INBOX_THREADLIST_QP:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_QP},function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_CLOSE_DIALOG_CLICK")})},[v,V]);U=P!=null?P:S?h._(/*BTDS*/"Incorrect PIN. Try again."):R||g?h._(/*BTDS*/"There was an error while using the PIN code. Please try again"):void 0;if(C===!0){w();return null}P=c("gkx")("23219");return k.jsx("div",babelHelpers["extends"]({},{0:{className:"xlhe6ec x1obq294 x5a5i1n xde0f50 x15x8krk xe4pinz x14vqqas x1ys307a xod5an3 xyqm7xq xz9dl7a xpdmqnj xsag5q8 x1g0dm76"},1:{className:"x1obq294 x5a5i1n xde0f50 x15x8krk xe4pinz x14vqqas x1ys307a xod5an3 xyqm7xq xz9dl7a xpdmqnj xsag5q8 x1g0dm76 x1jx94hy"}}[!!P<<0],{children:k.jsxs(c("MWXColumn.react"),{ref:T,testid:void 0,children:[k.jsx(c("MWXColumnItem.react"),{children:k.jsxs(c("MWXRow.react"),{paddingHorizontal:0,paddingVertical:0,spacing:12,children:[k.jsx(c("MWXRowItem.react"),{xstyle:t.icon,children:k.jsx(c("MWXImage.react"),{src:c("getMWEBRestoreQPCautionCircleProperties")()})}),k.jsx(c("MWXRowItem.react"),{expanding:!0,children:k.jsxs(c("MWXColumn.react"),{paddingTop:8,spacing:12,children:[k.jsx(c("MWXColumnItem.react"),{children:k.jsx(c("MWXText.react"),{align:"start",numberOfLines:2,type:"headlineEmphasized4",children:h._(/*BTDS*/"Chat history is missing")})}),k.jsx(c("MWXColumnItem.react"),{children:k.jsx(c("MWXText.react"),{align:"start",color:P?"secondary":"primary",numberOfLines:2,type:"body4",children:h._(/*BTDS*/"Enter your PIN to restore chat history.")})})]})}),k.jsx(c("MWXRowItem.react"),{children:k.jsx(c("MWXCircleButton.react"),{color:"primary",icon:c("MWXIconCross"),label:h._(/*BTDS*/"Close"),onPress:a,size:P?24:32,testid:void 0})})]})}),k.jsx(c("MWXColumnItem.react"),{paddingTop:16,children:k.jsx(c("MWChatEncryptedBackupsNumericCodeErrorWrapper.react"),{error:U,inputSize:"small",children:k.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").tabbableScopeQuery,id:s,children:k.jsx(c("MWChatEncryptedBackupsNumericCodeInput.react"),babelHelpers["extends"]({},u,{color:P?"primary":"secondary",disabled:Q,inputSize:"small",testid:void 0}))})})}),Q&&k.jsx(c("MWXColumnItem.react"),{align:"center",children:k.jsx("div",{className:"xfitlp5 x9otpla",children:k.jsx(c("MWChatEBPinCodeVerifyIndicator.react"),{isMessenger:P})})}),!Q&&k.jsx(c("MWXColumnItem.react"),{align:"center",children:k.jsx("div",babelHelpers["extends"]({},{0:{},2:{className:"xod5an3"},1:{className:"x12nagc x1iorvi4"},3:{className:"x12nagc x1iorvi4"}}[!!(U==null)<<1|!!(U!=null)<<0],{children:k.jsx(c("MWXText.react"),{color:"blueLink",type:"bodyLink4",children:j===!0?k.jsx(c("MWXLink.react"),{onClick:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_RESTORE_USE_ONE_TIME_CODE_CLICK"),M(!0),W()},children:h._(/*BTDS*/"Use a one-time code instead")}):k.jsx("div",babelHelpers["extends"]({},c("CometVisualCompletionAttributes").IGNORE,{children:k.jsx(c("CometPlaceholder.react"),{fallback:k.jsx(c("MWXLink.react"),babelHelpers["extends"]({testid:void 0},d("MWEncryptedBackupsForgotPinStep").STATIC_HELP_CENTER_LINK_PROPS,{onClick:function(a){c("FBLogger")("wmi_eb").tags(["jewel_restore_qp"]).warn("User clicked on the placeholder Forgot PIN button"),d("MWEncryptedBackupsForgotPinStep").STATIC_HELP_CENTER_LINK_PROPS.onClick==null||d("MWEncryptedBackupsForgotPinStep").STATIC_HELP_CENTER_LINK_PROPS.onClick(a)}})),name:"mw-chat-encrypted-backups-jewel-forgot-pin-fallback-link",children:k.jsx(c("MWChatEncryptedBackupsRestoreJewelForgotPinButtonSuspender.react"),{children:function(a){var b=a.linkProps;return k.jsx(c("MWXLink.react"),babelHelpers["extends"]({testid:void 0},b,{onClick:function(a){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"RESTORE_FORGOT_PIN_CLICK"),b.onClick==null||b.onClick(a)}}))}})})}))})}))})]})}))}u.displayName=u.name+" [from "+f.id+"]";function a(a){var b=d("react-compiler-runtime").c(10),e=a.clientID,f=a.currentSupportedPlatform,g=a.doesUserHaveOtcEligibleDevices,h=a.fragmentKey,i=a.setClosed;a=a.setDismissed;f=f!==d("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.FACEBOOK_DOT_COM;var j=f?c("MWChatEncryptedBackupsQPLSource.enum").INBOX_THREADLIST_QP_WITH_PIN:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_QP_WITH_PIN,l;b[0]!==e||b[1]!==g||b[2]!==h||b[3]!==f||b[4]!==i||b[5]!==a?(l=k.jsx(u,{clientID:e,doesUserHaveOtcEligibleDevices:g,fragmentKey:h,isInbox:f,setClosed:i,setDismissed:a}),b[0]=e,b[1]=g,b[2]=h,b[3]=f,b[4]=i,b[5]=a,b[6]=l):l=b[6];b[7]!==j||b[8]!==l?(e=k.jsx(c("MWEBFlowSourceContextProvider.react"),{source:j,children:l}),b[7]=j,b[8]=l,b[9]=e):e=b[9];return e}g["default"]=a}),226);
__d("MWEncryptedBackupsDeviceUtils",[],(function(a,b,c,d,e,f){"use strict";a=[6628568379,173847642670370,350685531728];b=[173847642670370];f.FB_APP_IDS=a;f.TABLET_APP_IDS=b}),66);
__d("MWEncryptedBackupsDeviceListCell.react",["fbt","AddOnStartOverride.react","BaseMiddot.react","FDSRelativeTimestamp.react","I64","MWEncryptedBackupsDeviceUtils","MWXIconForListCell.react","MWXIconMobile","MWXIconTablet","MWXListCell.react","MWXTextPairing.react","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||(i=d("react")),l=i.useMemo;function a(a){var b=a.device;a=l(function(){return b.appId!=null?(j||(j=d("I64"))).to_float(b.appId):null},[b.appId]);var e=d("MWEncryptedBackupsDeviceUtils").TABLET_APP_IDS.includes(a);a=d("MWEncryptedBackupsDeviceUtils").FB_APP_IDS.includes(a)?h._(/*BTDS*/"Facebook"):h._(/*BTDS*/"Messenger");return k.jsx(c("MWXListCell.react"),{addOnStart:k.jsx(c("AddOnStartOverride.react"),{children:k.jsx(c("MWXIconForListCell.react"),{icon:e?c("MWXIconTablet"):c("MWXIconMobile"),size:"large"})}),content:k.jsx(c("MWXTextPairing.react"),{body:b.lastUploadTime!=null&&h._(/*BTDS*/"Last seen {last_seen}",[h._param("last_seen",k.jsx(c("FDSRelativeTimestamp.react"),{date:new Date(Number(b.lastUploadTime)*1e3)}))]),bodyColor:"secondary",headline:b.model!=null?k.jsxs(k.Fragment,{children:[a,k.jsx(c("BaseMiddot.react"),{}),b.model]}):a,level:4})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWEncryptedBackupsFetchBackupMetadata",["LSFactory","LSFetchBackupsMetadataStoredProcedure"],(function(a,b,c,d,e,f,g){"use strict";function a(a){return a.runInTransaction(function(a){return c("LSFetchBackupsMetadataStoredProcedure")(c("LSFactory")(a))},"readwrite",void 0,void 0,f.id+":17")}g.fetchBackupMetadata=a}),98);
__d("useFetchOTCEligibleEBDevices",["FBLogger","LSAuthorityLevel","LSFactory","LSFetchOTCEligibleEBDevicesV2StoredProcedure","LSIntEnum","ReQL","ReQLSuspense","gkx","promiseDone","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=j||d("react");b.useCallback;var k=b.useEffect;b.useMemo;var l=b.useRef,m=c("gkx")("24064");function a(a){var b=d("react-compiler-runtime").c(30),e=a===void 0?"store-or-network":a,g=(h||(h=c("useReStore")))(),j=l(!1);b[0]!==g.tables.encrypted_backups_otc_devices?(a=function(){return d("ReQL").fromTableAscending(g.tables.encrypted_backups_otc_devices)},b[0]=g.tables.encrypted_backups_otc_devices,b[1]=a):a=b[1];var q;b[2]!==g?(q=[g],b[2]=g,b[3]=q):q=b[3];var r=d("ReQLSuspense").useArray(a,q,f.id+":42");b[4]!==g?(a=function(){return g.runInTransaction(p,"readwrite",void 0,void 0,f.id+":48")},b[4]=g,b[5]=a):a=b[5];var s=a;b[6]!==s?(q=function(){c("promiseDone")(s(),null,o)},b[6]=s,b[7]=q):q=b[7];var t=q;b[8]!==e||b[9]!==r.length||b[10]!==t?(a=function(){j.current!==!0&&(r.length===0||e==="network-only")&&(j.current=!0,t())},q=[e,r.length,t],b[8]=e,b[9]=r.length,b[10]=t,b[11]=a,b[12]=q):(a=b[11],q=b[12]);k(a,q);a=r.length>0&&(i||(i=d("LSIntEnum"))).toNumber(r[0].authorityLevel)===c("LSAuthorityLevel").OPTIMISTIC;q=a;a=!q&&r.length>0&&r[0].deviceId==="-1";var u=a;b[13]!==u?(a=function(){u&&c("FBLogger")("wmi_eb").mustfix("Encrypted Backups OTC: Failed to fetch otc eligible devices.")},b[13]=u,b[14]=a):a=b[14];var v;b[15]!==u||b[16]!==s||b[17]!==e||b[18]!==q||b[19]!==r||b[20]!==t?(v=[u,s,e,q,r,t],b[15]=u,b[16]=s,b[17]=e,b[18]=q,b[19]=r,b[20]=t,b[21]=v):v=b[21];k(a,v);b[22]!==r?(a=r.filter(n),b[22]=r,b[23]=a):a=b[23];v=a;a=v;v=a.length>0||m;var w;b[24]!==u||b[25]!==q||b[26]!==a||b[27]!==v||b[28]!==t?(w={doesUserHaveOtcEligibleDevices:v,failedToFetchOtcDevices:u,isFetchOtcDevicesInFlight:q,otcEligibleDevices:a,triggerFetchOtcEligibleDevices:t},b[24]=u,b[25]=q,b[26]=a,b[27]=v,b[28]=t,b[29]=w):w=b[29];return w}function n(a){return(i||(i=d("LSIntEnum"))).toNumber(a.authorityLevel)!==c("LSAuthorityLevel").OPTIMISTIC&&a.deviceId!==""}function o(){c("FBLogger")("wmi_eb").mustfix("Failed to fetch OTC eligible devices")}async function p(a){var b=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.encrypted_backups_otc_devices));b=b!=null&&(i||(i=d("LSIntEnum"))).toNumber(b.authorityLevel)===c("LSAuthorityLevel").OPTIMISTIC;if(!b)return c("LSFetchOTCEligibleEBDevicesV2StoredProcedure")(c("LSFactory")(a))}g.default=a}),98);
__d("MWEncryptedBackupsOTCEligibleDevicesList.react",["fbt","AddOnStartOverride.react","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsDeviceListCell.react","MWXGlimmer.react","MWXIconExclamationMarkCircleOutline","MWXIconForListCell.react","MWXLink.react","MWXList.react","MWXListCell.react","MWXText.react","MWXTextPairing.react","QPLUserFlow","react","react-compiler-runtime","useFetchOTCEligibleEBDevices"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));b=i;var k=b.useEffect,l=b.useRef,m={glimmerBody:{borderStartStartRadius:"x10c0hgg",borderStartEndRadius:"x17hxvv9",borderEndEndRadius:"xys2atg",borderEndStartRadius:"x18dcsfh",height:"xlzyvqe",width:"x3hqpx7",$$css:!0},glimmerHeadline:{borderStartStartRadius:"x10c0hgg",borderStartEndRadius:"x17hxvv9",borderEndEndRadius:"xys2atg",borderEndStartRadius:"x18dcsfh",height:"xlzyvqe",width:"xktia5q",$$css:!0},glimmerIcon:{borderStartStartRadius:"xvs2etk",borderStartEndRadius:"xg3wpu6",borderEndEndRadius:"x1jwbhkm",borderEndStartRadius:"xgg4q86",height:"xc9qbxq",width:"x14qfxbe",$$css:!0}};function n(){var a=d("react-compiler-runtime").c(2),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=j.jsx(c("AddOnStartOverride.react"),{children:j.jsx(c("MWXGlimmer.react"),{index:0,xstyle:m.glimmerIcon})}),a[0]=b):b=a[0];a[1]===Symbol["for"]("react.memo_cache_sentinel")?(b=j.jsx(c("MWXListCell.react"),{addOnStart:b,content:j.jsx(c("MWXTextPairing.react"),{body:j.jsx(c("MWXGlimmer.react"),{index:2,xstyle:m.glimmerBody}),headline:j.jsx(c("MWXGlimmer.react"),{index:1,xstyle:m.glimmerHeadline}),level:4})}),a[1]=b):b=a[1];return b}function a(){var a=d("react-compiler-runtime").c(13),b=c("useFetchOTCEligibleEBDevices")(),e=b.failedToFetchOtcDevices,f=b.isFetchOtcDevicesInFlight,g=b.otcEligibleDevices;b=b.triggerFetchOtcEligibleDevices;var i=l(!1),m,q;a[0]!==e||a[1]!==f||a[2]!==g.length?(m=function(){f||(c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{"int":{otc_eligible_devices:g.length}}),e?i.current||(i.current=!0,c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_DEVICES_LIST_FAILURE")):!i.current&&g.length>0&&(i.current=!0,c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"OTC_DEVICES_LIST_LOADED")))},q=[e,f,g.length],a[0]=e,a[1]=f,a[2]=g.length,a[3]=m,a[4]=q):(m=a[3],q=a[4]);k(m,q);if(f){a[5]===Symbol["for"]("react.memo_cache_sentinel")?(m=j.jsx(n,{}),a[5]=m):m=a[5];return m}else if(e){a[6]===Symbol["for"]("react.memo_cache_sentinel")?(q=j.jsx(c("AddOnStartOverride.react"),{children:j.jsx(c("MWXIconForListCell.react"),{icon:c("MWXIconExclamationMarkCircleOutline"),size:"large"})}),a[6]=q):q=a[6];a[7]!==b?(m=j.jsx(c("MWXListCell.react"),{addOnStart:q,content:j.jsx(c("MWXText.react"),{type:"headlineEmphasized4",children:h._(/*BTDS*/"Unable to show your devices. {try_again}",[h._param("try_again",j.jsx(c("MWXText.react"),{color:"blueLink",type:"headlineEmphasized4",children:j.jsx(c("MWXLink.react"),{onClick:b,children:h._(/*BTDS*/"Refresh")})}))])})}),a[7]=b,a[8]=m):m=a[8];return m}else{a[9]!==g?(q=g.toSorted(p).map(o),a[9]=g,a[10]=q):q=a[10];a[11]!==q?(b=j.jsx(c("MWXList.react"),{testid:void 0,children:q}),a[11]=q,a[12]=b):b=a[12];return b}}function o(a){return j.jsx(c("MWEncryptedBackupsDeviceListCell.react"),{device:a},a.deviceId)}o.displayName=o.name+" [from "+f.id+"]";function p(a,b){return Number(b.lastUploadTime)-Number(a.lastUploadTime)}g["default"]=a}),226);
__d("MWEncryptedBackupsOTCEligibleDevicesPopover.react",["MWEncryptedBackupsOTCEligibleDevicesList.react","MWXPopover.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){a=d("react-compiler-runtime").c(1);var b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=i.jsx(c("MWXPopover.react"),{withArrow:!0,children:i.jsx("div",{className:"x1xiyphd x1odjw0f x1y1aw1k xf159sx xwib8y2 xmzvs34 x168biu4",children:i.jsx(c("MWEncryptedBackupsOTCEligibleDevicesList.react"),{})})}),a[0]=b):b=a[0];return b}g["default"]=a}),98);
__d("MWEncryptedBackupsThreadListPersistentBanner.react",["fbt","EncryptedBackupsSupportedPlatformUtils","MAWEncryptedBackupsRestoreDialog.entrypoint","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWEncryptedBackupsRetrieveQplLoggingAnnotations","MWJewelPopoverDialogContext.react","MWXLink.react","MWXText.react","QPLUserFlow","promiseDone","react","react-compiler-runtime","requireDeferred","useLabyrinthLogging","useMWXEntryPointDialog","useReStore","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));b=j;var l=b.useContext,m=b.useRef,n=c("requireDeferred")("mwEBCheckIfEBKeysExistInDisk").__setRef("MWEncryptedBackupsThreadListPersistentBanner.react");function a(a){var b=d("react-compiler-runtime").c(23),e=a.onDismissUpsell;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(a={},b[0]=a):a=b[0];a=c("useMWXEntryPointDialog")(c("MAWEncryptedBackupsRestoreDialog.entrypoint"),a);var f=a[0];a=d("EncryptedBackupsSupportedPlatformUtils").useMWEncryptedBackupsGetCurrentSupportedPlatform();var g=a!==d("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.FACEBOOK_DOT_COM;a=l(c("MWJewelPopoverDialogContext.react"));var j=a.setIsOpenForDialog,o=(i||(i=c("useReStore")))();a=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var p=a.startFlow,q=m(!1),r=g?c("MWChatEncryptedBackupsQPLSource.enum").INBOX_THREADLIST_PERSISTENT_BANNER:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_PERSISTENT_BANNER;b[1]!==o||b[2]!==r||b[3]!==p?(a=function(a){d("MWEncryptedBackupsRetrieveQplLoggingAnnotations").encryptedBackupsRetrieveQplLoggingAnnotations({db:o,onFetch:function(b){var e=b.ebsmWiped,f=b.firstUpsellTime,g=b.hasEbKeysLocally,h=b.hasEBSM,i=b.hasPDB,j=b.hasUserRestoredBefore;b=b.hasUserRestoredBeforeTemp;p({additionalAnnotations:{eb_session_identifier:f,ebsm_wiped:e,has_eb_keys_locally:g,has_ebsm:h,has_pdb:i,has_user_restored_before:j,has_user_restored_before_temp:b,restore_upsell_first_impression_time:f},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:r});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,a);q.current===!1&&(q.current=!0,c("promiseDone")(n.load(),function(a){return a(g)}))}})},b[1]=o,b[2]=r,b[3]=p,b[4]=a):a=b[4];var s=a;b[5]!==g||b[6]!==s?(a={onVisible:function(){s(g?"RESTORE_THREAD_LIST_PERSISTENT_BANNER_IMPRESSION_INBOX":"RESTORE_THREAD_LIST_PERSISTENT_BANNER_IMPRESSION")}},b[5]=g,b[6]=s,b[7]=a):a=b[7];a=c("useVisibilityObserver")(a);var t;b[8]===Symbol["for"]("react.memo_cache_sentinel")?(t={className:"xlhe6ec x1obq294 x5a5i1n xde0f50 x15x8krk x1xmf6yo x1e56ztr xyqm7xq x1ys307a x6ikm8r x10wlt62 xyamay9 x1l90r2v xf7dkkf xv54qhq"},b[8]=t):t=b[8];var u;b[9]===Symbol["for"]("react.memo_cache_sentinel")?(u=h._(/*BTDS*/"Missing chat history."),b[9]=u):u=b[9];var v;b[10]!==g||b[11]!==e||b[12]!==j||b[13]!==f||b[14]!==r||b[15]!==s?(v=function(){j(!0),s(g?"RESTORE_THREAD_LIST_PERSISTENT_BANNER_CTA_CLICKED_INBOX":"RESTORE_THREAD_LIST_PERSISTENT_BANNER_CTA_CLICKED"),f({onDismissUpsell:e,source:r})},b[10]=g,b[11]=e,b[12]=j,b[13]=f,b[14]=r,b[15]=s,b[16]=v):v=b[16];var w;b[17]===Symbol["for"]("react.memo_cache_sentinel")?(w=h._(/*BTDS*/"Restore now"),b[17]=w):w=b[17];b[18]!==v?(u=k.jsx(c("MWXText.react"),{color:"primary",type:"body4",children:k.jsxs(k.Fragment,{children:[u," ",k.jsx(c("MWXText.react"),{color:"blueLink",type:"bodyLink4",children:k.jsx(c("MWXLink.react"),{onClick:v,target:"_blank",testid:void 0,children:w})})]})}),b[18]=v,b[19]=u):u=b[19];b[20]!==a||b[21]!==u?(w=k.jsx("div",babelHelpers["extends"]({},t,{ref:a,children:u})),b[20]=a,b[21]=u,b[22]=w):w=b[22];return w}g["default"]=a}),226);
__d("MWEncryptedBackupsThreadListRestoreQPWrapper_query.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MWEncryptedBackupsThreadListRestoreQPWrapper_query",selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"MWEncryptedBackupsThreadListRestoreQPWrapper_viewer"}],storageKey:null}],type:"Query",abstractKey:null};e.exports=a}),null);
__d("MWEncryptedBackupsThreadListRestoreQPWrapper_viewer.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MWEncryptedBackupsThreadListRestoreQPWrapper_viewer",selections:[{args:null,kind:"FragmentSpread",name:"MWEBRestoreQPWithPin_viewer"}],type:"Viewer",abstractKey:null};e.exports=a}),null);
__d("MWEncryptedBackupsVerifyDeviceNux.react",["fbt","EncryptedBackupsSupportedPlatformUtils","MAWEncryptedBackupsRestoreDialog.entrypoint","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWEBVestaUserInfoContext.react","MWEBVirtualDevicesContext.react","MWEncryptedBackupsRetrieveQplLoggingAnnotations","MWJewelPopoverDialogContext.react","MWXQPCard.react","QPLUserFlow","getMWEBRestoreQPCautionCircleProperties","promiseDone","react","react-compiler-runtime","requireDeferred","useLabyrinthLogging","useMWXEntryPointDialog","useReStore","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||(j=d("react"));b=j;var l=b.useContext,m=b.useRef,n=c("requireDeferred")("mwEBCheckIfEBKeysExistInDisk").__setRef("MWEncryptedBackupsVerifyDeviceNux.react");function a(a){var b=d("react-compiler-runtime").c(46),e=a.children,f=a.currentSupportedPlatform,g=a.setClosed,j=a.setDismissed;a=d("MWEBVestaUserInfoContext.react").useMWEBIsCooldownOrLockOutState();var o;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(o={},b[0]=o):o=b[0];o=c("useMWXEntryPointDialog")(c("MAWEncryptedBackupsRestoreDialog.entrypoint"),o);var p=o[0],q=(i||(i=c("useReStore")))(),r=f!==d("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.FACEBOOK_DOT_COM,s=r?c("MWChatEncryptedBackupsQPLSource.enum").INBOX_THREADLIST_QP:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_THREADLIST_QP;o=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var t=o.startFlow,u=m(!1);f=l(c("MWJewelPopoverDialogContext.react"));var v=f.setIsOpenForDialog;o=d("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices();f=o.virtualDeviceInfo;var w=f.vestaClientID!=null;o=f.offlineDevicesCount>0;var x=f.doesUserHaveOtcEligibleDevices;f=!w&&x;var y;b[1]!==q||b[2]!==x||b[3]!==w||b[4]!==s||b[5]!==t?(y=function(a){d("MWEncryptedBackupsRetrieveQplLoggingAnnotations").encryptedBackupsRetrieveQplLoggingAnnotations({db:q,onFetch:function(b){var e=b.ebsmWiped,f=b.firstUpsellTime,g=b.hasEbKeysLocally,h=b.hasEBSM,i=b.hasPDB,j=b.hasUserRestoredBefore;b=b.hasUserRestoredBeforeTemp;t({additionalAnnotations:{eb_session_identifier:f,ebsm_wiped:e,has_eb_keys_locally:g,has_ebsm:h,has_pdb:i,has_user_restored_before:j,has_user_restored_before_temp:b,is_otc_eligible:x.toString(),is_pin_set:w.toString(),restore_upsell_first_impression_time:f},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:s});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,a);u.current===!1&&(u.current=!0,c("promiseDone")(n.load(),function(a){return a(g)}))}})},b[1]=q,b[2]=x,b[3]=w,b[4]=s,b[5]=t,b[6]=y):y=b[6];var z=y;b[7]!==r||b[8]!==z?(y={onVisible:function(){var a=r?"VERIFY_DEVICE_INBOX_QP_THREAD_LIST_IMPRESSION":"VERIFY_DEVICE_QP_THREAD_LIST_IMPRESSION";z(a)}},b[7]=r,b[8]=z,b[9]=y):y=b[9];y=c("useVisibilityObserver")(y);var A;b[10]!==r||b[11]!==g||b[12]!==v||b[13]!==z?(A=function(){var a=r?"USER_CLICKED_INBOX_THREAD_LIST_VERIFY_DEVICE":"USER_CLICKED_FB_THREAD_LIST_VERIFY_DEVICE";z(a);v(!0);g()},b[10]=r,b[11]=g,b[12]=v,b[13]=z,b[14]=A):A=b[14];var B=A,C;b[15]!==r||b[16]!==g||b[17]!==j||b[18]!==z?(A=function(){var a=r?"USER_CLOSED_INBOX_THREAD_LIST_VERIFY_DEVICE_NUX":"USER_CLOSED_FB_THREAD_LIST_VERIFY_DEVICE_NUX";z(a);d("MWChatEncryptedBackupsLogging").cancelFlow({cancelEndPoint:"thread_list_nux",event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent});C()},C=function(){j(),g()},b[15]=r,b[16]=g,b[17]=j,b[18]=z,b[19]=A,b[20]=C):(A=b[19],C=b[20]);if(!w&&!o&&!x)return e;b[21]===Symbol["for"]("react.memo_cache_sentinel")?(o=h._(/*BTDS*/"Chat history is missing"),b[21]=o):o=b[21];e=o;b[22]!==x||b[23]!==a||b[24]!==w||b[25]!==f?(o=a&&x?h._(/*BTDS*/"Restore now"):w?h._(/*BTDS*/"Enter PIN"):f?h._(/*BTDS*/"Restore now"):h._(/*BTDS*/"Enter 40-character code"),b[22]=x,b[23]=a,b[24]=w,b[25]=f,b[26]=o):o=b[26];var D;b[27]!==C||b[28]!==B||b[29]!==s||b[30]!==p?(D=function(){B(),p({onDismissUpsell:C,source:s})},b[27]=C,b[28]=B,b[29]=s,b[30]=p,b[31]=D):D=b[31];var E;b[32]!==o||b[33]!==D?(E={label:o,onPress:D,testid:"mw-encrypted-backups-in-thread-verify-device-nux-verify-now-button"},b[32]=o,b[33]=D,b[34]=E):E=b[34];b[35]!==x||b[36]!==a||b[37]!==w||b[38]!==f?(o=a&&x?h._(/*BTDS*/"Send a one-time code to restore your chat history"):w?h._(/*BTDS*/"Enter your PIN to see messages that aren't loaded on this device."):f?h._(/*BTDS*/"Send a one-time code to restore your chat history"):h._(/*BTDS*/"Enter your 40-character code to see messages that aren't loaded on this device."),b[35]=x,b[36]=a,b[37]=w,b[38]=f,b[39]=o):o=b[39];b[40]===Symbol["for"]("react.memo_cache_sentinel")?(D={props:{src:c("getMWEBRestoreQPCautionCircleProperties")()},type:"image"},b[40]=D):D=b[40];b[41]!==A||b[42]!==y||b[43]!==E||b[44]!==o?(a=k.jsx(c("MWXQPCard.react"),{addOnPrimary:E,body:o,headline:e,icon:D,onClose:A,ref:y}),b[41]=A,b[42]=y,b[43]=E,b[44]=o,b[45]=a):a=b[45];return a}g["default"]=a}),226);
__d("MWEncryptedBackupsThreadListRestoreQPWrapper.react",["CometRelay","EncryptedBackupsSupportedPlatformUtils","MWEBEntrypointsKillswitch.enum","MWEBRestoreQPWithPin.react","MWEBVestaUserInfoContext.react","MWEBVirtualDevicesContext.react","MWEncryptedBackupsDeferLocalStorageUpsell","MWEncryptedBackupsThreadListPersistentBanner.react","MWEncryptedBackupsThreadListQPWrapper.react","MWEncryptedBackupsThreadListRestoreQPWrapper_query.graphql","MWEncryptedBackupsThreadListRestoreQPWrapper_viewer.graphql","MWEncryptedBackupsVerifyDeviceNux.react","react","react-compiler-runtime","useHasRestoreInterstitialSoftblockBeenDismissed","useMWEBBackupState","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=k||d("react");function m(a){var e=d("react-compiler-runtime").c(32),f=a.backupState,g=a.children,i=a.currentSupportedPlatform,k=a.fragmentKey,m=a.setHasDismissedQp,n=a.setHasDismissedQpWithPin;a=d("CometRelay").useFragment(h!==void 0?h:h=b("MWEncryptedBackupsThreadListRestoreQPWrapper_viewer.graphql"),k);var o=(j||(j=c("useReStore")))();k=d("MWEBVirtualDevicesContext.react").useMWEBVirtualDevices();k=k.virtualDeviceInfo;var p=i===d("EncryptedBackupsSupportedPlatformUtils").EncryptedBackupsSupportedPlatform.FACEBOOK_DOT_COM,q=k.doesUserHaveOtcEligibleDevices,r=d("MWEBVestaUserInfoContext.react").useMWEBIsCooldownOrLockOutState(),s;e[0]!==f||e[1]!==r?(s={backupState:f,isCooldownOrLockOutState:r},e[0]=f,e[1]=r,e[2]=s):s=e[2];f=c("useHasRestoreInterstitialSoftblockBeenDismissed")(s);if(!q&&r&&f)return null;else if(r&&f){e[3]!==m?(s=function(){m(!0)},e[3]=m,e[4]=s):s=e[4];e[5]!==o?(q=function(){return d("MWEncryptedBackupsDeferLocalStorageUpsell").updateUpsellEntry({db:o,upsellType:d("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.QP_JEWEL})},e[5]=o,e[6]=q):q=e[6];e[7]!==g||e[8]!==i||e[9]!==s||e[10]!==q?(r=l.jsx(c("MWEncryptedBackupsVerifyDeviceNux.react"),{children:g,currentSupportedPlatform:i,setClosed:s,setDismissed:q}),e[7]=g,e[8]=i,e[9]=s,e[10]=q,e[11]=r):r=e[11];return r}else if(p&&k.vestaClientID!=null&&c("MWEBRestoreQPWithPin.react")){e[12]!==n?(f=function(){n(!0)},e[12]=n,e[13]=f):f=e[13];e[14]!==o?(s=function(){return d("MWEncryptedBackupsDeferLocalStorageUpsell").updateUpsellEntry({db:o,upsellType:d("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.QP_WITH_PIN_JEWEL})},e[14]=o,e[15]=s):s=e[15];e[16]!==i||e[17]!==a||e[18]!==f||e[19]!==s||e[20]!==k.doesUserHaveOtcEligibleDevices||e[21]!==k.vestaClientID?(q=l.jsx(c("MWEBRestoreQPWithPin.react"),{clientID:k.vestaClientID,currentSupportedPlatform:i,doesUserHaveOtcEligibleDevices:k.doesUserHaveOtcEligibleDevices,fragmentKey:a,setClosed:f,setDismissed:s}),e[16]=i,e[17]=a,e[18]=f,e[19]=s,e[20]=k.doesUserHaveOtcEligibleDevices,e[21]=k.vestaClientID,e[22]=q):q=e[22];return q}else{e[23]!==m?(r=function(){m(!0)},e[23]=m,e[24]=r):r=e[24];e[25]!==o?(p=function(){return d("MWEncryptedBackupsDeferLocalStorageUpsell").updateUpsellEntry({db:o,upsellType:d("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.QP_JEWEL})},e[25]=o,e[26]=p):p=e[26];e[27]!==g||e[28]!==i||e[29]!==r||e[30]!==p?(a=l.jsx(c("MWEncryptedBackupsVerifyDeviceNux.react"),{children:g,currentSupportedPlatform:i,setClosed:r,setDismissed:p}),e[27]=g,e[28]=i,e[29]=r,e[30]=p,e[31]=a):a=e[31];return a}}function a(a){var e=d("react-compiler-runtime").c(12),f=a.children,g=a.currentSupportedPlatform,h=a.fragmentKey,k=a.hasDismissedQps,n=a.setHasDismissedBanner,o=a.setHasDismissedQp,p=a.setHasDismissedQpWithPin;a=a.trigger;h=d("CometRelay").useFragment(i!==void 0?i:i=b("MWEncryptedBackupsThreadListRestoreQPWrapper_query.graphql"),h);var q=(j||(j=c("useReStore")))(),r;e[0]===Symbol["for"]("react.memo_cache_sentinel")?(r={entrypoint:c("MWEBEntrypointsKillswitch.enum").INBOX_THREADLIST},e[0]=r):r=e[0];r=c("useMWEBBackupState")(r);var s;e[1]!==r||e[2]!==f||e[3]!==g||e[4]!==(h==null?void 0:h.viewer)||e[5]!==q||e[6]!==k||e[7]!==n||e[8]!==o||e[9]!==p||e[10]!==a?(s=k?l.jsx(d("MWEncryptedBackupsThreadListQPWrapper.react").MWEncryptedBackupsThreadListQPWrapper,{trigger:a,children:l.jsx(c("MWEncryptedBackupsThreadListPersistentBanner.react"),{onDismissUpsell:function(){n(!0),d("MWEncryptedBackupsDeferLocalStorageUpsell").updateUpsellEntry({db:q,upsellType:d("MWEncryptedBackupsDeferLocalStorageUpsell").MWEncryptedBackupsDeferableUpsellType.PERSISTENT_BANNER_JEWEL})}})}):l.jsx(d("MWEncryptedBackupsThreadListQPWrapper.react").MWEncryptedBackupsThreadListQPWrapper,{trigger:a,children:l.jsx(m,{backupState:r,children:f,currentSupportedPlatform:g,fragmentKey:h==null?void 0:h.viewer,setHasDismissedQp:o,setHasDismissedQpWithPin:p})}),e[1]=r,e[2]=f,e[3]=g,e[4]=h==null?void 0:h.viewer,e[5]=q,e[6]=k,e[7]=n,e[8]=o,e[9]=p,e[10]=a,e[11]=s):s=e[11];return s}g["default"]=a}),98);
__d("MWXIconMenuItemFriends",["MWXSvgIcon","SVGIcon","cr:22687","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:22687")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWFamilyCenterSuppervisionMenuItem.react",["fbt","MWXIconMenuItemFriends","MWXMenuItem.react","XMessengerFamilyCenterHomeControllerRouteBuilder","gkx","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(){var a=d("react-compiler-runtime").c(2),b=c("gkx")("6418");a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=b?h._(/*BTDS*/"Family Centre"):h._(/*BTDS*/"Supervision"),a[0]=b):b=a[0];b=b;if(a[1]===Symbol["for"]("react.memo_cache_sentinel")){var e;e=j.jsx(c("MWXMenuItem.react"),{href:(e=c("XMessengerFamilyCenterHomeControllerRouteBuilder").buildUri({}).setSubDomain("familycenter"))==null?void 0:e.toString(),icon:c("MWXIconMenuItemFriends"),primaryText:b,target:"_blank",testid:void 0});a[1]=e}else e=a[1];return e}g["default"]=a}),226);
__d("MWInboxAccessibilitySettingsDialogQuery$Parameters",["MWInboxAccessibilitySettingsDialogQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("MWInboxAccessibilitySettingsDialogQuery_facebookRelayOperation"),metadata:{},name:"MWInboxAccessibilitySettingsDialogQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("MWInboxAccessibilitySettingsDialog.entrypoint",["JSResourceForInteraction","MWInboxAccessibilitySettingsDialogQuery$Parameters"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(){return{queries:{queryReference:{parameters:c("MWInboxAccessibilitySettingsDialogQuery$Parameters"),variables:{}}}}},root:c("JSResourceForInteraction")("MWInboxAccessibilitySettingsDialog.react").__setRef("MWInboxAccessibilitySettingsDialog.entrypoint")};g["default"]=a}),98);
__d("MWInboxInfoFRXOverflowMenu.react",["fbt","MWPBumpEntityKey","MWXIconMenuItemAppFacebook","MWXIconMenuItemShieldStar","MWXMenu.react","MWXMenuItem.react","emptyFunction","react","react-compiler-runtime","useMWInboxInfoFRX"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){var b=d("react-compiler-runtime").c(20),e=a.onClose;a=a.thread;var f;b[0]!==a?(f={entryPoint:"groups_report_to_admin",messagingEntrypoint:"thread_details",onPress:c("emptyFunction"),thread:a},b[0]=a,b[1]=f):f=b[1];var g=c("useMWInboxInfoFRX")(f);b[2]!==a?(f={entryPoint:"report_button",messagingEntrypoint:"thread_details",onPress:c("emptyFunction"),thread:a},b[2]=a,b[3]=f):f=b[3];var i=c("useMWInboxInfoFRX")(f);b[4]===Symbol["for"]("react.memo_cache_sentinel")?(a=h._(/*BTDS*/"Menu for reporting issues to admins or Facebook"),b[4]=a):a=b[4];b[5]!==e||b[6]!==g?(f=function(a){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.infobar","privacy_support_section_something_wrong"),g(),e==null||e(a)},b[5]=e,b[6]=g,b[7]=f):f=b[7];var k;b[8]===Symbol["for"]("react.memo_cache_sentinel")?(k=h._(/*BTDS*/"Report to admins"),b[8]=k):k=b[8];b[9]!==f?(k=j.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemShieldStar"),onClick:f,primaryText:k}),b[9]=f,b[10]=k):k=b[10];b[11]!==e||b[12]!==i?(f=function(a){d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.infobar","privacy_support_section_something_wrong"),i(),e==null||e(a)},b[11]=e,b[12]=i,b[13]=f):f=b[13];var l;b[14]===Symbol["for"]("react.memo_cache_sentinel")?(l=h._(/*BTDS*/"Report to Facebook"),b[14]=l):l=b[14];b[15]!==f?(l=j.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemAppFacebook"),onClick:f,primaryText:l}),b[15]=f,b[16]=l):l=b[16];b[17]!==k||b[18]!==l?(f=j.jsxs(c("MWXMenu.react"),{"aria-label":a,withArrow:!0,children:[k,l]}),b[17]=k,b[18]=l,b[19]=f):f=b[19];return f}g["default"]=a}),226);
__d("MWInboxMediaGalleryEBRestoreSyncBanner.react",["fbt","MWXCard.react","MWXRow.react","MWXRowItem.react","MWXSpinner.react","MWXText.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k={files:"files",links:"links",media:"media"};function a(a){var b=d("react-compiler-runtime").c(3);a=a.contentType;var e;b[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=j.jsx(c("MWXRowItem.react"),{children:j.jsx(c("MWXSpinner.react"),{color:"blue",size:20})}),b[0]=e):e=b[0];b[1]!==a?(e=j.jsx(c("MWXCard.react"),{background:"card-flat",children:j.jsxs(c("MWXRow.react"),{align:"center",paddingHorizontal:12,paddingVertical:12,verticalAlign:"center",children:[e,j.jsx(c("MWXRowItem.react"),{children:j.jsx(c("MWXText.react"),{align:"center",color:"primary",type:"body4",children:h._(/*BTDS*/"_j{\"media\":\"Syncing media...\",\"files\":\"Syncing files...\",\"links\":\"Syncing links...\"}",[h._enum(k[a],{media:"media",files:"files",links:"links"})])})})]})}),b[1]=a,b[2]=e):e=b[2];return e}g["default"]=a}),226);
__d("MWInboxMediaGalleryEBRestoreUpsell.react",["fbt","MWChatEncryptedBackupsQPLSource.enum","MWEBRestoreUpsellTrigger.react","MWXCard.react","MWXLink.react","MWXText.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k={files:"files may be",links:"links may be",media:"media may be"};function a(a){var b=d("react-compiler-runtime").c(2),e=a.contentType;b[0]!==e?(a=j.jsx(c("MWEBRestoreUpsellTrigger.react"),{markerPrefix:"MEDIA_GALLERY_RESTORE",qplSource:c("MWChatEncryptedBackupsQPLSource.enum").MEDIA_GALLERY_RESTORE,children:function(a,b){return j.jsx(c("MWXCard.react"),{background:"card-flat",children:j.jsx("div",{className:"xyamay9 x1l90r2v x1g0dm76 xpdmqnj",ref:b,children:j.jsxs(c("MWXText.react"),{align:"center",color:"primary",type:"body4",children:[h._(/*BTDS*/"_j{\"files may be\":\"Some files may be missing.\",\"links may be\":\"Some links may be missing.\",\"media may be\":\"Some media may be missing.\"}",[h._enum(k[e],{"files may be":"files may be","links may be":"links may be","media may be":"media may be"})])," ",j.jsx(c("MWXText.react"),{color:"blueLink",type:"bodyLink4",children:j.jsx(c("MWXLink.react"),{onClick:a,children:h._(/*BTDS*/"Restore now")})})]})})})}}),b[0]=e,b[1]=a):a=b[1];return a}g["default"]=a}),226);
__d("MessengerClientEventMinorSurface",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({MUSIC_PLAYER:"music_player",LYRICS_SELECTOR:"lyrics_selector",CHANNELS_FOLDER_SUGGESTED_BROADCAST_CHANNELS_SECTION:"channels_folder_suggested_broadcast_channels_section",CHANNELS_FOLDER_SUGGESTED_BROADCAST_CHANNELS_SEE_MORE_LIST:"channels_folder_suggested_broadcast_channels_see_more_list",COMMUNITIES_ALL_COMMUNITIES_LIST_VIEW:"communities_all_communities_list_view",COMMUNITIES_CHANNEL_LIST_VIEW:"communities_channel_list_view",COMMUNITIES_CHAT_PREVIEW:"communities_chat_preview",COMMUNITIES_COMMUNITY_PREVIEW:"communities_community_preview",COMMUNITIES_MAIN_VIEW_CONNECTED_COMMUNITIES_SECTION:"communities_main_view_connected_communities_section",COMMUNITIES_MAIN_VIEW_CONNECTED_CHANNELS_SECTION:"communities_main_view_connected_channels_section",COMMUNITIES_MAIN_VIEW_TO_REVIEW_SECTION:"communities_main_view_to_review_section",COMMUNITIES_MAIN_VIEW_UNCONNECTED_COMMUNITIES_SECTION:"communities_main_view_unconnected_communities_section",COMMUNITIES_TO_REVIEW_LIST_VIEW:"communities_to_review_list_view",CONTEXT_MENU:"context_menu",NOTE_CREATION_SETTINGS:"note_creation_settings",HIGHLIGHTS_FEED:"highlights_feed",ACTIVITY_LIST:"activity_list",HIGHLIGHTS_TAB_FOOTER:"highlights_tab_footer",HIGHLIGHTS_TAB_IMMERSIVE_VIEW:"highlights_tab_immersive_view",HIGHLIGHTS_TAB_NUX:"highlights_tab_nux",HIGHLIGHTS_TAB_TRAY:"highlights_tab_tray",HIGHLIGHTS_TRAY:"highlights_tray",HOLIDAY_CARD_EDITOR:"holiday_card_editor",IMMERSIVE_PROFILE_SELF_VIEW:"immersive_profile_self_view",JEWEL_FOCUS_VIEW:"jewel_focus_view",LEFT_DRAWER_DISCOVER_CHANNELS_LIST:"left_drawer_discover_channels_list",LEFT_NAV:"left_nav",MAIN_VIEW:"main_view",MEDIA_VIEW:"media_view",MSGR_TAB:"msgr_tab",PREVIEW_PROFILE_PICTURE:"preview_profile_picture",PYMK_VIEW:"pymk_view",PYMK_FULL_PAGE:"pymk_full_page",THREAD_VIEW:"thread_view",NEW_FRIENDS_FOLDER:"new_friends_folder",SEE_NEW_FRIENDS_PROMPT:"see_new_friends_prompt",INBOX_BANNER:"inbox_banner",INBOX_COMMUNITIES:"inbox_communities",INBOX_COMMUNITIES_LONG_PRESS_PAGE:"inbox_communities_long_press_page",INBOX_MESSAGES:"inbox_messages",INBOX_MESSAGES_BULK_ACTION_PAGE:"inbox_messages_bulk_action_page",INBOX_TRAY:"inbox_tray",INBOX_TRAY_ACTIVE_NOW_LONG_PRESS_PAGE:"inbox_tray_active_now_long_press_page",INBOX_TREP:"inbox_trep",INBOX_FILTER_ALL:"inbox_filter_all",INBOX_FILTER_UNREAD:"inbox_filter_unread",INBOX_FILTER_GROUPS:"inbox_filter_groups",INBOX_FILTER_OUTBOUND:"inbox_filter_outbound",INBOX_FILTER_MARKETPLACE_UNRESPONDED:"inbox_filter_marketplace_unresponded",INBOX_FILTER_MARKETPLACE_RESPONDED:"inbox_filter_marketplace_responded",INBOX_FILTER_MARKETPLACE_HIGHLY_RATED:"inbox_filter_marketplace_highly_rated",INBOX_FILTER_MARKETPLACE_VERY_RESPONSIVE:"inbox_filter_marketplace_very_responsive",LEFT_NAV_COMMUNITIES:"left_nav_communities",LEFT_NAV_STANDALONE_COMMUNITIES:"left_nav_standalone_communities",LEFT_NAV_FB_GROUPS:"left_nav_fb_groups",COMMUNITIES_GROUPS_EDIT_SHEET:"communities_groups_edit_sheet",FIND_CONTACTS_PAGE:"find_contacts_page",CONTACTS_ACCESS_PROMPT:"contacts_access_prompt",STORY_COMPOSER_RMC_CAROUSEL:"story_composer_rmc_carousel",STORY_COMPOSER_CREATION_MODE:"story_composer_creation_mode",STORY_CREATION_CAMERA_VIEW:"story_creation_camera_view",READY_MADE_CONTENT_MIMICRY:"ready_made_content_mimicry",STORY_RING:"story_ring",STORY_CARD:"story_card",COMBINED_VIEWER:"combined_viewer",PROFILE:"profile",THREAD_LIST:"thread_list",ACTIONS_VIEW_STORY:"actions_view_story",PYMK_VIEW_INFO:"pymk_view_info",PYMK_CONTAINER:"pymk_container",CONTACTS_AND_PYMM_CONTAINER:"contacts_and_pymm_container",FIND_FRIENDS:"find_friends",PYMM_CONTAINER:"pymm_container",PYMM_VIEW:"pymm_view",START_CHAT_FILTER_ALL:"start_chat_filter_all",START_CHAT_FILTER_FRIENDS:"start_chat_filter_friends",START_CHAT_FILTER_SUUGESTED:"start_chat_filter_suggested",PYMK_CONTAINER_FRIENDS_TAB:"pymk_container_friends_tab",PYMK_CONTAINER_HIGHLGHTS_TAB:"pymk_container_highlights_tab",PYMK_CONTAINER_INBOX:"pymk_container_inbox",PYMK_CONTAINER_INBOX_ALL_COUNT:"pymk_container_inbox_all_count",PYMK_CONTAINER_JEWEL:"pymk_container_messenger_jewel",PYMK_CONTAINER_LEFT_NAV:"pymk_container_left_nav",PYMK_CONTAINER_SEARCH:"pymk_container_search",PYMK_CONTAINER_STORY_VIEWER:"pymk_container_story_viewer",FRIENDS_GROUP_MEMBERS_SECTION:"friends_group_members_section",GROUP_MEMBERS_RESPOND_SHEET:"group_members_respond_sheet",IMMERSIVE_PROFILE_VIEW_HEADER:"immersive_profile_view_header",IMMERSIVE_PROFILE_RESPOND_SHEET:"immersive_profile_respond_sheet",IMMERSIVE_PROFILE_UNFRIEND_RESPOND_SHEET:"immersive_profile_unfriend_respond_sheet",THREAD_VIEW_ADD_MEMBER_ADMIN_TEXT:"thread_view_add_member_admin_text",THREAD_VIEW_DETAILS_HEADER:"thread_view_details_header",THREAD_VIEW_DETAILS_UNFRIEND_RESPOND_SHEET:"thread_view_details_unfriend_respond_sheet",THREAD_VIEW_HEADER:"thread_view_header",THREAD_VIEW_TITLE:"thread_view_title",THREAD_VIEW_RESPOND_SHEET:"thread_view_respond_sheet",THREAD_VIEW_UNFRIEND_RESPOND_SHEET:"thread_view_unfriend_respond_sheet",UNCONNECTED_GROUP_MEMBERS_SECTION:"unconnected_group_members_section",URL_PREVIEW:"url_preview",THREAD_VIEW_DETAILS_RESPOND_SHEET:"thread_view_details_respond_sheet",THREAD_VIEW_XMA_LINK:"thread_view_xma_link",THREAD_VIEW_XMA_REPLY:"thread_view_xma_reply",THREAD_VIEW_XMA_SHARE:"thread_view_xma_share",THREAD_VIEW_SENDER_TILE:"thread_view_sender_tile",THREAD_VIEW_BANNER:"thread_view_banner",IMMERSIVE_PROFILE_VIEW_ABOUT_SECTION:"immersive_profile_view_about_section",IMMERSIVE_PROFILE_VIEW_CHAT_ACTIONS_SECTION:"immersive_profile_view_chat_actions_section",IMMERSIVE_PROFILE_VIEW_COMMON_CHATS_SECTION:"immersive_profile_view_common_chats_section",IMMERSIVE_PROFILE_VIEW_MUTUAL_FRIENDS_SECTION:"immersive_profile_view_mutual_friends_section",IMMERSIVE_PROFILE_VIEW_PRIVACY_SECTION:"immersive_profile_view_privacy_section",FRIEND_REQUEST_PUSH_NOTIFICATION:"friend_request_push_notification",STORY_PUSH_NOTIFICATION:"story_push_notification",NIX_CONTACT_IMPORT_PUSH_NOTIFICATION:"nix_contact_import_push_notification",NIX_MESSAGE_PUSH_NOTIFICATION:"nix_message_push_notification",FRIEND_REQUESTS_CONTAINER:"friend_requests_container",FRIEND_REQUESTS_VIEW:"friend_requests_view",STORY_MUSIC_EDITOR:"story_music_editor",UNIVERSAL_SEARCH_NULL_STATE:"universal_search_null_state",UNIVERSAL_SEARCH_QUERY_STATE:"universal_search_query_state",NOTE_CREATION_HEADER:"note_creation_header",NOTE_CREATION_CENTER:"note_creation_center",MUSIC_SELECTOR:"music_selector",GAME_SELECTOR:"game_selector",COMBINED_VIEWER_HEADER:"combined_viewer_header",NOTE_CLICKABLE_CONTENT:"note_clickable_content",COMBINED_VIEWER_CONTENT:"combined_viewer_content",COMBINED_VIEWER_FOOTER:"combined_viewer_footer",PARTICIPATION_VIEWER:"participation_viewer",STORY_CREATION_HOMEBASE_HEADER:"story_creation_homebase_header",CONTENT_CREATION_ALBUM_LIST:"content_creation_album_list",STORY_CREATION_HOMEBASE_MODES:"story_creation_homebase_modes",STORY_CREATION_HOMEBASE_ALBUM_PHOTOS:"story_creation_homebase_album_photos",STORY_CREATION_COMPOSER_TOOLBAR:"story_creation_composer_toolbar",STORY_CREATION_COMPOSER_BRUSH_EDITOR:"story_creation_composer_brush_editor",STORY_CREATION_COMPOSER_TEXT_TOOL:"story_creation_composer_text_tool",STORY_CREATION_COMPOSER_STICKER_SELECTOR:"story_creation_composer_sticker_selector",STORY_CREATION_COMPOSER_SETTINGS:"story_creation_composer_settings",STORY_CREATION_COMPOSER_MUSIC_SELECTOR:"story_creation_composer_music_selector",STORY_CREATION_COMPOSER_VIDEO_TOOL:"story_creation_composer_video_tool",STORY_CREATION_COMPOSER_APP_SWITCH_DIALOG:"story_creation_composer_app_switch_dialog",STORY_CREATION_COMPOSER_FULL_APP_SWITCH_DIALOG:"story_creation_composer_full_app_switch_dialog",NA:"NA",QP:"qp",COMMUNITIES_IN_COMMON_SHEET:"communities_in_common_sheet",FRIENDS_IN_COMMON_SHEET:"friends_in_common_sheet",GROUPCHATS_IN_COMMON_SHEET:"groupchats_in_common_sheet",FRIENDS_IN_COMMON_SEE_ALL:"friends_in_common_see_all",SIDEBAR_ONE_ON_ONE_CHATS:"sidebar_one_on_one_chats",SIDEBAR_GROUP_CHATS:"sidebar_group_chats",SIDEBAR_COMMUNITY_CHATS:"sidebar_community_chats",SIDEBAR_BROADCAST_CHANNELS:"sidebar_broadcast_channels",GROUP_MEMBERS_FILTER_ALL:"group_members_filter_all",GROUP_MEMBERS_FILTER_ADMINS:"group_members_filter_admins",GROUP_MEMBERS_FILTER_HOSTS:"group_members_filter_hosts",READ_RECEIPT:"read_receipt",BIRTHDAY_SPARK_MESSAGE_COMPOSER:"birthday_spark_message_composer",BIRTHDAY_SPARK_CUSTOM_MESSAGES:"birthday_spark_custom_messages",JEWEL_FRIEND_REQUEST_RESPOND_SHEET:"jewel_friend_request_respond_sheet",PEOPLE_FILTER_ACTIVE:"people_filter_active",PEOPLE_FILTER_ALL:"people_filter_all",PEOPLE_FILTER_FRIEND_REQUESTS:"people_filter_friend_requests",PEOPLE_FILTER_CURRENT_CITY:"people_filter_current_city",PEOPLE_FILTER_SCHOOL:"people_filter_school",PEOPLE_FILTER_HOMETOWN:"people_filter_hometown",PEOPLE_FILTER_WORK:"people_filter_work",META_GALLERY_MID_CARD:"meta_gallery_mid_card",SEE_MORE:"see_more",ONLINE_NOW:"online_now"});c=a;f["default"]=c}),66);
__d("MessengerClientEventTargetType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({ASSET:"asset",BANNER:"banner",BUTTON:"button",BROADCAST_CHANNEL:"broadcast_channel",CAMERA:"camera",COMMUNITY:"community",EVENT:"event",FOLDER:"folder",GROUP:"group",JEWEL_NOTIFICATION:"jewel_notification",PUSH_NOTIFICATION:"push_notification",MESSAGE_THREAD:"message_thread",NOTE:"note",POLL:"poll",POST:"post",PROMPT:"prompt",PROMPT_RESPONSE:"prompt_response",STORY:"story",TAB:"tab",USER:"user",MUSIC:"music",STICKER:"sticker",AVATAR_STICKER:"avatar_sticker",EMOJI:"emoji",REEL:"reel",LINK:"link",PHOTO:"photo",VIDEO:"video",ALBUM:"album",GIF:"gif",GAME:"game",MOODS:"moods",LOCATION:"location",AI_GENERATED_STICKER:"ai_generated_sticker",ADD_YOURS:"add_yours",FACE_PILE:"face_pile",CONTEXT_MENU:"context_menu",PARTICIPATION_VIEWER:"participation_viewer",UPLOAD_STATUS:"upload_status",READY_MADE_CONTENT:"ready_made_content",INBOX_FILTER:"inbox_filter",THREAD_LIST_CONTAINER:"thread_list_container",MEDIA:"media",REELS_RECAP:"reels_recap",START_CHAT_FILTER:"start_chat_filter",AI_BOT:"ai_bot",RECAP_SETTING_PAGE:"recap_setting_page",PEOPLE_FILTER:"people_filter",INBOX_TRAY_BOTTOM_SHEET:"inbox_tray_bottom_sheet",LOCATION_STICKER:"location_sticker",TIME_STICKER:"time_sticker",DATE_STICKER:"date_sticker",BATTERY_STICKER:"battery_sticker",WEATHER_STICKER:"weather_sticker",USER_NOTE:"user_note",USER_STORY:"user_story",USER_NOTE_STORY:"user_note_story",FRIEND_REQUEST_VIEW:"friend_request_view",IMMERSIVE_PROFILE_VIEW:"immersive_profile_view",JEWEL_PAGE:"jewel_page",MSGR_SETTINGS_PAGE:"msgr_settings_page",INVITE_A_FRIEND_PAGE:"invite_a_friend_page",PYMK_VIEW:"pymk_view",STORY_COMPOSER_EDITOR_PAGE:"story_composer_editor",STORY_COMPOSER_HOMEBASE_PAGE:"story_composer_homebase_page",FB_GROUPS_CONTAINER:"fb_groups_container",INBOX_TRAY_CONTAINER:"inbox_tray_container",PYMK_CONTAINER:"pymk_container",REELS_CONTAINER:"reels_container",STANDALONE_COMMUNITIES_CONTAINER:"standalone_communities_container",FRIEND_REQUESTS_CONTAINER:"friend_requests_container",STORY_TRAY_CONTAINER:"story_tray_container",CHAT_WITH_FRIENDS_CONTAINER:"chat_with_friends_container",PARTICIPATION_VIEWER_CONTAINER:"participation_viewer_container",FRIENDS_LIST_CONTAINER:"friends_list_container",NON_FRIENDS_LIST_CONTAINER:"non_friends_list_container",INVITED_LIST_CONTAINER:"invited_group_members_container",ACTIVE_NOW_LIST_CONTAINER:"active_now_list_container",PYMM_CONTAINER:"pymm_container",COMMUNITIES_GROUPS_EDIT_SHEET:"communities_groups_edit_sheet",FRIEND_REQUEST_RESPONSE_SHEET:"friend_request_response_sheet",UNFRIEND_REQUEST_RESPONSE_SHEET:"unfriend_request_response_sheet",PYMK_VIEW_BOTTOM_SHEET:"pymk_view_bottom_sheet",COMMUNITIES_IN_COMMON_SHEET:"communities_in_common_sheet",FRIENDS_IN_COMMON_SHEET:"friends_in_common_sheet",GROUPCHATS_IN_COMMON_SHEET:"groupchats_in_common_sheet",OPEN_FB_POPUP:"open_fb_popup",UPDATE_FB_POPUP:"update_fb_popup",DOWNLOAD_FB_POPUP:"download_fb_popup",LOG_IN_POPUP:"log_in_popup",STORY_SHARED_POPUP:"story_shared_popup",USER_BIRTHDAY_SPARK:"user_birthday_spark"});c=a;f["default"]=c}),66);
__d("MessengerClientEventType",["$InternalEnum"],(function(a,b,c,d,e,f){a=b("$InternalEnum")({ONE_PX_IMPRESSION:"one_px_impression",VPVD_IMPRESSION:"vpvd_impression",SINGLE_CLICK:"single_click",LONG_PRESS:"long_press",SYSTEM:"system"});c=a;f["default"]=c}),66);
__d("MessengerSettingsActionFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("120");b=d("FalcoLoggerInternal").create("messenger_settings_action",a);e=b;g["default"]=e}),98);
__d("logMessengerSettingsFalcoEvent",["MessengerSettingsActionFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.majorSurface,d=a.minorSurface,e=d===void 0?"NA":d;d=a.target;var f=d===void 0?"button":d;d=a.eventType;var g=d===void 0?"single_click":d;c("MessengerSettingsActionFalcoEvent").log(function(){return{event_type:g,surface:{entry_point:void 0,major_surface:b,minor_surface:e},target:{type:f}}})}g["default"]=a}),98);
__d("useMWEditUsernameDialog",["JSResourceForInteraction","LSFactory","LSFetchAccountSyncedFieldsStoredProcedure","emptyFunction","promiseDone","react","react-compiler-runtime","useAsyncReStore","useMWXLazyDialog"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useEffect,j=b.useRef,k=c("JSResourceForInteraction")("MWEditUsernameDialog.react").__setRef("useMWEditUsernameDialog");function a(){var a=d("react-compiler-runtime").c(5),b=c("useAsyncReStore")(),e=c("useMWXLazyDialog")(k),f=e[0],g=j(!1),h;a[0]!==b?(e=function(){if(g.current===!0)return;g.current=!0;c("promiseDone")(b,l)},h=[b,g],a[0]=b,a[1]=e,a[2]=h):(e=a[1],h=a[2]);i(e,h);a[3]!==f?(e=function(a,b){f({entryPoint:b,initialUsername:a},c("emptyFunction"))},a[3]=f,a[4]=e):e=a[4];return e}function l(a){c("promiseDone")(a.runInTransaction(m,"readwrite",void 0,void 0,f.id+":44"))}function m(a){return c("LSFetchAccountSyncedFieldsStoredProcedure")(c("LSFactory")(a))}g["default"]=a}),98);
__d("MWInboxSettingEditUsernameMenuItem.react",["fbt","MWPActor.react","MWXIconMenuItemText","MWXMenuItem.react","ReQL","ReQLSuspense","logMessengerSettingsFalcoEvent","react","react-compiler-runtime","useMWEditUsernameDialog","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=i||c("react");function a(){var a=d("react-compiler-runtime").c(12),b=(j||(j=c("useReStore")))(),e=d("MWPActor.react").useActor(),g;a[0]!==e||a[1]!==b.tables.contacts?(g=function(){return d("ReQL").fromTableAscending(b.tables.contacts).getKeyRange(e)},a[0]=e,a[1]=b.tables.contacts,a[2]=g):g=a[2];var i;a[3]!==e||a[4]!==b?(i=[b,e],a[3]=e,a[4]=b,a[5]=i):i=a[5];var l=d("ReQLSuspense").useFirst(g,i,f.id+":29"),m=c("useMWEditUsernameDialog")();if(l==null)return null;a[6]!==l.username||a[7]!==m?(g=function(){c("logMessengerSettingsFalcoEvent")({majorSurface:"msgr_settings"}),m(l.username,"msgr_settings")},a[6]=l.username,a[7]=m,a[8]=g):g=a[8];a[9]===Symbol["for"]("react.memo_cache_sentinel")?(i=h._(/*BTDS*/"Edit username"),a[9]=i):i=a[9];a[10]!==g?(i=k.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemText"),onClick:g,primaryText:i}),a[10]=g,a[11]=i):i=a[11];return i}g["default"]=a}),226);
__d("useCometHomeChatSettingsQuery$Parameters",["useCometHomeChatSettingsQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("useCometHomeChatSettingsQuery_facebookRelayOperation"),metadata:{},name:"useCometHomeChatSettingsQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("MWInboxSettingsDialog.entrypoint",["JSResourceForInteraction","useCometHomeChatSettingsQuery$Parameters"],(function(a,b,c,d,e,f,g){"use strict";a={getPreloadProps:function(){return{queries:{chatSettingsQueryReference:{parameters:b("useCometHomeChatSettingsQuery$Parameters"),variables:{}}}}},root:c("JSResourceForInteraction")("MWInboxSettingsDialogEntrypoint.react").__setRef("MWInboxSettingsDialog.entrypoint")};g["default"]=a}),98);
__d("MWXIconMenuItemAccessibility",["MWXSvgIcon","SVGIcon","cr:22530","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:22530")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMenuItemDownload",["MWXSvgIcon","SVGIcon","cr:22648","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:22648")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMenuItemInfoCircle",["MWXSvgIcon","SVGIcon","cr:22708","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:22708")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMenuItemMessageDots",["MWXSvgIcon","SVGIcon","cr:22733","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:22733")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMenuItemQuestionCircle",["MWXSvgIcon","SVGIcon","cr:22784","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:22784")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMenuItemSettings",["MWXSvgIcon","SVGIcon","cr:22808","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:22808")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWXIconMenuItemTextAlignLeft",["MWXSvgIcon","SVGIcon","cr:22835","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgMenuItemIcon(d("SVGIcon").svgIcon(b("cr:22835")),c("gkx")("23219"));g["default"]=a}),98);
__d("VenusFlytrapLoggingEntrypoint",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum")({OMNI_PRESENT_BUGNUB:"omni_present_bugnub",TOP_NAVIGATION_SETTINGS:"top_navigation_settings",KEYBOARD_SHORTCUT:"keyboard_shortcut",FACEBOOK_COMPOSER:"facebook_composer",INTERNAL_REACT_ERROR_DIALOG:"internal_react_error_dialog"});c=a;f["default"]=c}),66);
__d("MWInboxSettingsMenu.react",["fbt","CurrentEnvironment","CurrentUser","FDSMenuSeparator.react","FDSSeparatorMenuItem.react","I64","JSResourceForInteraction","LSDataUseConsentState","LSIntEnum","MWChatSidebarSettingsPrivacyMenu.react","MWFacebookUserWithoutMessengerAccess","MWInboxAccessibilitySettingsDialog.entrypoint","MWInboxRestrictedAccountsRouteBuilder","MWInboxSettingEditUsernameMenuItem.react","MWInboxSettingsDialog.entrypoint","MWPBumpEntityKey","MWSeparatorContainer.react","MWXIconMenuItemAccessibility","MWXIconMenuItemBox","MWXIconMenuItemCautionTriangle","MWXIconMenuItemDownload","MWXIconMenuItemInfoCircle","MWXIconMenuItemLeave","MWXIconMenuItemMessageCross","MWXIconMenuItemMessageDots","MWXIconMenuItemQuestionCircle","MWXIconMenuItemSettings","MWXIconMenuItemTextAlignLeft","MWXMenu.react","MWXMenuItem.react","MessageRequestsLog","MessengerMSplitFlag","MetaConfig","ODS","Promise","ReQL","ReQLSuspense","VenusFlytrapLogging","VenusFlytrapLoggingEntrypoint","XMessengerHelpCenterHomeControllerRouteBuilder","cr:4007","cr:4021","cr:494","cr:7484","gkx","openMessengerLogOut","promiseDone","qex","react","useMWXEntryPointDialog","useMWXLazyDialog","useMessengerVenusFlytrapDialog","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l,m,n,o,p=o||d("react");function a(a){return q}function q(){return(n||(n=b("Promise"))).resolve()}var r=(i=b("cr:494"))!=null?i:a;function e(a){a.onClose;var e=a.showHidden,g=a.showMessageRequests,i=a.showRestrictedAccounts,n=(j||(j=c("useReStore")))();a=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(n.tables.epd_cookie_settings)},[n],f.id+":88");var o=c("MetaConfig")._("37"),q=c("useMWXEntryPointDialog")(c("MWInboxSettingsDialog.entrypoint"),{}),s=q[0];q=c("useMWXEntryPointDialog")(c("MWInboxAccessibilitySettingsDialog.entrypoint"),{});var t=q[0],u=c("useMessengerVenusFlytrapDialog")();q=c("useMWXLazyDialog")(c("JSResourceForInteraction")("MWInboxBugReportDialog.react").__setRef("MWInboxSettingsMenu.react"));var v=q[0];q=p.jsx(c("MWXMenuItem.react"),{href:"https://www.facebook.com/help/cookies",icon:c("MWXIconMenuItemTextAlignLeft"),onClick:function(){return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","cookie_policy")},primaryText:h._(/*BTDS*/"Cookie Policy"),target:"_blank",testid:void 0});var w=c("gkx")("24080"),x=p.jsx(c("MWXMenuItem.react"),{href:"https://accountscenter.facebook.com/info_and_permissions/cookie_settings",icon:c("MWXIconMenuItemSettings"),primaryText:h._(/*BTDS*/"Cookie settings"),target:"_blank",testid:void 0});w=w&&a!=null&&!(k||(k=d("I64"))).equal(a.fbTrackersOnOtherCompanies,(l||(l=d("LSIntEnum"))).ofNumber(c("LSDataUseConsentState").UNSET))&&!(k||(k=d("I64"))).equal(a.otherCompanyTrackersOnFoa,(l||(l=d("LSIntEnum"))).ofNumber(c("LSDataUseConsentState").UNSET))&&!c("MessengerMSplitFlag").is_msplit_account?x:q;var y=r(!0);o?a=p.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemLeave"),onClick:function(){c("promiseDone")(y().then(function(){return c("openMessengerLogOut")()}));return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","logout")},primaryText:h._(/*BTDS*/"Log Out"),testid:void 0}):a=null;x=d("MWFacebookUserWithoutMessengerAccess").useIsFacebookUserWithoutMessengerAccess();q=p.jsx(c("MWXMenuItem.react"),{href:o?d("MWInboxRestrictedAccountsRouteBuilder").buildURLWithoutThread():void 0,icon:c("MWXIconMenuItemMessageCross"),onClick:function(){o||i();return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","show_restricted_accounts")},primaryText:h._(/*BTDS*/"Restricted accounts"),testid:void 0});var z=d("CurrentUser").isMessengerOnlyUser()||d("CurrentUser").isDeactivatedAllowedOnMessenger()?p.jsx(c("MWXMenuItem.react"),{href:"https://www.messenger.com/dyi",icon:c("MWXIconMenuItemDownload"),primaryText:h._(/*BTDS*/"Download your information"),target:"_blank"}):null,A=b("cr:4007")==null?void 0:b("cr:4007")();return p.jsxs(c("MWXMenu.react"),{"aria-label":h._(/*BTDS*/"Inbox settings menu"),testid:void 0,truncate:!0,withArrow:!0,children:[b("cr:4021")&&A!=null&&A>0?p.jsx(b("cr:4021"),{value:A}):null,A!=null&&A>0?p.jsx(c("FDSSeparatorMenuItem.react"),{}):null,p.jsxs(c("MWSeparatorContainer.react"),{separator:p.jsx(c("FDSMenuSeparator.react"),{}),children:[p.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemSettings"),onClick:function(){s({},function(){});return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","preferences")},primaryText:h._(/*BTDS*/"Preferences"),testid:void 0}),o&&c("gkx")("772")?p.jsx(c("MWInboxSettingEditUsernameMenuItem.react"),{}):null,o?q:p.jsxs("div",{children:[!c("gkx")("17132")&&p.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemMessageDots"),onClick:function(){d("MessageRequestsLog").logMessageRequestsView(0,-1);d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","message_requests");return g()},primaryText:c("qex")._("4751")?h._(/*BTDS*/"Spam"):h._(/*BTDS*/"Message requests"),testid:void 0}),p.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemBox"),onClick:function(){e();return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","report_problem")},primaryText:h._(/*BTDS*/"Archived chats"),testid:void 0}),q]}),p.jsxs(p.Fragment,{children:[c("MWChatSidebarSettingsPrivacyMenu.react")&&p.jsx(c("MWChatSidebarSettingsPrivacyMenu.react"),{}),o&&p.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemAccessibility"),onClick:function(){return t({},function(){})},primaryText:h._(/*BTDS*/"Accessibility"),testid:void 0})]}),b("cr:7484")&&p.jsx(b("cr:7484"),{}),p.jsxs("div",{children:[p.jsx(c("MWXMenuItem.react"),{href:c("XMessengerHelpCenterHomeControllerRouteBuilder").buildUri({}).toString(),icon:c("MWXIconMenuItemQuestionCircle"),onClick:function(){return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","help")},primaryText:h._(/*BTDS*/"Help"),target:"_blank",testid:void 0}),c("CurrentEnvironment").messengerdotcom?p.jsx(c("MWXMenuItem.react"),{icon:c("MWXIconMenuItemCautionTriangle"),onClick:function(){u!=null?(d("VenusFlytrapLogging").venusFlytrapLoggingStart(c("VenusFlytrapLoggingEntrypoint").TOP_NAVIGATION_SETTINGS),u()):(d("VenusFlytrapLogging").venusFlytrapLoggingStart(c("VenusFlytrapLoggingEntrypoint").TOP_NAVIGATION_SETTINGS),v({initialProduct:"chat"},function(){}));return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","report_problem")},primaryText:h._(/*BTDS*/"Report a Problem"),testid:void 0}):null]}),o?p.jsxs(p.Fragment,{children:[p.jsx(c("MWXMenuItem.react"),{href:"https://www.facebook.com/policies",icon:c("MWXIconMenuItemTextAlignLeft"),onClick:function(){return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","terms")},primaryText:h._(/*BTDS*/"Terms"),target:"_blank",testid:void 0}),p.jsx(c("MWXMenuItem.react"),{href:"https://www.facebook.com/privacy/policy?entry_point=messenger_settings",icon:c("MWXIconMenuItemTextAlignLeft"),onClick:function(){return d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw.sidebar","privacy_policy")},primaryText:h._(/*BTDS*/"Privacy Policy"),target:"_blank",testid:void 0}),w,z,d("CurrentUser").isMessengerOnlyUser()?p.jsx(c("MWXMenuItem.react"),{href:"https://www.facebook.com/help/messenger-app/ipad/458908261952384?helpref=platform_switcher&rdrhc",icon:c("MWXIconMenuItemInfoCircle"),onClick:function(){(m||(m=d("ODS"))).bumpEntityKey(3185,"inbox_settings","delete_account")},primaryText:h._(/*BTDS*/"Delete Your Account"),target:"_blank"}):null]}):null,x&&a==null?null:p.jsx("div",{children:a})]})]})}e.displayName=e.name+" [from "+f.id+"]";g["default"]=e}),226);
__d("MWMessageSearchEBRestoreUpsell.react",["fbt","MWChatEncryptedBackupsQPLSource.enum","MWEBRestoreUpsellTrigger.react","MWXLink.react","MWXText.react","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(){var a=d("react-compiler-runtime").c(1),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=j.jsx(c("MWEBRestoreUpsellTrigger.react"),{markerPrefix:"RESTORE_UNIVERSAL_MESSAGE_SEARCH",qplSource:c("MWChatEncryptedBackupsQPLSource.enum").UNIVERSAL_MESSAGE_SEARCH,children:k}),a[0]=b):b=a[0];return b}function k(a,b){return j.jsxs(c("MWXText.react"),{align:"center",ref:b,type:"meta3",children:[h._(/*BTDS*/"Messages are missing. Restore your chat history to search more messages.")," ",j.jsx(c("MWXText.react"),{color:"blueLink",type:"bodyLink4",children:j.jsx(c("MWXLink.react"),{onClick:a,children:h._(/*BTDS*/"Restore now")})})]})}k.displayName=k.name+" [from "+f.id+"]";g["default"]=a}),226);
__d("MWPinnedMessagesDialogNUXFactory.react",["JSResourceForInteraction","MWInboxPersistedUIState","declareNUXRequireable","react","useMWXLazyDialog","useSharedNUX"],(function(a,b,c,d,e,f,g){"use strict";var h;h||(h=d("react"));b=h;var i=b.useCallback,j=b.useMemo,k=c("JSResourceForInteraction")("MWPinnedMessagesDialogNUX.react").__setRef("MWPinnedMessagesDialogNUXFactory.react");function a(a){function b(b){var e=b.children,f=b.dialogProps;b=c("useSharedNUX")(a);var g=b[0],h=b[1];b=d("MWInboxPersistedUIState").usePersistedUIState(void 0,"__MWSimpleNux."+a+"__");b[0];var l=b[1],m=i(function(){l(void 0),h.onDismiss()},[h,l]),n=j(function(){return{onDismiss:m,pinMessageHandler:f.pinMessageHandler}},[f,m]);b=c("useMWXLazyDialog")(k);var o=b[0];b=function(){return o(n)};return g?e(b):e(f.pinMessageHandler)}b.displayName=b.name+" [from "+f.id+"]";return b}e=c("declareNUXRequireable")(a);g["default"]=e}),98);
__d("MWReadReceiptsMenuItem.react",["fbt","FDSMenuItemCheckbox.react","I64","LSFactory","LSIntEnum","LSOptimisticallyUpdateMessagingPrivacySettingsStoredProcedure","LSReadReceiptSettingState","MWXMenuItemWithSubmenu.react","MWXText.react","ReadReceiptControlSettingChangedFalcoEvent","promiseDone","react","react-compiler-runtime","useAsyncReStore","useDebouncedOnChange","useMWIsReadReceiptsDisabledForUser"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=i||(i=d("react"));i.useCallback;var m=250;function n(){var a=d("react-compiler-runtime").c(10),b=c("useAsyncReStore")(),e=c("useMWIsReadReceiptsDisabledForUser")(),g;a[0]!==b?(g=function(a){c("promiseDone")(b,function(b){var e=a?(j||(j=d("LSIntEnum"))).ofNumber(c("LSReadReceiptSettingState").DISABLED):(j||(j=d("LSIntEnum"))).ofNumber(c("LSReadReceiptSettingState").ENABLED);c("ReadReceiptControlSettingChangedFalcoEvent").log(function(){return{is_account_level:!0,setting_enabled:!(k||(k=d("I64"))).equal(e,(j||(j=d("LSIntEnum"))).ofNumber(c("LSReadReceiptSettingState").DISABLED))}});c("promiseDone")(b.runInTransaction(function(a){return c("LSOptimisticallyUpdateMessagingPrivacySettingsStoredProcedure")(c("LSFactory")(a),{readReceiptsDisabled:e})},"readwrite",void 0,void 0,f.id+":50"))})},a[0]=b,a[1]=g):g=a[1];g=g;e=c("useDebouncedOnChange")(e,g,m);var i=e[0],n=e[1];g=!i;a[2]!==n||a[3]!==i?(e=function(){return n(!i)},a[2]=n,a[3]=i,a[4]=e):e=a[4];var o;a[5]===Symbol["for"]("react.memo_cache_sentinel")?(o=h._(/*BTDS*/"Show read receipts"),a[5]=o):o=a[5];var p;a[6]===Symbol["for"]("react.memo_cache_sentinel")?(p=l.jsx(c("MWXText.react"),{color:"secondary",type:"body4",children:h._(/*BTDS*/"People won't be able to see when you've read their messages and you won't be able to see when they've read yours.")}),a[6]=p):p=a[6];a[7]!==g||a[8]!==e?(o=l.jsx(c("FDSMenuItemCheckbox.react"),{asSwitch:!0,isSelected:g,onClick:e,preventClosingMenuOnSelect:!0,primaryText:o,secondaryText:p}),a[7]=g,a[8]=e,a[9]=o):o=a[9];return o}function a(){var a=d("react-compiler-runtime").c(6),b=c("useMWIsReadReceiptsDisabledForUser")(),e;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(e=h._(/*BTDS*/"Read receipts"),a[0]=e):e=a[0];var f;a[1]!==b?(f=b?h._(/*BTDS*/"Off"):h._(/*BTDS*/"On"),a[1]=b,a[2]=f):f=a[2];a[3]===Symbol["for"]("react.memo_cache_sentinel")?(b={header:{title:h._(/*BTDS*/"Read receipts")},items:[l.jsx(n,{},"read-receipts")]},a[3]=b):b=a[3];a[4]!==f?(e=l.jsx(c("MWXMenuItemWithSubmenu.react"),{primaryText:e,secondaryText:f,submenu:b}),a[4]=f,a[5]=e):e=a[5];return e}g["default"]=a}),226);
__d("MWV2NegativeFeedbackMenuItem.react",["MWXMenuItem.react","react","react-compiler-runtime","useGenAiNegativeFeedback"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(3);a=a.message;a=c("useGenAiNegativeFeedback")(a);var e=a[0];a=a[1];var f;b[0]!==e||b[1]!==a?(f=i.jsx(c("MWXMenuItem.react"),{"aria-label":a,onClick:e,primaryText:a,testid:void 0}),b[0]=e,b[1]=a,b[2]=f):f=b[2];return f}g["default"]=a}),98);
__d("MWV2PositiveFeedbackMenuItem.react",["MWXMenuItem.react","react","react-compiler-runtime","useGenAiPositiveFeedback"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=d("react-compiler-runtime").c(3);a=a.message;a=c("useGenAiPositiveFeedback")(a);var e=a[0];a=a[1];var f;b[0]!==e||b[1]!==a?(f=i.jsx(c("MWXMenuItem.react"),{"aria-label":a,onClick:e,primaryText:a,testid:void 0}),b[0]=e,b[1]=a,b[2]=f):f=b[2];return f}g["default"]=a}),98);
__d("MessengerAccessibilityFilled.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 36 36",fill:"currentColor",width:"1em",height:"1em",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 29c6.075 0 11-4.925 11-11S24.075 7 18 7 7 11.925 7 18s4.925 11 11 11zm0-15c-.941 0-1.75-.652-1.75-2.07 0-1.158.737-1.93 1.75-1.93s1.75.772 1.75 1.93c0 1.418-.809 2.07-1.75 2.07zm6.5 1.797a.797.797 0 0 0-.797-.797H12.297a.797.797 0 0 0-.1 1.587l2.563.32a1 1 0 0 1 .863.828l.255 1.53c.08.483.041.978-.114 1.442l-1.343 4.032a.958.958 0 0 0 1.809.631l1.535-4.207a.25.25 0 0 1 .47 0l1.535 4.207a.958.958 0 0 0 1.81-.631l-1.344-4.032a3.001 3.001 0 0 1-.114-1.442l.255-1.53a1 1 0 0 1 .863-.828l2.562-.32a.797.797 0 0 0 .698-.79z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("MessengerDiscoverableChatClientEventsFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1254");b=d("FalcoLoggerInternal").create("messenger_discoverable_chat_client_events",a);e=b;g["default"]=e}),98);
__d("MessengerFriendsFilled.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 36 36",fill:"currentColor",width:"1em",height:"1em",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").Path,{d:"M7.25 12.305C7.25 16.207 9.446 18 12 18s4.75-1.793 4.75-5.695C16.75 9.123 14.75 7 12 7s-4.75 2.123-4.75 5.305zM15.082 21.607c.39-.423.262-1.13-.296-1.269A11.576 11.576 0 0 0 12 20c-4.835 0-9 2.985-9 6.665C3 27.405 3.37 28 4.06 28h7.81c.66 0 1.13-.675 1.13-1.335 0-1.97.83-3.697 2.082-5.058zM19.25 12.305C19.25 16.207 21.446 18 24 18s4.75-1.793 4.75-5.695C28.75 9.123 26.75 7 24 7s-4.75 2.123-4.75 5.305zM33 26.665c0 .74-.37 1.335-1.06 1.335H16.06c-.69 0-1.06-.595-1.06-1.335C15 22.985 19.165 20 24 20s9 2.985 9 6.665z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("MessengerHouseKeyholeFilled.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 36 36",fill:"currentColor",width:"1em",height:"1em",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M16.162 7.624a3 3 0 0 1 3.676 0l9.642 7.473a1.342 1.342 0 0 1-.822 2.403H27.25a.25.25 0 0 0-.25.25v8.75a2 2 0 0 1-2 2H11a2 2 0 0 1-2-2v-8.75a.25.25 0 0 0-.25-.25H7.342a1.342 1.342 0 0 1-.822-2.403l9.642-7.473zm3.532 10.852c-.203.14-.314.387-.242.622l1.514 4.932a.75.75 0 0 1-.718.97h-4.497a.75.75 0 0 1-.717-.97l1.514-4.932c.072-.235-.04-.483-.242-.622a3 3 0 1 1 3.388 0z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("MessengerQuestionCircleFilled.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 36 36",fill:"currentColor",width:"1em",height:"1em",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M18 29c6.075 0 11-4.925 11-11S24.075 7 18 7 7 11.925 7 18s4.925 11 11 11zm-1.311-15.93c-.314.192-.585.482-.832.892a1 1 0 0 1-1.713-1.032c.365-.606.844-1.164 1.502-1.566.663-.406 1.446-.614 2.354-.614 2.396 0 4.5 1.565 4.5 4 0 1.865-1.227 2.827-2.065 3.483l-.067.053c-.913.717-1.368 1.13-1.368 1.964a1 1 0 1 1-2 0c0-1.865 1.227-2.827 2.065-3.483l.067-.053c.913-.717 1.368-1.13 1.368-1.964 0-1.043-.896-2-2.5-2-.592 0-1.003.132-1.311.32zM19.25 24a1.25 1.25 0 1 1-2.5 0 1.25 1.25 0 0 1 2.5 0z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("MessengerSettingsFilled.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 36 36",fill:"currentColor",width:"1em",height:"1em",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M19.842 7.526A1.5 1.5 0 0 0 18.419 6.5h-.838a1.5 1.5 0 0 0-1.423 1.026l-.352 1.056c-.157.472-.541.827-1.006 1.003a8.93 8.93 0 0 0-.487.202c-.453.204-.976.225-1.42.002l-.997-.498a1.5 1.5 0 0 0-1.732.281l-.592.592a1.5 1.5 0 0 0-.28 1.732l.497.996c.223.445.202.968-.002 1.421-.072.16-.139.323-.202.487-.176.465-.531.849-1.003 1.006l-1.056.352A1.5 1.5 0 0 0 6.5 17.581v.838a1.5 1.5 0 0 0 1.026 1.423l1.056.352c.472.157.827.541 1.003 1.006.063.164.13.327.202.487.204.453.225.976.002 1.42l-.498.997a1.5 1.5 0 0 0 .281 1.732l.593.592a1.5 1.5 0 0 0 1.73.28l.998-.497c.444-.223.967-.202 1.42.002.16.072.323.139.487.202.465.176.849.531 1.006 1.003l.352 1.056a1.5 1.5 0 0 0 1.423 1.026h.838a1.5 1.5 0 0 0 1.423-1.026l.352-1.056c.157-.472.541-.827 1.006-1.003.164-.063.327-.13.486-.202.454-.204.977-.225 1.421-.002l.997.498a1.5 1.5 0 0 0 1.732-.281l.592-.592a1.5 1.5 0 0 0 .28-1.732l-.497-.996c-.223-.445-.202-.968.002-1.421.072-.16.139-.323.202-.487.176-.465.531-.849 1.003-1.006l1.056-.352a1.5 1.5 0 0 0 1.026-1.423v-.838a1.5 1.5 0 0 0-1.026-1.423l-1.056-.352c-.472-.157-.827-.541-1.003-1.006a8.991 8.991 0 0 0-.202-.487c-.204-.453-.225-.976-.002-1.42l.498-.997a1.5 1.5 0 0 0-.281-1.732l-.593-.592a1.5 1.5 0 0 0-1.73-.28l-.998.497c-.444.223-.967.202-1.42-.002a8.938 8.938 0 0 0-.487-.202c-.465-.176-.849-.531-1.006-1.003l-.352-1.056zM18 23.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("MessengerTextAlignLeftFilled.svg.react",["XPlatReactSVG","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs(d("XPlatReactSVG").Svg,babelHelpers["extends"]({viewBox:"0 0 36 36",fill:"currentColor",width:"1em",height:"1em",title:a.title},a,{children:[a.children!=null&&i.jsx(d("XPlatReactSVG").Defs,{children:a.children}),i.jsx(d("XPlatReactSVG").Path,{d:"M8 10a1 1 0 0 0-1 1v.5a1 1 0 0 0 1 1h20a1 1 0 0 0 1-1V11a1 1 0 0 0-1-1H8zM7 17.75a1 1 0 0 1 1-1h20a1 1 0 0 1 1 1v.5a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1v-.5zM7 24.5a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v.5a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1v-.5z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("MessengerWellbeingRestrictFailedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("474");b=d("FalcoLoggerInternal").create("messenger_wellbeing_restrict_failed",a);e=b;g["default"]=e}),98);
__d("MessengerWellbeingRestrictSucceededFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("480");b=d("FalcoLoggerInternal").create("messenger_wellbeing_restrict_succeeded",a);e=b;g["default"]=e}),98);
__d("MessengerWellbeingRestrictTappedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("481");b=d("FalcoLoggerInternal").create("messenger_wellbeing_restrict_tapped",a);e=b;g["default"]=e}),98);
__d("MessengerWellbeingUnrestrictFailedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("482");b=d("FalcoLoggerInternal").create("messenger_wellbeing_unrestrict_failed",a);e=b;g["default"]=e}),98);
__d("MessengerWellbeingUnrestrictSucceededFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("483");b=d("FalcoLoggerInternal").create("messenger_wellbeing_unrestrict_succeeded",a);e=b;g["default"]=e}),98);
__d("MessengerWellbeingUnrestrictTappedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("484");b=d("FalcoLoggerInternal").create("messenger_wellbeing_unrestrict_tapped",a);e=b;g["default"]=e}),98);
__d("PAKEDecryptSecretSprocStatusEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:0,WRONG_KEYS:-1,FAILURE:-2});f["default"]=a}),66);
__d("PAKEGetActiveSessionSprocStatusEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({SUCCESS:0,NO_SESSION:-1,FAILURE:-2});f["default"]=a}),66);
__d("PAKEMessageTypeEnum",[],(function(a,b,c,d,e,f){a=Object.freeze({AWAITING_CLIENT:0,PAKE_MESSAGE_1:1,PAKE_MESSAGE_2_AND_SECRET:2,SESSION_EXPIRED_ERROR:3,MAX_ATTEMPTS_ERROR:4,GENERIC_ERROR:5,MESSAGE_SENT_ERROR:6,PREVIOUS_MESSAGE_MISSING_ERROR:7,INVALID_PREVIOUS_MESSAGE_ERROR:8,ENCRYPTION_ERROR:9,DECRYPTION_ERROR:10,CPACE_STEP_2_ERROR:11,FETCH_SECRETS_ERROR:12,CPACE_STEP_1_ERROR:13,CPACE_STEP_3_ERROR:14,PAKE_HANDSHAKE_SUCCESS:15,SERIALIZATION_ERROR:16,NO_ACTIVE_SESSION:17,MULTIPLE_ACTIVE_SESSIONS_ERROR:18,PROCESS_SECRETS_ERROR:19,TIMEOUT_ERROR:20,FLOW_ABANDONED_ERROR:21,DESERIALIZE_SECRETS_ERROR:22,CODE_REQUESTED:23,PQ_PAKE_MESSAGE_2:24,PQ_PAKE_MESSAGE_3:25,PQ_PAKE_SECRETS:26});f["default"]=a}),66);
__d("PakeInitiatorSprocCalls",["LSDecryptPakeSecretStoredProcedure","LSFactory","LSGetActiveSessionStoredProcedure","LSIntEnum","LSSendPakeMessageOneStoredProcedure","LSSendPakeMessageStoredProcedure","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){var b=a.clientType,e=a.initiatorId,g=a.messagePayload,i=a.sessionId;a=a.storage;c("promiseDone")(a.runInTransaction(function(a){return c("LSSendPakeMessageOneStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),initiatorId:e,messagePayload:g,sessionId:i})},"readwrite",void 0,void 0,f.id+":45"))}function b(a){var b=a.clientType,e=a.initiatorId;a=a.storage;return a.runInTransaction(function(a){return c("LSGetActiveSessionStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),initiatorId:e})},"readwrite",void 0,void 0,f.id+":71")}function e(a){var b=a.clientType,e=a.encryptionKey,g=a.sessionId;a=a.storage;return a.runInTransaction(function(a){return c("LSDecryptPakeSecretStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),encryptionKey:e,sessionId:g})},"readwrite",void 0,void 0,f.id+":92")}function i(a){var b=a.clientType,e=a.messagePayload,g=a.messageType,i=a.senderId,j=a.sessionId;a=a.storage;return a.runInTransaction(function(a){return c("LSSendPakeMessageStoredProcedure")(c("LSFactory")(a),{clientType:(h||(h=d("LSIntEnum"))).ofNumber(b),messagePayload:e,messageType:h.ofNumber(g),senderId:i,sessionId:j})},"readwrite",void 0,void 0,f.id+":116")}g.sendPakeMessageOne=a;g.joinPakeSession=b;g.decryptPakeSecret=e;g.sendPakeMessage=i}),98);
__d("PakeQplLogging",["MWEBODSCategory","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","ODS","QPLEvent","QPLUserFlow"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a,b){c("QPLUserFlow").getActiveFlowIDs().includes((h||(h=d("QPLEvent"))).getMarkerId(a))||((i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EB_OTC_AUTH,c("MWEBODSEntityKey.enum").START),c("QPLUserFlow").start(a,{annotations:{string:babelHelpers["extends"]({},b)}}))}function b(a){var b=a.annotations,e=a.errorName,f=a.event;a=a.isUserError;c("QPLUserFlow").endFailure(f,e,{annotations:b});f=a===!0?c("MWEBODSEntityKey.enum").SUCCESS:c("MWEBODSEntityKey.enum").FAIL;(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EB_OTC_AUTH,f)}function e(a,b){c("QPLUserFlow").endSuccess(a,{annotations:b}),(i||(i=d("ODS"))).bumpEntityKey(c("MWEBODSCategory"),c("MWEBODSEntityName.enum").MW_EB_OTC_AUTH,c("MWEBODSEntityKey.enum").SUCCESS)}g.startPakeQPLFlow=a;g.endPakeQPLFlowFailure=b;g.endPakeQPLFlowSuccess=e}),98);
__d("VestaServerGraphQLLoginProviderBeginLoginMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9747954008656745"}),null);
__d("VestaServerGraphQLLoginProviderBeginLoginMutation.graphql",["VestaServerGraphQLLoginProviderBeginLoginMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"begin_login_request",variableName:"input"}],concreteType:"VestaBeginLoginResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_begin_login",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_l2",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_l2_sig",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"VestaServerGraphQLLoginProviderBeginLoginMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"VestaServerGraphQLLoginProviderBeginLoginMutation",selections:c},params:{id:b("VestaServerGraphQLLoginProviderBeginLoginMutation_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLLoginProviderBeginLoginMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("VestaServerGraphQLLoginProviderFinishLoginMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9611648865601020"}),null);
__d("VestaServerGraphQLLoginProviderFinishLoginMutation.graphql",["VestaServerGraphQLLoginProviderFinishLoginMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"input"}],c=[{alias:null,args:[{kind:"Variable",name:"finish_login_request",variableName:"input"}],concreteType:"VestaFinishLoginResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_finish_login",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_login_payload",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"login_success",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"VestaServerGraphQLLoginProviderFinishLoginMutation",selections:c,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"VestaServerGraphQLLoginProviderFinishLoginMutation",selections:c},params:{id:b("VestaServerGraphQLLoginProviderFinishLoginMutation_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLLoginProviderFinishLoginMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("VestaServerGraphQLLoginProviderInitQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="9285801411531503"}),null);
__d("VestaServerGraphQLLoginProviderInitQuery.graphql",["VestaServerGraphQLLoginProviderInitQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:null,kind:"LocalArgument",name:"request"}],c=[{alias:null,args:[{kind:"Variable",name:"vesta_init_request",variableName:"request"}],concreteType:"VestaInitIqResponse",kind:"LinkedField",name:"fbid_based_auth_layer_vesta_login_init",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_rsa_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_rsa_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_opaque_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_ed25519_pub",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"base64url_encoded_island_ed25519_pub_signature",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_registered",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"attempts_remaining",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"VestaServerGraphQLLoginProviderInitQuery",selections:c,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"VestaServerGraphQLLoginProviderInitQuery",selections:c},params:{id:b("VestaServerGraphQLLoginProviderInitQuery_facebookRelayOperation"),metadata:{},name:"VestaServerGraphQLLoginProviderInitQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("VestaServerGraphQLLoginProvider",["E2EEBackupUtil","RelayHooks","RelayModern","VestaServerGraphQLLoginProviderBeginLoginMutation.graphql","VestaServerGraphQLLoginProviderFinishLoginMutation.graphql","VestaServerGraphQLLoginProviderInitQuery.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;async function a(a,c){c=c.environment;c=await d("RelayHooks").fetchQuery(c,h!==void 0?h:h=b("VestaServerGraphQLLoginProviderInitQuery.graphql"),{request:{fbid:a.clientId,product_use_case:a.productUseCase,vesta_client_api_version:6}}).toPromise();a=c==null?void 0:c.fbid_based_auth_layer_vesta_login_init;c=a==null?void 0:a.base64url_encoded_island_rsa_pub;var e=a==null?void 0:a.base64url_encoded_island_rsa_pub_signature,f=a==null?void 0:a.base64url_encoded_opaque_pub,g=a==null?void 0:a.base64url_encoded_opaque_pub_signature,i=a==null?void 0:a.base64url_encoded_island_ed25519_pub,j=a==null?void 0:a.base64url_encoded_island_ed25519_pub_signature,k=a==null?void 0:a.is_registered;a=a==null?void 0:a.attempts_remaining;if(c!=null&&e!=null&&f!=null&&g!=null&&i!=null&&j!=null&&k!=null){var l;return{islandRsaPub:(l=d("E2EEBackupUtil")).decodeBase64Url(c),islandRsaPubSig:l.decodeBase64Url(e),opaquePub:l.decodeBase64Url(f),opaquePubSig:l.decodeBase64Url(g),islandEd25519Pub:l.decodeBase64Url(i),islandEd25519PubSig:l.decodeBase64Url(j),isRegistered:k,loginAttemptsRemaining:a}}throw new Error("GraphQL Response is Null")}function c(a,c){var e=c.environment,f=i!==void 0?i:i=b("VestaServerGraphQLLoginProviderBeginLoginMutation.graphql"),g={input:{fbid:a.clientId,product_use_case:a.productUseCase,base64url_encoded_opaque_l1:d("E2EEBackupUtil").encodeBase64Url(a.opaqueL1)}};return new Promise(function(a,b){d("RelayModern").commitMutation(e,{mutation:f,variables:g,onCompleted:function(c){c=c.fbid_based_auth_layer_vesta_begin_login;var e=c==null?void 0:c.base64url_encoded_opaque_l2;c=c==null?void 0:c.base64url_encoded_opaque_l2_sig;if(e!=null&&c!=null){a({opaqueL2:d("E2EEBackupUtil").decodeBase64Url(e),opaqueL2Sig:d("E2EEBackupUtil").decodeBase64Url(c)});return}b(new Error("GraphQL Response is Null"))},onError:function(a){b(a)}})})}function e(a,c){var e=c.environment,f=c.updater;return new Promise(function(c,g){d("RelayModern").commitMutation(e,{mutation:j!==void 0?j:j=b("VestaServerGraphQLLoginProviderFinishLoginMutation.graphql"),variables:{input:{fbid:a.clientId,product_use_case:a.productUseCase,base64url_encoded_opaque_l3:d("E2EEBackupUtil").encodeBase64Url(a.opaqueL3)}},onCompleted:function(a){a=a.fbid_based_auth_layer_vesta_finish_login;var b=a==null?void 0:a.base64url_encoded_login_payload,e=a==null?void 0:a.login_success;a=a==null?void 0:a.attempts_remaining;if(e!=null){c({loginSuccess:e,loginPayload:b==null?b:d("E2EEBackupUtil").decodeBase64Url(b),attemptsRemaining:a});return}g(new Error("GraphQL Response is Null"))},onError:function(a){g(a)},updater:f})})}g.initLogin=a;g.beginLogin=c;g.finishLogin=e}),98);
__d("WebStorageManagerEstimatesFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("2144");b=d("FalcoLoggerInternal").create("web_storage_manager_estimates",a);e=b;g["default"]=e}),98);
__d("YpMessengerFamilyCenterCoreClientEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("4644");b=d("FalcoLoggerInternal").create("yp_messenger_family_center_core_client_event",a);e=b;g["default"]=e}),98);
__d("YpMessengerFamilyCenterSetupClientEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("4648");b=d("FalcoLoggerInternal").create("yp_messenger_family_center_setup_client_event",a);e=b;g["default"]=e}),98);
__d("YpMessengerTimeLimitClientEventFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("6453");b=d("FalcoLoggerInternal").create("yp_messenger_time_limit_client_event",a);e=b;g["default"]=e}),98);
__d("checkIsUserOptedOutOfAutoRestore",["I64","LSAuthorityLevel","LSIntEnum","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","ReQL","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;async function a(a){var b=d("MWEBUseLocalStorage").mwEBGetLocalStorageEntryValue(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT);if(b!=null)return;b=await a;a=d("ReQL").fromTableAscending(b.tables.secure_encrypted_backups_client_state).filter(function(a){a=a.authorityLevel;return(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))});var e=await d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(b.tables.auto_restore_opt_out));a=await d("ReQL").firstAsync(a);var g=c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_OPTED_OUT_OF_AUTO_RESTORE,j=d("MWEBUseLocalStorage").mwEBGetIsLocalStorageEntryValuePresent(c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_SET_UP_IN_CURRENT_SESSION);e=e.filter(function(a){return a.optOutKey===g}).length>0;if(!e&&a!=null&&j==null){var k="true";c("promiseDone")(b.runInTransaction(function(a){return a.auto_restore_opt_out.upsert([g],{optOutKey:g,optOutValue:k})},"readwrite","background",void 0,f.id+":73"))}}g.default=a}),98);
__d("deserializeSecretsAndAddDevice",["EBMainThreadEBDBApiDeferred","EBWorkerODSEntityName.enum","FBLogger","I64","LSAuthorityLevel","LSEncryptedBackupsRecoveryCodeStatus","LSIntEnum","MWDeserializeSecretsAndAddDevice","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsInitializeRestoreDeferred","MWPakeQPLEvents","PAKEMessageTypeEnum","PakeQplLogging","QPLUserFlow","ReQL","cr:21222","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function a(a){var b=a.db,e=a.initiatorId,f=a.onAddDeviceFailure,g=a.onAddDeviceFinish;a=a.secrets;var k=function(){};c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_START");return c("MWDeserializeSecretsAndAddDevice")({initiatorId:e,secrets:a,storage:b}).then(function(a){a=a[0];a||(c("FBLogger")("wmi_eb").mustfix("PAKE: deserializeSecretsAndAddDevice sproc failed"),d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").DESERIALIZE_SECRETS_ERROR}},errorName:"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_FAILURE",event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1}),f());k=d("ReQL").fromTableAscending(b.tables.secure_encrypted_backups_recovery_code_status).subscribe(function(a,e){if(e.operation==="add"||e.operation==="put"){a=e.value.recoveryCodeStatus;if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsRecoveryCodeStatus").VALID))){k();c("QPLUserFlow").addPoint((e=d("MWPakeQPLEvents")).pakeInitiatorQplEvent,"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_END");void d("EBMainThreadEBDBApiDeferred").addNewDevice();g();c("QPLUserFlow").addPoint(e.pakeInitiatorQplEvent,"MEB_INITIALIZE_RESTORE_START");d("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:b,onFailure:function(){d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1}},errorName:"MEB_INITIALIZE_RESTORE_FAILURE",event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1})}});c("QPLUserFlow").addPoint(e.pakeInitiatorQplEvent,"MEB_INITIALIZE_RESTORE_END");d("PakeQplLogging").endPakeQPLFlowSuccess(e.pakeInitiatorQplEvent);c("promiseDone")(j(b))}else if((h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsRecoveryCodeStatus").SYSTEM_ERROR)))c("FBLogger")("wmi_eb").mustfix("PAKE: LSEncryptedBackupsFinishAddPeerDeviceTask task failed"),d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").DESERIALIZE_SECRETS_ERROR}},errorName:"MEB_FINISH_ADD_PEER_DEVICE_FAILURE",event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1}),f();else{e="PAKE: Unexpected recovery code status: "+(h||(h=d("I64"))).to_int32(a);c("FBLogger")("wmi_eb").mustfix(e)}}});return k}).catch(function(a){a="PAKE: error when adding new device using OTC, "+a;c("FBLogger")("wmi_eb").mustfix(a);d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").DESERIALIZE_SECRETS_ERROR},string:{exceptionMessage:a}},errorName:"MEB_DESERIALIZE_SECRETS_AND_ADD_DEVICE_EXCEPTION",event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});f();k();return function(){}})}async function j(a){if(b("cr:21222")!=null){a=await d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state).filter(function(a){a=a.authorityLevel;return(h||(h=d("I64"))).equal(a,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}));if(a!=null&&a.deviceId!=null){var e=a.deviceId;void (b("cr:21222")==null?void 0:b("cr:21222").fireAndForget("backend","addDeviceWithKeysInWorker",{backupId:a.backupId,deviceRegistrationId:d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId(),isAutoRestore:!1,previousDeviceId:e,source:c("EBWorkerODSEntityName.enum").MW_EB_OTC_MAIN_THREAD}))}}}g.default=a}),98);
__d("establishPakeHandshakeAsInitiator",["Base64Utils","FBLogger","I64","MWEncryptedBackupsDeviceRegistrationId","MWPakeQPLEvents","PAKECleanupSessionReasonEnum","PAKEDecryptSecretSprocStatusEnum","PAKEGetActiveSessionSprocStatusEnum","PAKEMessageTypeEnum","PakeCpaceUtils","PakeCpaceWasm","PakeQplLogging","QPLUserFlow","ReQL","clearTimeout","promiseDone","requireDeferred","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("CleanupPakeSession").__setRef("establishPakeHandshakeAsInitiator"),j=c("requireDeferred")("PakeInitiatorSprocCalls").__setRef("establishPakeHandshakeAsInitiator"),k=(h||(h=d("I64"))).of_int32(-1),l=3e3,m="PAKE_INITIATOR_FAILURE";async function a(a){var b=a.clientType,e=a.onGeneralFailure,f=a.onMaxAttemptsReached,g=a.onNoSessionExists,n=a.onSessionExpired,o=a.onSuccessfulSecretDecryption,p=a.onWrongOtc,q=a.otc,r=a.pakeCpaceModule,s=a.storage,t=a.timeout,u=function(){},v=function(){z&&c("clearTimeout")(z)},w=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(w===""){d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});return{pakeClient:null,stopTimeout:v,unsubFromMessagesTable:u}}var x=r!=null?r:await d("PakeCpaceWasm").PakeCPaceWasm(),y=x.createCPaceClient(w),z=null,A=null,B=!1,C=d("ReQL").fromTableAscending(s.tables.pake_messages),D=function(){z&&c("clearTimeout")(z),z=c("setTimeout")(function(){e(),u(),i.onReady(function(a){c("promiseDone")(a({cleanupReason:c("PAKECleanupSessionReasonEnum").TIMEOUT,clientType:b,deviceId:w,storage:s}))}),c("FBLogger")("wmi_eb").mustfix("PAKE handshake failed by timeout")},t)},E=function(){A&&c("clearTimeout")(A),A=c("setTimeout")(function(){c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_CPACE_RETRY_JOIN_SESSION"),B=!0,M()},l)},F=function(a){var d=a.messageType,f=a.sessionId;e();j.onReady(function(a){c("promiseDone")(a.sendPakeMessage({clientType:b,messageType:d,senderId:w,sessionId:f,storage:s}))})},G=function(a){var e=a.messagePayload,f=a.responderId,g=a.sessionId;c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_CPACE_STEP_THREE_START");if(e==null){c("FBLogger")("wmi_eb").mustfix("PAKE: When executing step 3 of CPace Handshake messagePayload was null");d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").INVALID_PREVIOUS_MESSAGE_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});return}if(f==null){c("FBLogger")("wmi_eb").mustfix("PAKE: When executing step 3 of CPace Handshake responderId was null");d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").INVALID_PREVIOUS_MESSAGE_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});return}a=d("Base64Utils").toArrayBuffer(e);var i;try{f=x.clientFinalize(y,new Uint8Array(a));i=f.clientKey1}catch(a){F({messageType:c("PAKEMessageTypeEnum").CPACE_STEP_3_ERROR,sessionId:g});d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").CPACE_STEP_3_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});throw c("FBLogger")("wmi_eb").mustfixThrow("PAKE: Error executing CPace step 3")}c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_DECRYPT_SECRET_START");j.onReady(function(a){c("promiseDone")(a.decryptPakeSecret({clientType:b,encryptionKey:d("PakeCpaceUtils").typedArrayToBuffer(i),sessionId:g,storage:s}),function(e){var f=e[0];e=e[1];v();switch((h||(h=d("I64"))).to_int32(e)){case c("PAKEDecryptSecretSprocStatusEnum").SUCCESS:if(f==null){d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});throw c("FBLogger")("wmi_eb").mustfixThrow("PAKE: decryptedSecret is null despite SPROC success")}c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_DECRYPT_SECRET_END");c("promiseDone")(a.sendPakeMessage({clientType:b,messageType:c("PAKEMessageTypeEnum").PAKE_HANDSHAKE_SUCCESS,senderId:w,sessionId:g,storage:s}));o({decryptedSecret:f,initiatorId:w});break;case c("PAKEDecryptSecretSprocStatusEnum").WRONG_KEYS:d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!0}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!0});p();break;case c("PAKEDecryptSecretSprocStatusEnum").FAILURE:d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});F({messageType:c("PAKEMessageTypeEnum").DECRYPTION_ERROR,sessionId:g});break}},function(a){d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},string:{exceptionMessage:a}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1}),F({messageType:c("PAKEMessageTypeEnum").DECRYPTION_ERROR,sessionId:g})})})},H=function(a){var b=a.annotations,e=a.fbLoggerMessage,f=a.isUserError,g=a.messageType,h=a.onFinish;a=a.unsubFromTable;v();a();h();e!=null&&c("FBLogger")("wmi_eb").mustfix(e,g);d("PakeQplLogging").endPakeQPLFlowFailure({annotations:b,errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:f})},I=function(a){var b=a.onPakeStepOneSuccess;u=C.subscribe(function(a,f){if(f.operation!=="put"&&f.operation!=="add")return;a=f.value;f=(h||(h=d("I64"))).to_int32(a.messageType);switch(f){case c("PAKEMessageTypeEnum").PAKE_MESSAGE_1:c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_SEND_PAKE_MESSAGE_ONE_END");u();b();break;case c("PAKEMessageTypeEnum").INVALID_PREVIOUS_MESSAGE_ERROR:case c("PAKEMessageTypeEnum").PREVIOUS_MESSAGE_MISSING_ERROR:return H({annotations:{bool:{isUserError:!1},int:{errorCode:f}},fbLoggerMessage:"PAKE: Failed to send PAKE message one due to invalid state",isUserError:!1,messageType:f,onFinish:function(){return e()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").MESSAGE_SENT_ERROR:return H({annotations:{bool:{isUserError:!1},int:{errorCode:f}},fbLoggerMessage:"PAKE: Failed to send PAKE message one",isUserError:!1,messageType:f,onFinish:function(){return e()},unsubFromTable:function(){u()}});default:break}})},J=function(a){var b=a.sessionId;u=C.subscribe(function(a,g){if(g.operation!=="put"&&g.operation!=="add")return;a=g.value;g=(h||(h=d("I64"))).to_int32(a.messageType);switch(g){case c("PAKEMessageTypeEnum").PAKE_MESSAGE_2_AND_SECRET:u();G({messagePayload:a.messagePayload,responderId:a.responderId,sessionId:b});break;case c("PAKEMessageTypeEnum").MAX_ATTEMPTS_ERROR:return H({annotations:{bool:{isUserError:!0},int:{errorCode:g}},isUserError:!0,messageType:g,onFinish:function(){return f()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").SESSION_EXPIRED_ERROR:return H({annotations:{bool:{isUserError:!0},int:{errorCode:g}},isUserError:!0,messageType:g,onFinish:function(){return n()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").GENERIC_ERROR:return H({annotations:{bool:{isUserError:!1},int:{errorCode:g}},fbLoggerMessage:"PAKE: Something went wrong in the responder device",isUserError:!1,messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").FETCH_SECRETS_ERROR:return H({annotations:{bool:{isUserError:!1},int:{errorCode:g}},fbLoggerMessage:"PAKE: Responder device failed to fetch secrets.",isUserError:!1,messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}});case c("PAKEMessageTypeEnum").FLOW_ABANDONED_ERROR:return H({annotations:{bool:{isUserError:!1},int:{errorCode:g}},fbLoggerMessage:"PAKE: Responder device flow was abandoned.",isUserError:!1,messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}});default:return H({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},fbLoggerMessage:"PAKE: Unexpected Message Type when listening for pake step two success "+g,isUserError:!1,messageType:g,onFinish:function(){return e()},unsubFromTable:function(){u()}})}})},K=function(a){var f=a.onJoinSessionSuccess;c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_GET_ACTIVE_SESSION_START");j.onReady(function(a){c("promiseDone")(a.joinPakeSession({clientType:b,initiatorId:w,storage:s}),function(a){var b=a[0],i=a[1];a=a[2];i=i!=null?i:k;switch((h||(h=d("I64"))).to_int32(b)){case c("PAKEGetActiveSessionSprocStatusEnum").SUCCESS:if(a==null||i===k){c("FBLogger")("wmi_eb").mustfix("PAKE: When joining session, responderId or joinedSessionId were unexpectedly null");d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});e();return}f(a,i);c("QPLUserFlow").addAnnotations(d("MWPakeQPLEvents").pakeInitiatorQplEvent,{string:{session_id:(h||(h=d("I64"))).to_string(i)}});break;case c("PAKEGetActiveSessionSprocStatusEnum").NO_SESSION:if(B===!1){E();return}d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!0},int:{errorCode:c("PAKEMessageTypeEnum").NO_ACTIVE_SESSION}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!0});g();v();break;case c("PAKEGetActiveSessionSprocStatusEnum").FAILURE:d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});c("FBLogger")("wmi_eb").mustfix("PAKE: When joining session, sproc failed");e();v();break}},function(){d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").GENERIC_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1}),c("FBLogger")("wmi_eb").mustfix("PAKE: When joining session, sproc failed"),e(),v()})})},L=function(a){var e=a.responderId,f=a.sessionId,g;c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_CPACE_STEP_ONE_START");try{g=x.clientBegin(y,q,e)}catch(a){F({messageType:c("PAKEMessageTypeEnum").CPACE_STEP_1_ERROR,sessionId:f});d("PakeQplLogging").endPakeQPLFlowFailure({annotations:{bool:{isUserError:!1},int:{errorCode:c("PAKEMessageTypeEnum").CPACE_STEP_1_ERROR}},errorName:m,event:d("MWPakeQPLEvents").pakeInitiatorQplEvent,isUserError:!1});throw c("FBLogger")("wmi_eb").mustfixThrow("PAKE: Error executing CPace step 1")}c("QPLUserFlow").addPoint(d("MWPakeQPLEvents").pakeInitiatorQplEvent,"PAKE_SEND_MESSAGE_ONE_START");j.onReady(function(a){a.sendPakeMessageOne({clientType:b,initiatorId:w,messagePayload:d("PakeCpaceUtils").typedArrayToBuffer(g),sessionId:f,storage:s})});I({onPakeStepOneSuccess:function(){J({sessionId:f})}})},M=function(){D();d("PakeQplLogging").startPakeQPLFlow(d("MWPakeQPLEvents").pakeInitiatorQplEvent);K({onJoinSessionSuccess:function(a,b){L({responderId:a,sessionId:b})}});return{pakeClient:y,stopTimeout:v,unsubFromMessagesTable:u}};return M()}g.default=a}),98);
__d("mwEBAddDevice",["EBSMAPI","MAWCurrentUser","cr:21222"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var e=a.environment,f=a.onFailure,g=a.onInvalidRecoveryCode,h=a.onSuccess,i=a.recoveryCode,j=a.storage,k=a.trackAddingDevice;a=a.trackOverprompting;return c("EBSMAPI").addDeviceWithRecoveryCode({environment:e,recoveryCode:i,storage:j,trackAddingDevice:k,trackOverprompting:a,userId:d("MAWCurrentUser").getID()}).then(function(a){a.success?h():a.error==="INVALID_RECOVERY_CODE"?g():f(a.error),b("cr:21222")==null||b("cr:21222").fireAndForget("backend","addDeviceWithPinInWorker",{recoveryCode:i,userId:d("MAWCurrentUser").getID()})})}g.EBAddDevice=a}),98);
__d("vestaBackupSecretRestore",["requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("E2EEBackupSecretRestoreModule").__setRef("vestaBackupSecretRestore"),i=c("requireDeferred")("VestaServerGraphQLLoginProvider").__setRef("vestaBackupSecretRestore");async function a(a){var b=a.input;a=a.environment;var c=await Promise.all([i.load(),h.load()]),d=c[0],e=d.beginLogin,f=d.finishLogin;d=d.initLogin;c=c[1].restoreBackupSecret;return c({beginLogin:e,finishLogin:f,initLogin:d},b,{environment:a})}g.default=a}),98);
__d("mwEBGetPINSecretFromVesta",["CometRelay","E2EEBackupCommon","FBLogger","LSDataTraceCheckPoint","LSDataTraceType","LSIntEnum","MAWTraceUtils","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsSettingsDialogQuery.graphql","MWEBODSEntityKey.enum","MWEBODSEntityName.enum","QPLUserFlow","promiseDone","vestaBackupSecretRestore"],(function(a,b,c,d,e,f,g){"use strict";var h;async function a(a){var b=a.addDevice,e=a.clientID,f=a.environment,g=a.getSourceFromContext,i=a.onSubmitPin,j=a.onSubmitPinFailure,k=a.onVestaSecretFetch,l=a.pinCode,m=a.productUseCase,n=a.setIsInProgress,o=a.setIsPinCodeIncorrect,p=a.setIsVestaError;a=a.startFlow;var q=d("MAWTraceUtils").startNewTrace((h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").SAP_VESTA_LOGIN),d("MAWTraceUtils").CONTEXT_VESTA_LOGIN);n(!0);i==null||i();i=g();c("QPLUserFlow").addAnnotations(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,{string:{restore_type:"pin_code",source:i}});g=new TextDecoder();var r;a({additionalAnnotations:{device_type:"HSM"},event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_PIN_RESTORE_AUTH,source:i});try{c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"vesta_login_begin"),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"PIN_CODE_RESTORE_SUBMIT"),d("MAWTraceUtils").recordCheckpointForTrace(q,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").SAP_VESTA_CALLING_VESTA_LOGIN),[],!1),r=g.decode(await c("vestaBackupSecretRestore")({environment:f,input:{clientId:e,productUseCase:m,vestaAccountPin:l}})),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"vesta_login_success"),d("MAWTraceUtils").recordCheckpointForTrace(q,h.ofNumber(c("LSDataTraceCheckPoint").SAP_VESTA_LOGIN_COMPLETION),[],!1)}catch(b){j==null||j();c("promiseDone")(d("CometRelay").fetchQuery(f,c("MWChatEncryptedBackupsSettingsDialogQuery.graphql"),{}).toPromise());if(b.errorType===d("E2EEBackupCommon").BackupErrorType.INVALID_PASSWORD)n(!1),o(!0),d("MWChatEncryptedBackupsLogging").endFailure({errorName:"incorrect_pin_code",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityKey:c("MWEBODSEntityKey.enum").INCORRECT_PIN_CODE,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_PIN_RESTORE_AUTH}),c("QPLUserFlow").markError(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"incorrect_pin_code"),d("MAWTraceUtils").recordFailureAndFlushForTraceId(q,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],"Incorrect pin code");else{d("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorMessage:b.message,errorType:b.errorType}},errorName:"vesta_login_failure",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_PIN_RESTORE_AUTH});c("QPLUserFlow").markError(d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,"pin_code_error");n(!1);p(!0);a="Error when restoring using PIN: "+b;c("FBLogger")("wmi_eb").mustfix(a);d("MAWTraceUtils").recordFailureAndFlushForTraceId(q,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_RESTORE_FAILURE),[],b.toString())}throw b}r!=null&&(d("MAWTraceUtils").recordCheckpointForTrace(q,(h||(h=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PLUGIN_CALLING_ADD_DEVICE),[],!1),k==null||k(),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,"add_device_begin"),b(r,q,l))}g.default=a}),98);
__d("mwEBSetBackupState",[],(function(a,b,c,d,e,f){"use strict";function a(a){var b=a.setBackupState;a=a.state;switch(a){case 1:break;case 2:b(2);break;case 3:b(3);break;case 4:b(4);break;case-1:b(-1);break;case 0:break}}f["default"]=a}),66);
__d("mwEBUpdateBackupsTable",["LSFactory","LSUpdateBackupsTableStoredProcedure","LSVec"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.backupIds,d=a.deviceIds,e=a.encryptionManagementDelegatorId,g=a.hasOtcEligibleDevices,h=a.isSuccess,i=a.isUserOptedOut,j=a.storage,k=a.virtualDevices;return j.runInTransaction(function(a){return c("LSUpdateBackupsTableStoredProcedure")(c("LSFactory")(a),{backupIds:b,backupMetadata:c("LSVec").ofArray([]),deviceIds:d,encryptionManagementDelegatorId:e,hasOtcEligibleDevices:g,isSuccess:h,isUserOptedOut:i,virtualDevices:k})},"readwrite",void 0,void 0,f.id+":48")}g["default"]=a}),98);
__d("mwProcessBackupIds",["I64","LSAuthorityLevel","LSIntEnum","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","QPLEvent","QPLUserFlow","WebSession"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k="-1";function l(a){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,"EB_STATE_"+a+"."),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent})}function m(a){var b=a.clientStateData;a=a.encryptedBackupData;a=a==null?void 0:a.backupId;if(a==null){l("NO_BACKUPS_PRESENT");return 2}if((h||(h=d("I64"))).to_string(a)===k){d("MWChatEncryptedBackupsLogging").endFailure({errorName:"FETCH_ERROR",event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent});return-1}if(b==null||!(h||(h=d("I64"))).equal(b.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))){l("DEVICE_NOT_ONBOARDED");return 4}if(!(h||(h=d("I64"))).equal(b.backupId,a)){l("DEVICE_NOT_ONBOARDED_BACKUP_ID_MISMATCH");return 4}l("DEVICE_ONBOARDED");return 3}function a(a){var b=a.clientStateData;a=a.encryptedBackupData;if(a==null)return 0;var e=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((j||(j=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:e,processBackupIdsVersion:"JS",sessionTabId:d("WebSession").getId()}}});if((h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC))){l("FETCH_IN_PROGRESS");return 1}else if((h||(h=d("I64"))).equal(a.authorityLevel,(i||(i=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE)))return m({clientStateData:b,encryptedBackupData:a});else{d("MWChatEncryptedBackupsLogging").endFailure({errorName:"FETCH_ERROR_WRONG_AUTHORITY_LEVEL",event:d("MWChatEncryptedBackupsQPLEvents").processBackupIdsQPLEvent});return-1}}g["default"]=a}),98);
__d("updateUpsellsStateInRelayStore",["CometRelay","FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.environment,e=a.updateValue;d("CometRelay").commitLocalUpdate(b,function(a){a=a.getRoot().getLinkedRecord("viewer");if(a==null){c("FBLogger")("wmi_eb").mustfix("[labyrinth][upsells] A viewer record does not exist when updating upsell state.");return}a.setValue(e,"is_eb_restore_upsells_dismissed")})}g["default"]=a}),98);
__d("useMWChatDisplayEncryptedBackupsRestoreToast",["I64","LSEncryptedBackupsClientRestoreState","LSIntEnum","ReQL","ReQLSuspense","react","react-compiler-runtime","useMAWEncryptedBackupsRestoreToast","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");var l=b.useEffect,m=b.useState;function a(){var a=d("react-compiler-runtime").c(10),b=(h||(h=c("useReStore")))(),e;a[0]!==b.tables.encrypted_backups_client_restore_status?(e=function(){return d("ReQL").fromTableAscending(b.tables.encrypted_backups_client_restore_status)},a[0]=b.tables.encrypted_backups_client_restore_status,a[1]=e):e=a[1];var g;a[2]!==b?(g=[b],a[2]=b,a[3]=g):g=a[3];var i=d("ReQLSuspense").useArray(e,g,f.id+":27");e=c("useMAWEncryptedBackupsRestoreToast")();var j=e.showInProgressToast,k=e.showSuccessToast;g=m(!1);var o=g[0],p=g[1];a[4]!==o||a[5]!==i||a[6]!==j||a[7]!==k?(e=function(){var a=i.some(n);o&&!a?(p(!1),k()):!o&&a&&(p(!0),j())},g=[o,i,j,k],a[4]=o,a[5]=i,a[6]=j,a[7]=k,a[8]=e,a[9]=g):(e=a[8],g=a[9]);l(e,g)}function n(a){a=a.restoreStatus;return a!=null&&(i||(i=d("I64"))).equal(a,(j||(j=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsClientRestoreState").RESTORE_IN_PROGRESS))}g["default"]=a}),98);
__d("useMWChatEncryptedBackupsAutoRestore",["EBSMGatingUI","I64","LSAuthorityLevel","LSIntEnum","MWChatEncryptedBackupsAddDeviceWithEBKeys","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWEBEntrypointsKillswitch.enum","MWEBODSEntityName.enum","MWEBUseLocalStorage","MWEncryptedBackupsDeviceRegistrationId","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsInitializeRestoreDeferred","MWEncryptedBackupsLocalStorageEntryEnum","MWEncryptedBackupsSharedState","ReQL","ReQLSuspense","WALogger","qex","react","react-compiler-runtime","useLabyrinthLogging","useMWEBBackupState","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m;b=m||d("react");var n=b.useEffect,o=b.useRef,p=b.useState;function a(){var a=d("react-compiler-runtime").c(21),b=c("MWChatEncryptedBackupsQPLSource.enum").AUTO_RESTORE,e=p(!0),g=e[0],h=e[1],i=(j||(j=c("useReStore")))();e=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var k=e.startFlow,l;a[0]!==g||a[1]!==i?(e=function(){return g?d("ReQL").fromTableAscending(i.tables.secure_encrypted_backups_epochs):d("ReQL").empty()},l=[g,i],a[0]=g,a[1]=i,a[2]=e,a[3]=l):(e=a[2],l=a[3]);var m=d("ReQLSuspense").useFirst(e,l,f.id+":47");a[4]!==g||a[5]!==i?(e=function(){return g?d("ReQL").fromTableAscending(i.tables.secure_encrypted_backups_client_state).filter(s):d("ReQL").empty()},l=[g,i],a[4]=g,a[5]=i,a[6]=e,a[7]=l):(e=a[6],l=a[7]);var t=d("ReQLSuspense").useFirst(e,l,f.id+":54");a[8]===Symbol["for"]("react.memo_cache_sentinel")?(e={entrypoint:c("MWEBEntrypointsKillswitch.enum").AUTO_RESTORE},a[8]=e):e=a[8];var u=c("useMWEBBackupState")(e);a[9]!==g||a[10]!==i?(l=function(){return g?d("ReQL").fromTableAscending(i.tables.experiences_shared_state):d("ReQL").empty()},e=[g,i],a[9]=g,a[10]=i,a[11]=l,a[12]=e):(l=a[11],e=a[12]);var v=d("ReQLSuspense").useArray(l,e,f.id+":71"),w=o(!1);a[13]!==u||a[14]!==t||a[15]!==m||a[16]!==v||a[17]!==k||a[18]!==i?(l=function(){if(w.current||u===1||u===0)return;if(u===3){var a=t==null?void 0:t.deviceId,e=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:i,sharedStateTable:v,stateKey:"auto_restored"}),f=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:i,sharedStateTable:v,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_RESTORED_SUCCESSFULLY}),g=d("MWEncryptedBackupsSharedState").getIsEntryPresentInSharedState({db:i,sharedStateTable:v,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_ONBOARDED_SUCCESSFULLY});e=e||f||g;f=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(!e&&f!==""&&t!=null&&m!=null&&a!=null){d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT);k({additionalAnnotations:{device_type:"auto_restore"},event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH,source:b});g=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();k({additionalAnnotations:{eb_session_identifier:g,restore_upsell_first_impression_time:g},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent,source:b});if(c("qex")._("2481"))d("MWEncryptedBackupsInitializeRestoreDeferred").encryptedBackupsInitializeRestoreDeferred({db:i,onFailure:r,onSuccess:q});else{e={backupId:t.backupId,db:i,newDeviceRegistrationId:f,previousDeviceId:a};d("MWChatEncryptedBackupsAddDeviceWithEBKeys").addDeviceWithEBKeys(e)}}}w.current=!0;h(!1)},e=[u,t,m,v,b,k,i],a[13]=u,a[14]=t,a[15]=m,a[16]=v,a[17]=k,a[18]=i,a[19]=l,a[20]=e):(l=a[19],e=a[20]);n(l,e)}function q(){d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM(),without_add_device:!0},string:{restore_type:"auto_restore"}},event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),d("WALogger").LOG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[wmi][eb] initialize auto-restore success"])))}function r(){d("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM(),without_add_device:!0}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:d("MWChatEncryptedBackupsQPLEvents").restoreQplEvent}),d("MWChatEncryptedBackupsLogging").endFailure({annotations:{bool:{is_backend_setup:d("EBSMGatingUI").isBackendSetupSuccessfulForEBSM()}},errorName:"FAILED_TO_RESTORE_ENCRYPTED_BACKUP",event:d("MWChatEncryptedBackupsQPLEvents").restoreDeviceAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_AUTO_RESTORE_AUTH}),d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["[wmi][eb] initialize auto-restore failed"])))}function s(a){a=a.authorityLevel;return(k||(k=d("I64"))).equal(a,(l||(l=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))}g["default"]=a}),98);
__d("useMWEBAutoRestoreNoticeDialog",["JSResourceForInteraction","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEBUseLocalStorage","MWEncryptedBackupsLocalStorageEntryEnum","QPLUserFlow","ReQL","ReQLSuspense","react","react-compiler-runtime","useLabyrinthLogging","useMWEBSetHasSeenNotice","useMWXLazyDialog","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;(i||d("react")).useCallback;var j=c("JSResourceForInteraction")("MWEBAutoRestoreNoticeDialog.react").__setRef("useMWEBAutoRestoreNoticeDialog");function a(){var a=d("react-compiler-runtime").c(9),b=d("useLabyrinthLogging").useLabyrinthLoggingFlow(),e=b.startFlow;b=c("useMWXLazyDialog")(j);var g=b[0],i=(h||(h=c("useReStore")))();a[0]!==i.tables.auto_restore_opt_out?(b=function(){return d("ReQL").fromTableAscending(i.tables.auto_restore_opt_out)},a[0]=i.tables.auto_restore_opt_out,a[1]=b):b=a[1];var l;a[2]!==i?(l=[i],a[2]=i,a[3]=l):l=a[3];var m=d("ReQLSuspense").useArray(b,l,f.id+":45"),n=c("useMWEBSetHasSeenNotice")();a[4]!==m||a[5]!==n||a[6]!==g||a[7]!==e?(b=function(a){var b=a.hasSeenNotice;a=a.source;var f=m.filter(k).length>0;e({event:d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,source:a});if(f){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,"AUTO_RESTORE_NOTICE_SCREEN_OPTED_OUT");d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent});return}c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent,"AUTO_RESTORE_NOTICE_SCREEN_OPTED_IN");d("MWEBUseLocalStorage").mwEBCreateLocalStorageEntry(c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_REMEMBER_BROWSER_CONSENT);if(b){d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").restoreWithAutoRestoreConsentQplEvent});return}n();g({})},a[4]=m,a[5]=n,a[6]=g,a[7]=e,a[8]=b):b=a[8];return b}function k(a){return a.optOutKey===c("MWEncryptedBackupsLocalStorageEntryEnum").MW_EB_HAS_OPTED_OUT_OF_AUTO_RESTORE}g["default"]=a}),98);
__d("useMWEBListenForChangesToBackupStateXDevice",["I64","ReQL","ReQLSuspense","react","react-compiler-runtime","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=j||d("react");var k=b.useEffect,l=b.useRef;function a(a){var b=d("react-compiler-runtime").c(8),e=(h||(h=c("useReStore")))(),g;b[0]!==e.tables.encrypted_backups_status_trigger?(g=function(){return d("ReQL").fromTableAscending(e.tables.encrypted_backups_status_trigger)},b[0]=e.tables.encrypted_backups_status_trigger,b[1]=g):g=b[1];var j;b[2]!==e?(j=[e],b[2]=e,b[3]=j):j=b[3];var m=d("ReQLSuspense").useFirst(g,j,f.id+":27"),n=l(null);b[4]!==m||b[5]!==a?(g=function(){m!=null&&n.current!==m.pk&&!(i||(i=d("I64"))).equal(m.pk,(i||(i=d("I64"))).of_float(0))&&(n.current=m.pk,a())},j=[m,a],b[4]=m,b[5]=a,b[6]=g,b[7]=j):(g=b[6],j=b[7]);k(g,j)}g["default"]=a}),98);
__d("useMWEBPropagateEbStateChangesThroughRelay",["CometRelay","EBLogger","MAWStateContext.react","ReQL","ReQLSuspense","gkx","promiseDone","react","requireDeferred","useMAWHasUserVisibleErrors","useMAWUnsupportedBrowserNUX","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;b=k||d("react");var l=b.useCallback,m=b.useEffect,n=b.useRef,o=c("requireDeferred")("mwEBSetBackupState").__setRef("useMWEBPropagateEbStateChangesThroughRelay"),p=c("requireDeferred")("mwProcessBackupIds").__setRef("useMWEBPropagateEbStateChangesThroughRelay"),q=c("gkx")("12414");function a(a){var b=a.listenForChangesToBackupState,e=a.onStateChange,g=(j||(j=c("useReStore")))(),k=d("CometRelay").useRelayEnvironment(),r=d("ReQLSuspense").useFirst(function(){return b&&!q?d("ReQL").fromTableAscending(g.tables.encrypted_backups):d("ReQL").empty()},[g,b],f.id+":47"),s=d("ReQLSuspense").useFirst(function(){return b&&!q?d("ReQL").fromTableAscending(g.tables.secure_encrypted_backups_client_state):d("ReQL").empty()},[g,b],f.id+":54"),t=d("MAWStateContext.react").useMAWSelector(function(a){return q?a.ebState:null}),u=n(null),v=l(function(a){d("EBLogger").EBLogger().DEBUG(h||(h=babelHelpers.taggedTemplateLiteralLoose(["[useMWEBPropagateEbStateChangesThroughRelay] update: ",""])),a);var b=u.current;b!==null&&b!==a&&e&&(d("EBLogger").EBLogger().DEBUG(i||(i=babelHelpers.taggedTemplateLiteralLoose(["mwEB Backup state changed from "," to "," - triggering onStateChange"])),b,a),e());u.current=a;d("CometRelay").commitLocalUpdate(k,function(b){b=b.getRoot().getLinkedRecord("viewer");if(b==null){d("EBLogger").EBLogger().mustfix("[backup_state] A viewer record does not exist when propagating EB state.");return}b.setValue(a,"backup_state")})},[k,e]);a=d("useMAWUnsupportedBrowserNUX").useMAWUnsupportedBrowserNUX();a=a.shouldHideEBFlow;var w=c("useMAWHasUserVisibleErrors")(),x=a||w;m(function(){async function a(){var a=t;a==null&&((r!=null||s!=null)&&(a=x?0:(await p.load())({clientStateData:s,encryptedBackupData:r})));a!=null&&(await o.load())({setBackupState:v,state:a})}c("promiseDone")(a())},[s,g,r,k,x,v,t])}g.default=a}),98);
__d("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="23961239003493663"}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql",["useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null},a],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null},a],storageKey:null}]},params:{id:b("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery_facebookRelayOperation"),metadata:{},name:"useMWEncryptedBackupsFetchBackupIdsV2ImplQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql",["useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{argumentDefinitions:[],kind:"Fragment",metadata:{refetch:{connection:null,fragmentPathInResult:[],operation:b("useMWEncryptedBackupsFetchBackupIdsV2ImplQuery.graphql")}},name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null}],storageKey:null}],type:"Query",abstractKey:null}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="29473760965600491"}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2Query.graphql",["useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useMWEncryptedBackupsFetchBackupIdsV2Query",selections:[{args:null,kind:"FragmentSpread",name:"useMWEncryptedBackupsFetchBackupIdsV2Impl_query"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"useMWEncryptedBackupsFetchBackupIdsV2Query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[a,{alias:null,args:null,kind:"ScalarField",name:"backup_tenancy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_user_opted_out",storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},{alias:null,args:null,kind:"ScalarField",name:"encryption_management_delegator_id",storageKey:null},{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_created_on",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"creation_time",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"migration_status",storageKey:null},a],storageKey:null},{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesConnection",kind:"LinkedField",name:"devices",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackupDevicesEdge",kind:"LinkedField",name:"edges",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBEBDevice",kind:"LinkedField",name:"node",plural:!1,selections:[a],storageKey:null}],storageKey:null}],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"XFBEBUserPreferences",kind:"LinkedField",name:"xfb_eb_user_preferences",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"onboarding_decision",storageKey:null},a],storageKey:null}]},params:{id:b("useMWEncryptedBackupsFetchBackupIdsV2Query_facebookRelayOperation"),metadata:{},name:"useMWEncryptedBackupsFetchBackupIdsV2Query",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("useMWEncryptedBackupsFetchBackupIdsV2",["Base64Utils","CometRelay","FBLogger","I64","LSEncryptedBackupsBackupTenancy","LSEncryptedBackupsOnboardingDecision","LSEncryptedBackupsVirtualDeviceType","LSIntEnum","LSShape","LSVec","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsFirstRestoreUpsellTime","MWEncryptedBackupsListenForChangesToBackupStateInitPath","Promise","QPLEvent","QPLUserFlow","WebSession","cr:6666","promiseDone","react","react-compiler-runtime","requireDeferred","useAsyncReStore","useMWEBListenForChangesToBackupStateXDevice","useMWEBPropagateEbStateChangesThroughRelay","useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql","useMWEncryptedBackupsFetchBackupIdsV2Query.graphql"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n;e=k||d("react");var o=e.useEffect,p=e.useRef,q=e.useState,r=c("requireDeferred")("mwEBUpdateBackupsTable").__setRef("useMWEncryptedBackupsFetchBackupIdsV2");function s(a){if(a!=null){a=a;a=c("LSEncryptedBackupsOnboardingDecision")[a];return a}return void 0}function t(a){if(a!=null){a=a;a=c("LSEncryptedBackupsBackupTenancy")[a];return(l||(l=d("LSIntEnum"))).ofNumber(a)}return void 0}function u(a){var e=a.data,f=a.dbPromise,g=a.isInitalLoad,h=a.setListenForChangesToBackupState,i=e.xfb_backup,k=i==null?void 0:i.id;if(i!=null&&k!=null){g.current===!0&&b("cr:6666")!=null&&c("promiseDone")(b("cr:6666")(f));var m=!1;(i==null?void 0:i.has_otc_eligible_devices)!=null?m=i==null?void 0:i.has_otc_eligible_devices:c("FBLogger")("wmi_eb").mustfix("failed to retrieve has_otc_eligible_devices. defaulting to false");var o=c("LSVec").ofArray([d("LSShape").ofRecord({backup_id:(n||(n=d("I64"))).of_string(k),backup_tenancy:t(i.backup_tenancy)})]),p=[];i.virtual_devices.forEach(function(a){var b,e=a.client_generated_id;if(k==null||e==null||a.device_type==null){c("FBLogger")("wmi_eb").warn("Invalid virtual device fetched in fetchBackupsIdsV2.");return}var f="REQUIRES_MIGRATION";f=a.migration_status===f;var g=a.device_type;g=c("LSEncryptedBackupsVirtualDeviceType")[g];p.push(d("LSShape").ofRecord({backup_id:(n||(n=d("I64"))).of_string(k),virtual_device_ids:c("LSVec").ofArray([d("LSShape").ofRecord({virtual_device_id:d("Base64Utils").toArrayBuffer(e)})]),virtual_devices:c("LSVec").ofArray([d("LSShape").ofRecord({creation_time:(b=a.creation_time)!=null?b:void 0,device_created_on:(b=a.device_created_on)!=null?b:void 0,requires_hsm_migration:f,virtual_device_id:d("Base64Utils").toArrayBuffer(e),virtual_device_type:(l||(l=d("LSIntEnum"))).ofNumber(g)})])}))});var q=[];(a=i.devices)==null||a.edges.forEach(function(a){var b;if(((b=a.node)==null?void 0:b.id)==null)return;q.push(d("LSShape").ofRecord({device_id:(n||(n=d("I64"))).of_string((b=a.node)==null?void 0:b.id)}))});var u=i.encryption_management_delegator_id!=null?(n||(n=d("I64"))).of_string(i.encryption_management_delegator_id):void 0;c("promiseDone")((j||(j=b("Promise"))).all([r.load(),f]),function(a){var b=a[0],d=a[1];c("promiseDone")(b({backupIds:o,deviceIds:c("LSVec").ofArray(q),encryptionManagementDelegatorId:u,hasOtcEligibleDevices:m,isSuccess:!0,isUserOptedOut:(a=i.is_user_opted_out)!=null?a:void 0,storage:d,virtualDevices:c("LSVec").ofArray(p)}),function(){h(!0),g.current===!0&&(g.current=!1,c("MWEncryptedBackupsListenForChangesToBackupStateInitPath").preloadEBData(d))})})}else{var v=s((a=e.xfb_eb_user_preferences)==null?void 0:a.onboarding_decision)===c("LSEncryptedBackupsOnboardingDecision").STORE_ON_DEVICE_ONLY;c("promiseDone")((j||(j=b("Promise"))).all([r.load(),f]),function(a){var b=a[0];a=a[1];c("promiseDone")(b({backupIds:c("LSVec").ofArray([]),deviceIds:c("LSVec").ofArray([]),hasOtcEligibleDevices:!1,isSuccess:!0,isUserOptedOut:v,storage:a,virtualDevices:c("LSVec").ofArray([])}),function(){h(!0)})})}}function v(a){var e=d("react-compiler-runtime").c(10),f=c("useAsyncReStore")(),g=p(!0),i=p(!1),j=q(!1),k=j[0],l=j[1];j=d("CometRelay").useRefetchableFragment(h!==void 0?h:h=b("useMWEncryptedBackupsFetchBackupIdsV2Impl_query.graphql"),a);var n=j[0],r=j[1];e[0]!==n||e[1]!==r?(a=function(){var a=d("MWEncryptedBackupsFirstRestoreUpsellTime").getFirstRestoreUpsellTime();c("QPLUserFlow").getActiveFlowIDs().includes((m||(m=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent))||c("QPLUserFlow").start(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent,{annotations:{string:{ebSessionIdentifier:a,fetchBackupIdsVersion:"GQL",sessionTabId:d("WebSession").getId()}}});r({},{fetchPolicy:"network-only",onComplete:function(a){i.current=!1;if(c("QPLUserFlow").getActiveFlowIDs().includes((m||(m=d("QPLEvent"))).getMarkerId(d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent)))if(a!=null)d("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{error:a.message,error_stack:a.stack}},errorName:"fetch_backup_ids_error",event:d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent});else{d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{bool:{isUserOptedOut:(a=n.xfb_backup)==null?void 0:a.is_user_opted_out},string:{backup_id:(a=(a=n.xfb_backup)==null?void 0:a.id)!=null?a:"null"}},event:d("MWChatEncryptedBackupsQPLEvents").fetchBackupIdsQPLEvent})}}})},e[0]=n,e[1]=r,e[2]=a):a=e[2];j=a;c("useMWEBListenForChangesToBackupStateXDevice")(j);e[3]!==k||e[4]!==j?(a={listenForChangesToBackupState:k,onStateChange:j},e[3]=k,e[4]=j,e[5]=a):a=e[5];c("useMWEBPropagateEbStateChangesThroughRelay")(a);e[6]!==n||e[7]!==f?(k=function(){if(i.current===!0)return;i.current=!0;u({data:n,dbPromise:f,isInitalLoad:g,setListenForChangesToBackupState:l})},j=[n,f],e[6]=n,e[7]=f,e[8]=k,e[9]=j):(k=e[8],j=e[9]);o(k,j)}function a(){var a=d("CometRelay").useLazyLoadQuery(i!==void 0?i:i=b("useMWEncryptedBackupsFetchBackupIdsV2Query.graphql"),{},{fetchPolicy:"network-only"});v(a)}g["default"]=a}),98);